<!DOCTYPE html>
<html><head lang="en"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>C&#43;&#43;逆向 - ldrx30</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="
什么？对象，虚？
" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="C&#43;&#43;逆向" />
<meta property="og:description" content="
什么？对象，虚？
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/c&#43;&#43;%E9%80%86%E5%90%91/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-01-19T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="C&#43;&#43;逆向"/>
<meta name="twitter:description" content="
什么？对象，虚？
"/>
<script src="http://localhost:1313/js/feather.min.js"></script>
	
	
        <link href="http://localhost:1313/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/main.5cebd7d4fb2b97856af8d32a6def16164fcf7d844e98e236fcb3559655020373.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="http://localhost:1313/css/dark.d22e2a2879d933a4b781535fc4c4c716e9f9d35ea4986dd0cbabda82effc4bdd.css"  disabled />
	

	
	
		<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
		</script>

		
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script>
	

	
	
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>

		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
					renderMathInElement(document.body, {
							delimiters: [
									{left: "$$", right: "$$", display: true},
									{left: "$", right: "$", display: false}
							]
					});
			});
			</script>
	

	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="http://localhost:1313/">ldrx30</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">All posts</a>
		
		<a href="/about">About</a>
		
		| <span id="dark-mode-toggle" onclick="toggleTheme()"></span>
		<script src="http://localhost:1313/js/themetoggle.js"></script>
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">C&#43;&#43;逆向</h1>
			<div class="meta">Posted on Jan 19, 2024</div>
		</div>
		

		

		<section class="body">
			<blockquote>
<p>什么？对象，虚？</p>
</blockquote>
<h2 id="pe-文件格式">PE 文件格式</h2>
<blockquote>
<p>为什么会有这个？逆向为什么没有这个！</p>
</blockquote>
<p>微软官方文档：<a href="https://learn.microsoft.com/zh-cn/windows/win32/debug/pe-format">PE 格式 - Win32 apps</a></p>
<p>使用 010editor 查看。需要先下载插件：模板-&gt;模板库-&gt;安装 exe.bt 。alt+4 可以查看PE文件格式</p>
<h3 id="dos-头">DOS 头</h3>
<p>两个重要的变量 <code>e_magic</code>(判断是否为DOS头，固定为<code>5a4d</code>) 和 <code>e_lfanew</code>(NT头的偏移)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> <span style="color:#ff79c6">struct</span> <span style="color:#50fa7b">_IMAGE_DOS_HEADER</span> {      <span style="color:#6272a4">// DOS .EXE header
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_magic;                     <span style="color:#6272a4">// Magic number
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_cblp;                      <span style="color:#6272a4">// Bytes on last page of file
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_cp;                        <span style="color:#6272a4">// Pages in file
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_crlc;                      <span style="color:#6272a4">// Relocations
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_cparhdr;                   <span style="color:#6272a4">// Size of header in paragraphs
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_minalloc;                  <span style="color:#6272a4">// Minimum extra paragraphs needed
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_maxalloc;                  <span style="color:#6272a4">// Maximum extra paragraphs needed
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_ss;                        <span style="color:#6272a4">// Initial (relative) SS value
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_sp;                        <span style="color:#6272a4">// Initial SP value
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_csum;                      <span style="color:#6272a4">// Checksum
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_ip;                        <span style="color:#6272a4">// Initial IP value
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_cs;                        <span style="color:#6272a4">// Initial (relative) CS value
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_lfarlc;                    <span style="color:#6272a4">// File address of relocation table
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_ovno;                      <span style="color:#6272a4">// Overlay number
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_res[<span style="color:#bd93f9">4</span>];                    <span style="color:#6272a4">// Reserved words
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_oemid;                     <span style="color:#6272a4">// OEM identifier (for e_oeminfo)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_oeminfo;                   <span style="color:#6272a4">// OEM information; e_oemid specific
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD   e_res2[<span style="color:#bd93f9">10</span>];                  <span style="color:#6272a4">// Reserved words
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    LONG   e_lfanew;                    <span style="color:#6272a4">// File address of new exe header
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  } IMAGE_DOS_HEADER, <span style="color:#ff79c6">*</span>PIMAGE_DOS_HEADER
</span></span></code></pre></div><h3 id="dos-stub">DOS stub</h3>
<p>MS-DOS 存根是在 <em>MS-DOS 下运行的有效应用程序</em>。 它放置在 EXE 映像的前面。 链接器在此处放置一个默认存根，当映像在 MS-DOS 中运行时，该存根输出消息“此程序无法在 DOS 模式下运行”。</p>
<h3 id="nt-头">NT 头</h3>
<p><code>IMAGE_NT_HEADERS</code> 结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> <span style="color:#ff79c6">struct</span> <span style="color:#50fa7b">_IMAGE_NT_HEADERS64</span> {
</span></span><span style="display:flex;"><span>    DWORD Signature;
</span></span><span style="display:flex;"><span>    IMAGE_FILE_HEADER FileHeader;
</span></span><span style="display:flex;"><span>    IMAGE_OPTIONAL_HEADER64 OptionalHeader;
</span></span><span style="display:flex;"><span>} IMAGE_NT_HEADERS64, <span style="color:#ff79c6">*</span>PIMAGE_NT_HEADERS64;
</span></span></code></pre></div><h4 id="签名">签名</h4>
<p>签名是一个固定的值</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#define IMAGE_NT_SIGNATURE                  0x00004550  </span><span style="color:#6272a4">// PE00
</span></span></span></code></pre></div><h4 id="fileheader">FileHeader</h4>
<p>文件头包含了很多重要的属性</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> <span style="color:#ff79c6">struct</span> <span style="color:#50fa7b">_IMAGE_FILE_HEADER</span> {
</span></span><span style="display:flex;"><span>	WORD    Machine;					<span style="color:#6272a4">// 取决于机器，ARM, x86...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	WORD    NumberOfSections;			<span style="color:#6272a4">// Section 数量
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	DWORD   TimeDateStamp;				<span style="color:#6272a4">// 文件创建时间
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	DWORD   PointerToSymbolTable;		<span style="color:#6272a4">// 指向符号表
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	DWORD   NumberOfSymbols;			<span style="color:#6272a4">// 符号表中符号个数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	WORD    SizeOfOptionalHeader;		<span style="color:#6272a4">// 可选头的大小
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	WORD    Characteristics;			<span style="color:#6272a4">// 文件属性，是否为DLL等
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>} IMAGE_FILE_HEADER, <span style="color:#ff79c6">*</span> PIMAGE_FILE_HEADER;
</span></span></code></pre></div><h4 id="optionalheader">OptionalHeader</h4>
<p>可选头</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> <span style="color:#ff79c6">struct</span> <span style="color:#50fa7b">_IMAGE_OPTIONAL_HEADER64</span> {
</span></span><span style="display:flex;"><span>    WORD        Magic;                      <span style="color:#6272a4">// 魔术字
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    BYTE        MajorLinkerVersion;         <span style="color:#6272a4">// linker 版本号
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    BYTE        MinorLinkerVersion;     
</span></span><span style="display:flex;"><span>    DWORD       SizeOfCode;                
</span></span><span style="display:flex;"><span>    DWORD       SizeOfInitializedData;
</span></span><span style="display:flex;"><span>    DWORD       SizeOfUninitializedData;
</span></span><span style="display:flex;"><span>    DWORD       AddressOfEntryPoint;        <span style="color:#6272a4">// 程序执行入口RVA
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    DWORD       BaseOfCode;                 <span style="color:#6272a4">// 代码的节的起始RVA
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    ULONGLONG   ImageBase;                  <span style="color:#6272a4">// 优先装载地址
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    DWORD       SectionAlignment;           <span style="color:#6272a4">// 内存中的节的对齐
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    DWORD       FileAlignment;              <span style="color:#6272a4">// 文件中的节的对齐
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    WORD        MajorOperatingSystemVersion;
</span></span><span style="display:flex;"><span>    WORD        MinorOperatingSystemVersion;
</span></span><span style="display:flex;"><span>    WORD        MajorImageVersion;
</span></span><span style="display:flex;"><span>    WORD        MinorImageVersion;
</span></span><span style="display:flex;"><span>    WORD        MajorSubsystemVersion;
</span></span><span style="display:flex;"><span>    WORD        MinorSubsystemVersion;
</span></span><span style="display:flex;"><span>    DWORD       Win32VersionValue;
</span></span><span style="display:flex;"><span>    DWORD       SizeOfImage;
</span></span><span style="display:flex;"><span>    DWORD       SizeOfHeaders;
</span></span><span style="display:flex;"><span>    DWORD       CheckSum;
</span></span><span style="display:flex;"><span>    WORD        Subsystem;
</span></span><span style="display:flex;"><span>    WORD        DllCharacteristics;         <span style="color:#6272a4">// DLL文件特性
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    ULONGLONG   SizeOfStackReserve;
</span></span><span style="display:flex;"><span>    ULONGLONG   SizeOfStackCommit;
</span></span><span style="display:flex;"><span>    ULONGLONG   SizeOfHeapReserve;
</span></span><span style="display:flex;"><span>    ULONGLONG   SizeOfHeapCommit;
</span></span><span style="display:flex;"><span>    DWORD       LoaderFlags;                <span style="color:#6272a4">// 与调试有关
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    DWORD       NumberOfRvaAndSizes;        <span style="color:#6272a4">// 数据目录结构的项目数量
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];
</span></span><span style="display:flex;"><span>} IMAGE_OPTIONAL_HEADER64, <span style="color:#ff79c6">*</span> PIMAGE_OPTIONAL_HEADER64;
</span></span></code></pre></div><p>ImageBase: 文件在内存中的首选装入地址。如果有可能（也就是说，目前如果没有其他占据这块地址，它是正确对齐的并且是一个合法的地址，等等），加载器试图在这个地址装入PE文件。如果可执行文件是在这个地址装入的，那么加载器将跳过应用<em>基址重定位</em>的步骤。</p>
<h3 id="section">Section</h3>
<p>节的初始化数据由简单的字节块组成。 但是，对于全部为零的节，不需要包含节数据。</p>
<p>每个节的数据位于节头中的 PointerToRawData 字段给出的文件偏移量处。 文件中此数据的大小由 SizeOfRawData 字段指示。 如果 SizeOfRawData 小于 VirtualSize，则其余部分用零填充。</p>
<p>这里的对齐和可选头的 <code>SectionAlignment</code>和 <code>FileAlignment</code> 相关</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> <span style="color:#ff79c6">struct</span> <span style="color:#50fa7b">_IMAGE_SECTION_HEADER</span> {
</span></span><span style="display:flex;"><span>	BYTE    Name[IMAGE_SIZEOF_SHORT_NAME];          <span style="color:#6272a4">// 名称 .text .bss 等
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">union</span> {
</span></span><span style="display:flex;"><span>		DWORD   PhysicalAddress;
</span></span><span style="display:flex;"><span>		DWORD   VirtualSize;
</span></span><span style="display:flex;"><span>	} Misc;
</span></span><span style="display:flex;"><span>	DWORD   VirtualAddress;                         <span style="color:#6272a4">// 节区的 RVA 地址
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	DWORD   SizeOfRawData;                          <span style="color:#6272a4">// 文件对齐后的大小
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	DWORD   PointerToRawData;                       <span style="color:#6272a4">// FOA
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	DWORD   PointerToRelocations;
</span></span><span style="display:flex;"><span>	DWORD   PointerToLinenumbers;
</span></span><span style="display:flex;"><span>	WORD    NumberOfRelocations;
</span></span><span style="display:flex;"><span>	WORD    NumberOfLinenumbers;
</span></span><span style="display:flex;"><span>	DWORD   Characteristics;                        <span style="color:#6272a4">// 节属性如可读，可写，可执行等
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>} IMAGE_SECTION_HEADER, <span style="color:#ff79c6">*</span> PIMAGE_SECTION_HEADER;
</span></span></code></pre></div><h2 id="helloworld">HelloWorld</h2>
<p>非常简单的源码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;iostream&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">func</span>(<span style="color:#8be9fd">int</span> a, <span style="color:#8be9fd">int</span> b, <span style="color:#8be9fd">int</span> c, <span style="color:#8be9fd">int</span> d, <span style="color:#8be9fd">int</span> e, <span style="color:#8be9fd">int</span> f, <span style="color:#8be9fd">int</span> g)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> a;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">int</span> a;
</span></span><span style="display:flex;"><span>	std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#f1fa8c">&#34;hello world&#34;</span> <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>	a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>	std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> func(a, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">4</span>, <span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">6</span>, <span style="color:#bd93f9">7</span>) <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>带符号表的反汇编，可以看出其比较长的 namespace 和 函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">__int64</span> <span style="color:#ff79c6">__fastcall</span> <span style="color:#50fa7b">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  std<span style="color:#ff79c6">::</span>ostream <span style="color:#ff79c6">*</span>v0; <span style="color:#6272a4">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">unsigned</span> <span style="color:#8be9fd">int</span> v1; <span style="color:#6272a4">// eax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">__int64</span> v2; <span style="color:#6272a4">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>  j___CheckForDebuggerJustMyCode(<span style="color:#ff79c6">&amp;</span>_4C11826D_reverse_cpp);
</span></span><span style="display:flex;"><span>  v0 <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;&lt;</span>std<span style="color:#ff79c6">::</span>char_traits<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">&gt;&gt;</span>(std<span style="color:#ff79c6">::</span>cout, <span style="color:#f1fa8c">&#34;hello world&#34;</span>);
</span></span><span style="display:flex;"><span>  std<span style="color:#ff79c6">::</span>ostream<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;</span>(v0, std<span style="color:#ff79c6">::</span>endl<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span>,std<span style="color:#ff79c6">::</span>char_traits<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">&gt;&gt;</span>);
</span></span><span style="display:flex;"><span>  v1 <span style="color:#ff79c6">=</span> func(<span style="color:#bd93f9">10</span>, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">4</span>, <span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">6</span>, <span style="color:#bd93f9">7</span>);
</span></span><span style="display:flex;"><span>  v2 <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span>ostream<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;</span>(std<span style="color:#ff79c6">::</span>cout, v1);
</span></span><span style="display:flex;"><span>  std<span style="color:#ff79c6">::</span>ostream<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;</span>(v2, std<span style="color:#ff79c6">::</span>endl<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span>,std<span style="color:#ff79c6">::</span>char_traits<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">&gt;&gt;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>i64;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="call-方式">CALL 方式</h3>
<p>具体参考：<a href="https://learn.microsoft.com/zh-cn/cpp/cpp/argument-passing-and-naming-conventions?view=msvc-170">自变量传递和命名约定 | Microsoft Learn</a>****</p>
<p><strong><code>__cdecl</code></strong> 是 C 和 C++ 程序的默认调用约定。 堆栈由<code>caller</code>清理,函数传递顺序 从右到左</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> <span style="color:#ff79c6">__cdecl</span> <span style="color:#50fa7b">method</span>();
</span></span></code></pre></div><p><strong><code>__stdcall</code></strong> 调用约定用于调用 Win32 API 函数。<code>callee</code>清理堆栈，函数传递方式 从右到左。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#define WINAPI __stdcall
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#8be9fd">void</span> <span style="color:#ff79c6">__stdcall</span> <span style="color:#50fa7b">method</span>();
</span></span></code></pre></div><p><strong><code>__fastcall</code></strong> 调用约定指定尽可能在寄存器中传递函数的自变量。 此调用约定仅适用于 x86 体系结构。参数传递</p>
<ul>
<li>x86 从左到右的顺序找到前两个 <code>DWORD</code> 或更小自变量将在 ECX 和 EDX 寄存器中传递；所有其他自变量在堆栈上从右向左传递。</li>
<li>x64 下是 rcx, rdx, r8, r9</li>
</ul>
<p><strong><code>__thiscall</code></strong> 的调用约定用于 x86 体系结构上的 C++ 类成员函数，<strong>特定于 Microsoft</strong></p>
<p>比如说 call func 的 汇编代码，我在x64下是 fastcall</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0000000140011</span>CEE                 mov     [rbp<span style="color:#ff79c6">+</span><span style="color:#bd93f9">0F</span><span style="color:#bd93f9">0</span>h<span style="color:#ff79c6">+</span>a], <span style="color:#bd93f9">0</span>Ah
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0000000140011</span>CF5                 mov     [rsp<span style="color:#ff79c6">+</span><span style="color:#bd93f9">130</span>h<span style="color:#ff79c6">+</span>g], <span style="color:#bd93f9">7</span> ; g
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0000000140011</span>CFD                 mov     [rsp<span style="color:#ff79c6">+</span><span style="color:#bd93f9">130</span>h<span style="color:#ff79c6">+</span>f], <span style="color:#bd93f9">6</span> ; f
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0000000140011</span>D05                 mov     [rsp<span style="color:#ff79c6">+</span><span style="color:#bd93f9">130</span>h<span style="color:#ff79c6">+</span>e], <span style="color:#bd93f9">5</span> ; e
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0000000140011</span>D0D                 mov     r9d, <span style="color:#bd93f9">4</span>          ; d
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0000000140011</span>D13                 mov     r8d, <span style="color:#bd93f9">3</span>          ; c
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0000000140011</span>D19                 mov     edx, <span style="color:#bd93f9">2</span>          ; b
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0000000140011</span>D1E                 mov     ecx, [rbp<span style="color:#ff79c6">+</span><span style="color:#bd93f9">0F</span><span style="color:#bd93f9">0</span>h<span style="color:#ff79c6">+</span>a] ; a
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0000000140011</span>D21                 call    j_<span style="color:#ff79c6">?</span>func@@YAHHHHHHHH@Z ; func(<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>)
</span></span></code></pre></div><p>但是在 x86 就是 cdecl call</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0041253</span>C                 push    <span style="color:#bd93f9">7</span>               ; g
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0041253</span>E                 push    <span style="color:#bd93f9">6</span>               ; f
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">00412540</span>                 push    <span style="color:#bd93f9">5</span>               ; e
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">00412542</span>                 push    <span style="color:#bd93f9">4</span>               ; d
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">00412544</span>                 push    <span style="color:#bd93f9">3</span>               ; c
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">00412546</span>                 push    <span style="color:#bd93f9">2</span>               ; b
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0041254</span><span style="color:#bd93f9">8</span>                 mov     eax, [ebp<span style="color:#ff79c6">+</span>a]
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0041254</span>B                 push    eax             ; a
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">text</span>:<span style="color:#bd93f9">0041254</span>C                 call    j_<span style="color:#ff79c6">?</span>func@@YAHHHHHHHH@Z ; func(<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>)
</span></span></code></pre></div><p>但是不变的是 <code>rax</code> 为函数返回值</p>
<h2 id="class">Class</h2>
<p>测试代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;iostream&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;vector&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Person</span> {
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">int</span> _age;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	Person() {
</span></span><span style="display:flex;"><span>		_age <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>		std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#f1fa8c">&#34;person&#34;</span> <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">virtual</span> <span style="color:#ff79c6">~</span>Person() {
</span></span><span style="display:flex;"><span>		std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#f1fa8c">&#34;~person&#34;</span> <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">virtual</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">GetAge</span>() <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">virtual</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">SetAge</span>(<span style="color:#8be9fd">int</span> age) <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Boy</span> <span style="color:#ff79c6">:</span> <span style="color:#ff79c6">public</span> Person {
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	Boy() {
</span></span><span style="display:flex;"><span>		std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#f1fa8c">&#34;boy&#34;</span> <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">virtual</span> <span style="color:#ff79c6">~</span>Boy() {
</span></span><span style="display:flex;"><span>		std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#f1fa8c">&#34;~boy&#34;</span> <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">int</span> <span style="color:#50fa7b">GetAge</span>() {
</span></span><span style="display:flex;"><span>		std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#f1fa8c">&#34;boy getage&#34;</span> <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> <span style="color:#bd93f9">114</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">void</span> <span style="color:#50fa7b">SetAge</span>(<span style="color:#8be9fd">int</span> age) {
</span></span><span style="display:flex;"><span>		std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#f1fa8c">&#34;boy setage&#34;</span> <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>	std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>Boy<span style="color:#ff79c6">&gt;</span> boys;
</span></span><span style="display:flex;"><span>	Boy b;
</span></span><span style="display:flex;"><span>	boys.push_back(b);
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">auto</span> f <span style="color:#ff79c6">=</span> [](<span style="color:#8be9fd">int</span> a, <span style="color:#8be9fd">int</span> b) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd">int</span> {
</span></span><span style="display:flex;"><span>		std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#f1fa8c">&#34;lambda&#34;</span> <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> a <span style="color:#ff79c6">+</span> b;
</span></span><span style="display:flex;"><span>		};
</span></span><span style="display:flex;"><span>	std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&lt;&lt;</span> f(<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>C++ 名称粉碎机制：举个例子 <code>std::cout</code> 名字是 <code>__imp_?cout@std@@3V?$basic_ostream@DU?$char_traits@D@std@@@1@A:qword</code>。</p>
<ul>
<li>更好的重载</li>
</ul>
<p><code>MSVC</code> 反编译出来，优化比较严重，因此使用<code>g++</code></p>
<h3 id="方法">方法</h3>
<p>析构函数和构造函数</p>
<p>构造函数调用：函数声明时；析构函数：生命周期结束时</p>
<p>反汇编时，方法第一个参数一般是 <code>this</code> 指针</p>
<h3 id="继承">继承</h3>
<p>在构造时，构造顺序为先构造父类，后构造子类。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> <span style="color:#ff79c6">__fastcall</span> Boy<span style="color:#ff79c6">::</span>Boy(Boy <span style="color:#ff79c6">*</span><span style="color:#ff79c6">this</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">__int64</span> v1; <span style="color:#6272a4">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>  Person<span style="color:#ff79c6">::</span>Person(<span style="color:#ff79c6">this</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">*</span>(_QWORD <span style="color:#ff79c6">*</span>)<span style="color:#ff79c6">this</span> <span style="color:#ff79c6">=</span> off_4CC8;   <span style="color:#6272a4">// 虚指针
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  v1 <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;&lt;</span>std<span style="color:#ff79c6">::</span>char_traits<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">&gt;&gt;</span>(<span style="color:#ff79c6">&amp;</span>std<span style="color:#ff79c6">::</span>cout, <span style="color:#f1fa8c">&#34;boy&#34;</span>);
</span></span><span style="display:flex;"><span>  std<span style="color:#ff79c6">::</span>ostream<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;</span>(v1, <span style="color:#ff79c6">&amp;</span>std<span style="color:#ff79c6">::</span>endl<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span>,std<span style="color:#ff79c6">::</span>char_traits<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">&gt;&gt;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在析构时，析构顺序为先析构子类，后析构父类。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> <span style="color:#ff79c6">__fastcall</span> Boy<span style="color:#ff79c6">::~</span>Boy(Boy <span style="color:#ff79c6">*</span><span style="color:#ff79c6">this</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">__int64</span> v1; <span style="color:#6272a4">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">*</span>(_QWORD <span style="color:#ff79c6">*</span>)<span style="color:#ff79c6">this</span> <span style="color:#ff79c6">=</span> off_4CC8; <span style="color:#6272a4">// vfptr
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  v1 <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;&lt;</span>std<span style="color:#ff79c6">::</span>char_traits<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">&gt;&gt;</span>(<span style="color:#ff79c6">&amp;</span>std<span style="color:#ff79c6">::</span>cout, <span style="color:#f1fa8c">&#34;~boy&#34;</span>);
</span></span><span style="display:flex;"><span>  std<span style="color:#ff79c6">::</span>ostream<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;</span>(v1, <span style="color:#ff79c6">&amp;</span>std<span style="color:#ff79c6">::</span>endl<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span>,std<span style="color:#ff79c6">::</span>char_traits<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">&gt;&gt;</span>);
</span></span><span style="display:flex;"><span>  Person<span style="color:#ff79c6">::~</span>Person(<span style="color:#ff79c6">this</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="虚函数">虚函数</h3>
<p>虚函数也是函数，体现了CPP的多态性。</p>
<p>根据对象的实际类型来调用成员函数，而不是根据指针的类型来对该块内存进行解释并调用属于该指针类型所属的成员函数，简化代码实现多态性</p>
<ul>
<li>一个很好的解释：父类声明子类<code>Set&lt;String&gt; m = new HashMap&lt;String&gt;</code>，但是调用方法是子类的</li>
</ul>
<p>在<code>cpp</code>中使用一个指针和一个表格来进行实现的。这个表格称为虚表<code>vftable</code> ，这个指针称为虚表指针。</p>
<ul>
<li>如果一个类中有虚函数，编译器则会在对象的首部加入虚表指针，以存放所属于该对象的虚表</li>
</ul>
<p>虚表指针的填充时机：<strong>只有在构造函数和析构函数中会对虚表指针重新赋值，其他位置没有对该指针的操作</strong>。</p>
<ul>
<li>虚函数在类的首部</li>
</ul>
<p>其在构造函数和析构函数给<code>vfptr</code>赋值</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>.data.rel.<span style="color:#8be9fd;font-style:italic">ro</span>:<span style="color:#bd93f9">0000000000004</span>CC8 off_4CC8        dq offset _ZN3BoyD2Ev   ; DATA <span style="color:#8be9fd;font-style:italic">XREF</span>: Boy<span style="color:#ff79c6">::</span>Boy(<span style="color:#8be9fd">void</span>)<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>D↑o
</span></span><span style="display:flex;"><span>.data.rel.<span style="color:#8be9fd;font-style:italic">ro</span>:<span style="color:#bd93f9">0000000000004</span>CC8                                         ; Boy<span style="color:#ff79c6">::~</span>Boy()<span style="color:#ff79c6">+</span><span style="color:#bd93f9">10</span>↑o ...
</span></span><span style="display:flex;"><span>.data.rel.<span style="color:#8be9fd;font-style:italic">ro</span>:<span style="color:#bd93f9">0000000000004</span>CC8                                         ; Boy<span style="color:#ff79c6">::~</span>Boy()
</span></span><span style="display:flex;"><span>.data.rel.<span style="color:#8be9fd;font-style:italic">ro</span>:<span style="color:#bd93f9">0000000000004</span>CD0                 dq offset _ZN3BoyD0Ev   ; Boy<span style="color:#ff79c6">::~</span>Boy()
</span></span><span style="display:flex;"><span>.data.rel.<span style="color:#8be9fd;font-style:italic">ro</span>:<span style="color:#bd93f9">0000000000004</span>CD8                 dq offset _ZN3Boy6GetAgeEv ; Boy<span style="color:#ff79c6">::</span>GetAge(<span style="color:#8be9fd">void</span>)
</span></span><span style="display:flex;"><span>.data.rel.<span style="color:#8be9fd;font-style:italic">ro</span>:<span style="color:#bd93f9">0000000000004</span>CE0                 dq offset _ZN3Boy6SetAgeEi ; Boy<span style="color:#ff79c6">::</span>SetAge(<span style="color:#8be9fd">int</span>)
</span></span><span style="display:flex;"><span>.data.rel.<span style="color:#8be9fd;font-style:italic">ro</span>:<span style="color:#bd93f9">0000000000004</span>CE8                 <span style="color:#ff79c6">public</span> _ZTV6Person ; weak
</span></span></code></pre></div><p><strong>析构函数为什么也要重新给虚表赋值呢？</strong></p>
<ul>
<li>编译器无法预知这个子类以后是否会被其他类继承，如果被继承，就成了父类，在执行析构函数时会先执行当前对象的析构函数，然后向祖父类的方向按继承线路逐层调用各类析构函数，当前对象的析构函数开始执行时，其虚表也是当前对象的，所以执行到父类的析构函数时，虚表必须改写为父类的虚表</li>
</ul>
<h2 id="引用与指针">引用与指针</h2>
<p>指针</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;iostream&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">100</span>;
</span></span><span style="display:flex;"><span>    printf(<span style="color:#f1fa8c">&#34;a=%d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, a);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> <span style="color:#ff79c6">*</span>p <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>a;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">*</span>p <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">200</span>;
</span></span><span style="display:flex;"><span>    printf(<span style="color:#f1fa8c">&#34;a=%d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, a);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>push    rbp
</span></span><span style="display:flex;"><span>mov     rbp, rsp
</span></span><span style="display:flex;"><span>sub     rsp, <span style="color:#bd93f9">20</span>h
</span></span><span style="display:flex;"><span>mov     rax, <span style="color:#8be9fd;font-style:italic">fs</span>:<span style="color:#bd93f9">28</span>h
</span></span><span style="display:flex;"><span>mov     [rbp<span style="color:#ff79c6">+</span>var_8], rax  
</span></span><span style="display:flex;"><span>xor     eax, eax
</span></span><span style="display:flex;"><span>mov     [rbp<span style="color:#ff79c6">+</span>var_14], <span style="color:#bd93f9">64</span>h ; <span style="color:#f1fa8c">&#39;d&#39;</span>
</span></span><span style="display:flex;"><span>mov     eax, [rbp<span style="color:#ff79c6">+</span>var_14]
</span></span><span style="display:flex;"><span>mov     esi, eax
</span></span><span style="display:flex;"><span>lea     rax, format     ; <span style="color:#f1fa8c">&#34;a=%d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>mov     rdi, rax        ; format
</span></span><span style="display:flex;"><span>mov     eax, <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>call    _printf
</span></span><span style="display:flex;"><span>lea     rax, [rbp<span style="color:#ff79c6">+</span>var_14]
</span></span><span style="display:flex;"><span>mov     [rbp<span style="color:#ff79c6">+</span>var_10], rax  ; <span style="color:#ff79c6">*</span>p
</span></span><span style="display:flex;"><span>mov     rax, [rbp<span style="color:#ff79c6">+</span>var_10]
</span></span><span style="display:flex;"><span>mov     dword ptr [rax], <span style="color:#bd93f9">0</span>C8h
</span></span><span style="display:flex;"><span>mov     eax, [rbp<span style="color:#ff79c6">+</span>var_14]
</span></span><span style="display:flex;"><span>mov     esi, eax
</span></span><span style="display:flex;"><span>lea     rax, format     ; <span style="color:#f1fa8c">&#34;a=%d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>mov     rdi, rax        ; format
</span></span><span style="display:flex;"><span>mov     eax, <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>call    _printf
</span></span></code></pre></div><p>左值引用</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;iostream&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">100</span>;
</span></span><span style="display:flex;"><span>    printf(<span style="color:#f1fa8c">&#34;a=%d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, a);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> <span style="color:#ff79c6">&amp;</span>p <span style="color:#ff79c6">=</span> a;
</span></span><span style="display:flex;"><span>    p <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">200</span>;
</span></span><span style="display:flex;"><span>    printf(<span style="color:#f1fa8c">&#34;a=%d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, a);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>push    rbp
</span></span><span style="display:flex;"><span>mov     rbp, rsp
</span></span><span style="display:flex;"><span>sub     rsp, <span style="color:#bd93f9">20</span>h
</span></span><span style="display:flex;"><span>mov     rax, <span style="color:#8be9fd;font-style:italic">fs</span>:<span style="color:#bd93f9">28</span>h
</span></span><span style="display:flex;"><span>mov     [rbp<span style="color:#ff79c6">+</span>var_8], rax
</span></span><span style="display:flex;"><span>xor     eax, eax
</span></span><span style="display:flex;"><span>mov     [rbp<span style="color:#ff79c6">+</span>var_14], <span style="color:#bd93f9">64</span>h ; <span style="color:#f1fa8c">&#39;d&#39;</span>
</span></span><span style="display:flex;"><span>mov     eax, [rbp<span style="color:#ff79c6">+</span>var_14]
</span></span><span style="display:flex;"><span>mov     esi, eax
</span></span><span style="display:flex;"><span>lea     rax, format     ; <span style="color:#f1fa8c">&#34;a=%d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>mov     rdi, rax        ; format
</span></span><span style="display:flex;"><span>mov     eax, <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>call    _printf
</span></span><span style="display:flex;"><span>lea     rax, [rbp<span style="color:#ff79c6">+</span>var_14]
</span></span><span style="display:flex;"><span>mov     [rbp<span style="color:#ff79c6">+</span>var_10], rax
</span></span><span style="display:flex;"><span>mov     rax, [rbp<span style="color:#ff79c6">+</span>var_10]
</span></span><span style="display:flex;"><span>mov     dword ptr [rax], <span style="color:#bd93f9">0</span>C8h
</span></span><span style="display:flex;"><span>mov     eax, [rbp<span style="color:#ff79c6">+</span>var_14]
</span></span><span style="display:flex;"><span>mov     esi, eax
</span></span><span style="display:flex;"><span>lea     rax, format     ; <span style="color:#f1fa8c">&#34;a=%d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>mov     rdi, rax        ; format
</span></span><span style="display:flex;"><span>mov     eax, <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>call    _printf
</span></span></code></pre></div><p>指针和左值引用：在汇编看起来一模一样，引用也是为了满足C++特性，比如操作符重载</p>
<p>右值引用？？？</p>
<ul>
<li>函数参数右值引用和值传递作为参数</li>
</ul>
<h2 id="lambda-表达式">lambda 表达式</h2>
<p>比较简单的lambda 可以看出来其参数类型与个数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>v3 <span style="color:#ff79c6">=</span> main<span style="color:#ff79c6">::</span>{lambda(<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>)#<span style="color:#bd93f9">1</span>}<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span>()(<span style="color:#ff79c6">&amp;</span>v6, <span style="color:#bd93f9">1LL</span>, <span style="color:#bd93f9">2LL</span>);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">__int64</span> <span style="color:#ff79c6">__fastcall</span> main<span style="color:#ff79c6">::</span>{lambda(<span style="color:#8be9fd">int</span>,<span style="color:#8be9fd">int</span>)#<span style="color:#bd93f9">1</span>}<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span>()(<span style="color:#ff79c6">__int64</span> a1, <span style="color:#8be9fd">int</span> a2, <span style="color:#8be9fd">int</span> a3)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">__int64</span> v3; <span style="color:#6272a4">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>  v3 <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;&lt;</span>std<span style="color:#ff79c6">::</span>char_traits<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">&gt;&gt;</span>(<span style="color:#ff79c6">&amp;</span>std<span style="color:#ff79c6">::</span>cout, <span style="color:#f1fa8c">&#34;lambda&#34;</span>);
</span></span><span style="display:flex;"><span>  std<span style="color:#ff79c6">::</span>ostream<span style="color:#ff79c6">::</span><span style="color:#ff79c6">operator</span><span style="color:#ff79c6">&lt;&lt;</span>(v3, <span style="color:#ff79c6">&amp;</span>std<span style="color:#ff79c6">::</span>endl<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span>,std<span style="color:#ff79c6">::</span>char_traits<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">&gt;&gt;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> (<span style="color:#8be9fd">unsigned</span> <span style="color:#8be9fd">int</span>)(a2 <span style="color:#ff79c6">+</span> a3);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="debugger">debugger</h2>
<p>WinDbg 命令：<a href="http://windbg.info/doc/1-common-cmds.html">Common WinDbg Commands </a>
x64dbg 文档：<a href="https://help.x64dbg.com/en/latest/">  x64dbg documentation</a></p>
<p>windbg 常见命令，感觉 preview 更加好看</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#6272a4">// 断点 b
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">bp</span>: 断点
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">bl</span>: list
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">bc</span>: clear
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 查看 display/dump
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>d{a<span style="color:#ff79c6">|</span>b<span style="color:#ff79c6">|</span>c<span style="color:#ff79c6">|</span>d<span style="color:#ff79c6">|</span>D<span style="color:#ff79c6">|</span>f<span style="color:#ff79c6">|</span>p<span style="color:#ff79c6">|</span>q<span style="color:#ff79c6">|</span>u<span style="color:#ff79c6">|</span>w<span style="color:#ff79c6">|</span>W} [Options] [Range]
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">db</span>: dump byte
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">dw</span>: word
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">dd</span>: dword
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">dq</span>: qword
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">dt</span>: type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 单步执行
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">g</span>: go
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">t</span>: trace，步入
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">p</span>: 步过
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 查看寄存器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">r</span>: <span style="color:#ff79c6">register</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 调用栈
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">k</span>: dump stack
</span></span><span style="display:flex;"><span>.frame
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 搜索
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">s</span>: search
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 修改
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">e</span>: edit
</span></span></code></pre></div><p>某些命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>.echo 
</span></span><span style="display:flex;"><span>.reboot
</span></span><span style="display:flex;"><span>.reload
</span></span><span style="display:flex;"><span>.<span style="color:#8be9fd;font-style:italic">cls</span>: 清屏幕
</span></span><span style="display:flex;"><span>.help
</span></span></code></pre></div><p>x64dbg 操作起来比较容易，可以使用鼠标和右键😋。除了某些命令</p>
		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/c&#43;&#43;">C&#43;&#43;</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		<div id="disqus_thread"></div>
<script type="text/javascript">
    (function () {
        
        
        if (window.location.hostname == "localhost")
            return;

        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        var disqus_shortname = 'ldrx30';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/ldrx30" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2024  © ldrx30 |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>
<script>
  feather.replace()
</script></div>
    </body>
</html>
